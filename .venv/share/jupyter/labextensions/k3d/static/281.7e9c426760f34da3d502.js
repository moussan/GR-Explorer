(self.webpackChunkk3d=self.webpackChunkk3d||[]).push([[281],{6231:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nuniform mat4 transform;\r\nuniform sampler3D volumeTexture;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler2D jitterTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform mat4 modelViewMatrix;\r\nuniform float samples;\r\nuniform float gradient_step;\r\n\r\nuniform sampler3D mask;\r\nuniform float maskOpacities[256];\r\n\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\n\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n    vec3(-0.5, -0.5, -0.5),\r\n    vec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n            ((inv_direction.x < 0.0) ? 1 : 0),\r\n            ((inv_direction.y < 0.0) ? 1 : 0),\r\n            ((inv_direction.z < 0.0) ? 1 : 0)\r\n        )\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\nin Ray ray, in vec3 aabb[2],\r\nout float tmin, out float tmax\r\n) {\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1 - ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1 - ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1 - ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nfloat getMaskOpacity(vec3 pos) {\r\n    int maskValue = int(texture(mask, pos).r * 255.0);\r\n\r\n    return maskOpacities[maskValue];\r\n}\r\n\r\nfloat getMaskedVolume(vec3 pos)\r\n{\r\n    #if (USE_MASK == 1)\r\n    return texture(volumeTexture, pos).x * getMaskOpacity(pos);\r\n    #else\r\n    return texture(volumeTexture, pos).x;\r\n    #endif\r\n}\r\n\r\nvec3 worldGetNormal(in float px, in vec3 pos)\r\n{\r\n    return normalize(\r\n        vec3(\r\n            px - getMaskedVolume(pos + vec3(gradient_step, 0, 0)),\r\n            px - getMaskedVolume(pos + vec3(0, gradient_step, 0)),\r\n            px - getMaskedVolume(pos + vec3(0, 0, gradient_step))\r\n        )\r\n    );\r\n}\r\n\r\nvoid main() {\r\n    float jitter = texture2D(jitterTexture, gl_FragCoord.xy / 64.0).r;\r\n    float tmin = 0.0;\r\n    float tmax = 0.0;\r\n    float px = -3.402823466e+38F;\r\n    vec4 pxColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n    vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n    intersect(makeRay(transformedCameraPosition, direction), aabb, tmin, tmax);\r\n\r\n    vec3 textcoord_end = localPosition + vec3(0.5);\r\n    vec3 textcoord_start = textcoord_end - (tmax - max(0.0, tmin)) * direction / scale.xyz;\r\n    vec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n    // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n    int sampleCount = min(int(length(textcoord_delta) * samples), int(samples * 1.8));\r\n\r\n    textcoord_delta = textcoord_delta / float(sampleCount);\r\n    textcoord_start = textcoord_start - textcoord_delta * (0.01 + 0.98 * jitter);\r\n\r\n    vec3 textcoord = textcoord_start - textcoord_delta;\r\n    vec3 maxTextcoord = textcoord;\r\n\r\n    float step = length(textcoord_delta);\r\n\r\n    for (int count = 0; count < sampleCount; count++) {\r\n        textcoord += textcoord_delta;\r\n\r\n        #if NUM_CLIPPING_PLANES > 0\r\n        vec4 plane;\r\n        vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n        #pragma unroll_loop_start\r\n        for (int i = 0; i < UNION_CLIPPING_PLANES; i++) {\r\n            plane = clippingPlanes[i];\r\n            if (dot(pos, plane.xyz) > plane.w) continue;\r\n        }\r\n        #pragma unroll_loop_end\r\n        #endif\r\n\r\n        #if (USE_MASK == 1)\r\n        float newPx = texture(volumeTexture, textcoord).x * getMaskOpacity(textcoord);\r\n        #else\r\n        float newPx = texture(volumeTexture, textcoord).x;\r\n        #endif\r\n\r\n        if (newPx > px) {\r\n            px = newPx;\r\n            maxTextcoord = textcoord;\r\n        }\r\n\r\n        if (px >= high) {\r\n            break;\r\n        }\r\n    }\r\n\r\n    float scaled_px = (px - low) * inv_range;\r\n\r\n    if (scaled_px > 0.0) {\r\n        scaled_px = min(scaled_px, 0.99);\r\n\r\n        pxColor = texture(colormap, vec2(scaled_px, 0.5));\r\n    }\r\n\r\n    // LIGHT\r\n    #if NUM_DIR_LIGHTS > 0\r\n    vec4 addedLights = vec4(ambientLightColor / PI, 1.0);\r\n    vec3 normal = worldGetNormal(px, maxTextcoord);\r\n\r\n    vec3 lightDirection;\r\n    float lightingIntensity;\r\n\r\n    #pragma unroll_loop_start\r\n    for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n        lightDirection = -directionalLights[i].direction;\r\n        lightingIntensity = clamp(dot(-lightDirection, normal), 0.0, 1.0);\r\n        addedLights.rgb += directionalLights[i].color / PI * (0.05 + 0.95 * lightingIntensity);\r\n\r\n        #if (USE_SPECULAR == 1)\r\n        pxColor.rgb += directionalLights[i].color / PI * pow(lightingIntensity, 50.0) * pxColor.a;\r\n        #endif\r\n    }\r\n    #pragma unroll_loop_end\r\n\r\n    pxColor.rgb *= addedLights.xyz;\r\n    #endif\r\n\r\n    gl_FragColor = pxColor;\r\n}\r\n"},9192:e=>{"use strict";e.exports="uniform vec4 rotation;\r\nuniform vec4 translation;\r\n\r\nvarying vec4 worldPosition;\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nvec3 rotate_vertex_position(vec3 pos, vec3 t, vec4 q) {\r\n    vec3 p = pos.xyz - t.xyz;\r\n\r\n    return p.xyz + 2.0 * cross(cross(p.xyz, q.xyz) + q.w * p.xyz, q.xyz) + t.xyz;\r\n}\r\n\r\nvoid main() {\r\n    vec3 p;\r\n\r\n    #include <begin_vertex>\r\n    #include <project_vertex>\r\n\r\n    localPosition = position;\r\n    worldPosition = modelMatrix * vec4(transformed, 1.0);\r\n\r\n    transformedCameraPosition = rotate_vertex_position(cameraPosition.xyz, translation.xyz, rotation);\r\n    transformedWorldPosition = rotate_vertex_position(worldPosition.xyz, translation.xyz, rotation);\r\n\r\n    #include <worldpos_vertex>\r\n}\r\n"},3154:e=>{"use strict";e.exports="//precision highp sampler3D;\r\n//\r\n//uniform sampler2D colormap;\r\n//uniform sampler3D volumeTexture;\r\n//uniform float low;\r\n//uniform float high;\r\n//uniform float opacity;\r\n//\r\n//varying vec3 localPosition;\r\n//\r\n//#include <common>\r\n//#include <dithering_pars_fragment>\r\n//#include <clipping_planes_pars_fragment>\r\n//#include <logdepthbuf_pars_fragment>\r\n//\r\n//void main() {\r\n//\r\n//    #include <clipping_planes_fragment>\r\n//    #include <logdepthbuf_fragment>\r\n//\r\n//    float inv_range = 1.0 / (high - low);\r\n//    float px = texture(volumeTexture, localPosition).x;\r\n//    float scaled_px = (px - low) * inv_range;\r\n//\r\n//    scaled_px = max(min(scaled_px, 0.99), 0.01);\r\n//    vec4 texelColor = texture(colormap, vec2(scaled_px, 0.5));\r\n//\r\n//    texelColor.a *= opacity;\r\n//\r\n//    gl_FragColor = texelColor;\r\n//\r\n//    #include <premultiplied_alpha_fragment>\r\n//    #include <dithering_fragment>\r\n//}\r\n//\r\n//\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\nprecision highp sampler3D;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler3D volumeTexture;\r\nuniform float low;\r\nuniform float high;\r\n\r\nvarying vec3 localPosition;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n#include <normal_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n    #include <clipping_planes_fragment>\r\n\r\n    float inv_range = 1.0 / (high - low);\r\n    float px = texture(volumeTexture, localPosition).x;\r\n    float scaled_px = (px - low) * inv_range;\r\n    scaled_px = max(min(scaled_px, 0.99), 0.01);\r\n    vec4 diffuseColor = texture(colormap, vec2(scaled_px, 0.5));\r\n    diffuseColor.a *= opacity;\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n    vec3 totalEmissiveRadiance = emissive;\r\n\r\n    #include <logdepthbuf_fragment>\r\n    #include <map_fragment>\r\n    #include <color_fragment>\r\n    #include <alphamap_fragment>\r\n    #include <alphatest_fragment>\r\n    #include <specularmap_fragment>\r\n    #include <normal_fragment_begin>\r\n    #include <normal_fragment_maps>\r\n    #include <emissivemap_fragment>\r\n\r\n    // accumulation\r\n    #include <lights_phong_fragment>\r\n    #include <lights_fragment_begin>\r\n    #include <lights_fragment_maps>\r\n    #include <lights_fragment_end>\r\n\r\n    // modulation\r\n    #include <aomap_fragment>\r\n\r\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n    #include <envmap_fragment>\r\n\r\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\r\n\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n    #include <fog_fragment>\r\n    #include <premultiplied_alpha_fragment>\r\n    #include <dithering_fragment>\r\n\r\n}\r\n"},368:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <normal_pars_vertex>\r\n\r\nvarying vec3 localPosition;\r\nvarying vec3 vViewPosition;\r\n\r\nvoid main() {\r\n    #include <beginnormal_vertex>\r\n\r\n    #include <begin_vertex>\r\n    #include <project_vertex>\r\n    #include <defaultnormal_vertex>\r\n    #include <normal_vertex>\r\n\r\n    localPosition = position + vec3(0.5, 0.5, 0.5);\r\n    vViewPosition = -mvPosition.xyz;\r\n\r\n    #include <worldpos_vertex>\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n\r\n}\r\n"},2345:e=>{"use strict";e.exports="precision highp sampler3D;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler3D volumeTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform vec3 b1;\r\nuniform vec3 b2;\r\nuniform float opacity;\r\n\r\nvarying vec4 worldPosition;\r\n\r\n#include <common>\r\n#include <dithering_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvoid main() {\r\n\r\n    #include <clipping_planes_fragment>\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec3 coord = (worldPosition.xyz - b1) / (b2 - b1);\r\n    float inv_range = 1.0 / (high - low);\r\n    float px = texture(volumeTexture, coord).x;\r\n    float scaled_px = (px - low) * inv_range;\r\n\r\n    scaled_px = max(min(scaled_px, 0.99), 0.01);\r\n    vec4 texelColor = texture(colormap, vec2(scaled_px, 0.5));\r\n\r\n    texelColor.a *= opacity;\r\n\r\n    gl_FragColor = texelColor;\r\n\r\n    #include <premultiplied_alpha_fragment>\r\n    #include <dithering_fragment>\r\n}\r\n"},6830:e=>{"use strict";e.exports="varying vec4 worldPosition;\r\n\r\n#include <common>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    vec4 mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n    worldPosition = modelMatrix * vec4(position, 1.0);\r\n\r\n    #include <clipping_planes_vertex>\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n}\r\n"},8349:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nuniform float size;\r\nuniform float specular;\r\nuniform float opacity;\r\nuniform mat4 projectionMatrix;\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\nvoid main(void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n\r\n    vec2 impostorSpaceCoordinate = (gl_PointCoord.xy - vec2(0.5, 0.5)) * 2.0;\r\n    float distanceFromCenter = length(impostorSpaceCoordinate);\r\n\r\n    if (distanceFromCenter > 1.0) discard;\r\n\r\n    float normalizedDepth = sqrt(1.0 - distanceFromCenter * distanceFromCenter);\r\n    float depthOfFragment = normalizedDepth * size * 0.5;\r\n\r\n    vec4 pos = vec4(mvPosition.xyz, 1.0);\r\n    pos.z += depthOfFragment;\r\n    pos = projectionMatrix * pos;\r\n\r\n    #ifdef USE_LOGDEPTHBUF_EXT\r\n    float depth = log2(1.0 + pos.w) * logDepthBufFC * 0.5;\r\n    #else\r\n    pos = pos / pos.w;\r\n    float depth = ((gl_DepthRange.diff * pos.z) + gl_DepthRange.near + gl_DepthRange.far) / 2.0;\r\n    #endif\r\n\r\n    if (depth < gl_FragDepthEXT) discard;\r\n    gl_FragDepthEXT = depth;\r\n\r\n    vec3 normal = vec3(impostorSpaceCoordinate, normalizedDepth);\r\n\r\n    vec4 addedLights = vec4(ambientLightColor / PI, 1.0);\r\n    vec4 finalSphereColor = vColor;\r\n\r\n    finalSphereColor.a *= opacity;\r\n\r\n    for (int l = 0; l < NUM_DIR_LIGHTS; l++) {\r\n        vec3 lightDirection = -directionalLights[l].direction;\r\n        float lightingIntensity = clamp(dot(-lightDirection, normal), 0.0, 1.0);\r\n        addedLights.rgb += directionalLights[l].color / PI * (0.05 + 0.95 * lightingIntensity);\r\n\r\n        #if (USE_SPECULAR == 1)\r\n        finalSphereColor.rgb += directionalLights[l].color / PI * pow(lightingIntensity, 80.0);\r\n        #endif\r\n    }\r\n\r\n    gl_FragColor = finalSphereColor * addedLights;\r\n}\r\n"},5074:e=>{"use strict";e.exports="varying vec4 vColor;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvoid main(void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec4 color = vColor;\r\n    color.a *= opacity;\r\n\r\n    gl_FragColor = color;\r\n}\r\n"},1885:e=>{"use strict";e.exports="uniform float size;\r\nuniform float scale;\r\n\r\nattribute vec3 color;\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\n#if (USE_PER_POINT_SIZE == 1)\r\nattribute float sizes;\r\n#endif\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\n#include <common>\r\n#include <clipping_planes_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n\r\nvoid main() {\r\n    float perPointOpacity = 1.0;\r\n\r\n    mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n    #if (USE_PER_POINT_SIZE == 1)\r\n    gl_PointSize = 2.0 * sizes;\r\n    #else\r\n    gl_PointSize = 2.0 * size;\r\n    #endif\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n    perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    finalSphereColor.a *= perPointOpacity;\r\n    vColor = finalSphereColor;\r\n    #else\r\n    vColor = vec4(color, perPointOpacity);\r\n    #endif\r\n}\r\n"},8640:e=>{"use strict";e.exports="varying vec4 vColor;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nvoid main(void)\r\n{\r\n    #include <clipping_planes_fragment>\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec2 impostorSpaceCoordinate = (gl_PointCoord.xy - vec2(0.5, 0.5));\r\n    float distanceFromCenter = length(impostorSpaceCoordinate);\r\n\r\n    if (distanceFromCenter > 0.5) discard;\r\n\r\n    vec4 color = vColor;\r\n    color.a *= opacity;\r\n\r\n    gl_FragColor = color;\r\n}\r\n"},6404:e=>{"use strict";e.exports="uniform float size;\r\nuniform float scale;\r\n\r\nattribute vec3 color;\r\n\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\n#if (USE_PER_POINT_SIZE == 1)\r\nattribute float sizes;\r\n#endif\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\nvarying vec4 vColor;\r\nvarying vec4 mvPosition;\r\n\r\n#include <common>\r\n#include <clipping_planes_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n\r\nvoid main() {\r\n    float perPointOpacity = 1.0;\r\n\r\n    mvPosition = modelViewMatrix * vec4(position, 1.0);\r\n\r\n    float fov = 2.0 * atan(1.0 / projectionMatrix[1][1]) * 180.0 / PI;\r\n    float fovCorrection = tan((PI / 180.0) * fov / 2.0);\r\n\r\n    #if (USE_PER_POINT_SIZE == 1)\r\n    gl_PointSize = sizes * (scale / -mvPosition.z) / fovCorrection;\r\n    #else\r\n    gl_PointSize = size * (scale / -mvPosition.z) / fovCorrection;\r\n    #endif\r\n\r\n    gl_Position = projectionMatrix * mvPosition;\r\n\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n    perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    finalSphereColor.a *= perPointOpacity;\r\n    vColor = finalSphereColor;\r\n    #else\r\n    vColor = vec4(color, perPointOpacity);\r\n    #endif\r\n}\r\n"},6772:e=>{"use strict";e.exports="#define PHONG\r\n\r\nuniform vec3 diffuse;\r\nuniform vec3 emissive;\r\nuniform vec3 specular;\r\nuniform float shininess;\r\nuniform float opacity;\r\n\r\n#include <common>\r\n#include <packing>\r\n#include <dithering_pars_fragment>\r\n#include <color_pars_fragment>\r\n#include <uv_pars_fragment>\r\n#include <uv2_pars_fragment>\r\n#include <map_pars_fragment>\r\n#include <alphamap_pars_fragment>\r\n#include <aomap_pars_fragment>\r\n#include <lightmap_pars_fragment>\r\n#include <emissivemap_pars_fragment>\r\n#include <envmap_common_pars_fragment>\r\n#include <envmap_pars_fragment>\r\n#include <cube_uv_reflection_fragment>\r\n#include <fog_pars_fragment>\r\n#include <bsdfs>\r\n#include <lights_pars_begin>\r\n#include <lights_phong_pars_fragment>\r\n#include <shadowmap_pars_fragment>\r\n#include <bumpmap_pars_fragment>\r\n#include <normalmap_pars_fragment>\r\n#include <specularmap_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n#include <clipping_planes_pars_fragment>\r\n\r\nvarying float perPointOpacity;\r\nvarying vec3 vNormal;\r\n\r\nvoid main() {\r\n\r\n    #include <clipping_planes_fragment>\r\n    vec4 diffuseColor = vec4(diffuse, opacity);\r\n\r\n    diffuseColor.a *= perPointOpacity;\r\n\r\n    ReflectedLight reflectedLight = ReflectedLight(vec3(0.0), vec3(0.0), vec3(0.0), vec3(0.0));\r\n    vec3 totalEmissiveRadiance = emissive;\r\n\r\n    #include <logdepthbuf_fragment>\r\n    #include <map_fragment>\r\n    #include <color_fragment>\r\n    #include <alphamap_fragment>\r\n    #include <alphatest_fragment>\r\n    #include <specularmap_fragment>\r\n    #include <normal_fragment_begin>\r\n    #include <normal_fragment_maps>\r\n    #include <emissivemap_fragment>\r\n\r\n    // accumulation\r\n    #include <lights_phong_fragment>\r\n    #include <lights_fragment_begin>\r\n    #include <lights_fragment_maps>\r\n    #include <lights_fragment_end>\r\n\r\n    // modulation\r\n    #include <aomap_fragment>\r\n\r\n    vec3 outgoingLight = reflectedLight.directDiffuse + reflectedLight.indirectDiffuse + reflectedLight.directSpecular + reflectedLight.indirectSpecular + totalEmissiveRadiance;\r\n\r\n    #include <envmap_fragment>\r\n\r\n    gl_FragColor = vec4(outgoingLight, diffuseColor.a);\r\n\r\n    #include <tonemapping_fragment>\r\n    #include <encodings_fragment>\r\n    #include <fog_fragment>\r\n    #include <premultiplied_alpha_fragment>\r\n    #include <dithering_fragment>\r\n\r\n}\r\n"},2048:e=>{"use strict";e.exports="attribute vec3 offset;\r\nuniform float opacity;\r\n\r\nvarying vec3 vViewPosition;\r\nvarying vec3 vNormal;\r\n\r\n#if (USE_PER_POINT_OPACITY == 1)\r\nattribute float opacities;\r\n#endif\r\n\r\nvarying float perPointOpacity;\r\n\r\n#if (USE_COLOR_MAP == 1)\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\nattribute float attributes;\r\n#endif\r\n\r\n#include <common>\r\n#include <uv_pars_vertex>\r\n#include <uv2_pars_vertex>\r\n#include <displacementmap_pars_vertex>\r\n#include <envmap_pars_vertex>\r\n#include <color_pars_vertex>\r\n#include <fog_pars_vertex>\r\n#include <morphtarget_pars_vertex>\r\n#include <skinning_pars_vertex>\r\n#include <shadowmap_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n#include <clipping_planes_pars_vertex>\r\n\r\nvoid main() {\r\n    #include <uv_vertex>\r\n    #include <uv2_vertex>\r\n\r\n    perPointOpacity = 1.0;\r\n\r\n    #if (USE_PER_POINT_OPACITY == 1)\r\n    perPointOpacity = opacities;\r\n    #endif\r\n\r\n    #if (USE_COLOR_MAP == 1)\r\n    float scaled_px = (attributes - low) / (high - low);\r\n    vec4 finalSphereColor = texture2D(colormap, vec2(scaled_px, 0.5));\r\n\r\n    perPointOpacity = finalSphereColor.a * perPointOpacity;\r\n    vColor = finalSphereColor.rgb;\r\n    #else\r\n    vColor = color.rgb;\r\n    #endif\r\n\r\n    #include <beginnormal_vertex>\r\n    #include <morphnormal_vertex>\r\n    #include <skinbase_vertex>\r\n    #include <skinnormal_vertex>\r\n    #include <defaultnormal_vertex>\r\n\r\n    vNormal = normalize(transformedNormal);\r\n\r\n    #include <begin_vertex>\r\n    #include <morphtarget_vertex>\r\n    #include <skinning_vertex>\r\n    #include <displacementmap_vertex>\r\n    #include <project_vertex>\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n    vViewPosition = -mvPosition.xyz;\r\n    #include <worldpos_vertex>\r\n    #include <envmap_vertex>\r\n    #include <shadowmap_vertex>\r\n    #include <fog_vertex>\r\n}\r\n"},7644:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <logdepthbuf_pars_fragment>\r\n\r\nuniform sampler2D map;\r\nuniform sampler2D colormap;\r\nuniform float low;\r\nuniform float high;\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    #include <clipping_planes_fragment>\r\n    #include <logdepthbuf_fragment>\r\n\r\n    vec4 tcolor = texture2D(map, vUv);\r\n    float value = (tcolor.x - low) / (high - low);\r\n\r\n    vec4 color = texture2D(colormap, vec2(value, 0.5));\r\n\r\n    if (color.a <= 0.01) {\r\n        discard;\r\n    }\r\n\r\n    gl_FragColor = color;\r\n}"},3012:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_vertex>\r\n#include <logdepthbuf_pars_vertex>\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    vUv = uv;\r\n\r\n    #include <begin_vertex>\r\n    #include <project_vertex>\r\n\r\n    #include <worldpos_vertex>\r\n    #include <logdepthbuf_vertex>\r\n    #include <clipping_planes_vertex>\r\n}\r\n"},7003:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nuniform vec3 lightMapSize;\r\nuniform vec2 lightMapRenderTargetSize;\r\nuniform sampler2D shadowTexture;\r\n\r\nuniform mat4 transform;\r\nuniform sampler3D volumeTexture;\r\n\r\nuniform sampler2D colormap;\r\nuniform sampler2D jitterTexture;\r\nuniform float focal_length;\r\nuniform float focal_plane;\r\nuniform float low;\r\nuniform float high;\r\nuniform mat4 modelViewMatrix;\r\nuniform float samples;\r\nuniform float alpha_coef;\r\nuniform float gradient_step;\r\n\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\n\r\nuniform sampler3D mask;\r\nuniform float maskOpacities[256];\r\n\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n    vec3(-0.5, -0.5, -0.5),\r\n    vec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n            ((inv_direction.x < 0.0) ? 1 : 0),\r\n            ((inv_direction.y < 0.0) ? 1 : 0),\r\n            ((inv_direction.z < 0.0) ? 1 : 0)\r\n        )\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\nin Ray ray, in vec3 aabb[2],\r\nout float tmin, out float tmax\r\n) {\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1 - ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1 - ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1 - ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nfloat getMaskOpacity(vec3 pos) {\r\n    int maskValue = int(texture(mask, pos).r * 255.0);\r\n\r\n    return maskOpacities[maskValue];\r\n}\r\n\r\nfloat getMaskedVolume(vec3 pos)\r\n{\r\n    #if (USE_MASK == 1)\r\n    return texture(volumeTexture, pos).x * getMaskOpacity(pos);\r\n    #else\r\n    return texture(volumeTexture, pos).x;\r\n    #endif\r\n}\r\n\r\nvec3 worldGetNormal(in float px, in vec3 pos)\r\n{\r\n    return normalize(\r\n        vec3(\r\n            px - getMaskedVolume(pos + vec3(gradient_step, 0, 0)),\r\n            px - getMaskedVolume(pos + vec3(0, gradient_step, 0)),\r\n            px - getMaskedVolume(pos + vec3(0, 0, gradient_step))\r\n        )\r\n    );\r\n}\r\n\r\nfloat getShadow(vec3 textcoord, vec2 sliceCount)\r\n{\r\n    float zidx1 = floor(textcoord.z * lightMapSize.z);\r\n    float zidx2 = ceil(textcoord.z * lightMapSize.z);\r\n\r\n    float shadow1 = texture2D(shadowTexture,\r\n                              vec2(\r\n                                  floor(mod(zidx1, sliceCount.x)) * lightMapSize.x / lightMapRenderTargetSize.x,\r\n                                  floor(zidx1 / sliceCount.x) * lightMapSize.y / lightMapRenderTargetSize.y\r\n                              )\r\n                              + vec2(textcoord.x / sliceCount.x, textcoord.y / sliceCount.y)\r\n    ).r;\r\n\r\n    float shadow2 = texture2D(shadowTexture,\r\n                              vec2(\r\n                                  floor(mod(zidx2, sliceCount.x)) * lightMapSize.x / lightMapRenderTargetSize.x,\r\n                                  floor(zidx2 / sliceCount.x) * lightMapSize.y / lightMapRenderTargetSize.y\r\n                              )\r\n                              + vec2(textcoord.x / sliceCount.x, textcoord.y / sliceCount.y)\r\n    ).r;\r\n\r\n    return mix(shadow1, shadow2, textcoord.z * lightMapSize.z - zidx1);\r\n}\r\n\r\nvoid main() {\r\n    float jitter = texture2D(jitterTexture, gl_FragCoord.xy / 64.0).r;\r\n    float tmin = 0.0;\r\n    float tmax = 0.0;\r\n    float px = 0.0;\r\n    float shadow = 0.0;\r\n    vec4 pxColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n    #if (RAY_SAMPLES_COUNT > 0)\r\n    vec4 accuColor = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n    for (int ray_samples = 0; ray_samples < RAY_SAMPLES_COUNT; ray_samples++) {\r\n\r\n        vec4 value = vec4(0.0, 0.0, 0.0, 0.0);\r\n\r\n        vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n\r\n        // Focal plane correction\r\n        vec3 P = transformedCameraPosition + direction * focal_plane;\r\n\r\n        float r = texture2D(jitterTexture, vec2(0.3) + gl_FragCoord.xy / 64.0 * float(ray_samples + 3)).r;\r\n        vec3 apertureShift = normalize(vec3(\r\n                                           1.0 - 2.0 * texture2D(jitterTexture, vec2(0.0) + gl_FragCoord.xy / 64.0 * float(ray_samples)).r,\r\n                                           1.0 - 2.0 * texture2D(jitterTexture, vec2(0.1) + gl_FragCoord.xy / 64.0 * float(ray_samples + 1)).r,\r\n                                           1.0 - 2.0 * texture2D(jitterTexture, vec2(0.2) + gl_FragCoord.xy / 64.0 * float(ray_samples + 2)).r\r\n                                       )) * r * focal_length;\r\n\r\n        direction = normalize(P - (transformedCameraPosition + apertureShift));\r\n\r\n        vec3 eye = P - direction * 1000000.0;\r\n\r\n        intersect(makeRay(eye, direction), aabb, tmin, tmax);\r\n\r\n        vec3 textcoord_end = ((eye + direction * tmax) - translation.xyz) / scale.xyz + vec3(0.5);\r\n        #else\r\n        vec4 value = vec4(0.0, 0.0, 0.0, 0.0);\r\n        vec3 direction = normalize(transformedWorldPosition - transformedCameraPosition);\r\n        intersect(makeRay(transformedCameraPosition, direction), aabb, tmin, tmax);\r\n\r\n        vec3 textcoord_end = localPosition + vec3(0.5);\r\n        #endif\r\n        vec3 textcoord_start = textcoord_end - (tmax - max(0.0, tmin)) * direction / scale.xyz;\r\n        vec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n        // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n        int sampleCount = min(int(length(textcoord_delta) * samples), int(samples * 1.8));\r\n\r\n        textcoord_delta = textcoord_delta / float(sampleCount);\r\n        textcoord_start = textcoord_start - textcoord_delta * (0.01 + 0.98 * jitter);\r\n\r\n        vec3 textcoord = textcoord_start - textcoord_delta;\r\n\r\n        float step = length(textcoord_delta);\r\n\r\n        #if (USE_SHADOW == 1)\r\n        float sliceSize = lightMapSize.x * lightMapSize.y;\r\n        vec2 sliceCount = lightMapRenderTargetSize / lightMapSize.xy;\r\n        #endif\r\n\r\n        for (int count = 0; count < sampleCount; count++) {\r\n            textcoord += textcoord_delta;\r\n\r\n            #if NUM_CLIPPING_PLANES > 0\r\n            vec4 plane;\r\n            vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n            #pragma unroll_loop_start\r\n            for (int i = 0; i < UNION_CLIPPING_PLANES; i++) {\r\n                plane = clippingPlanes[i];\r\n                if (dot(pos, plane.xyz) > plane.w) continue;\r\n            }\r\n            #pragma unroll_loop_end\r\n            #endif\r\n\r\n            px = texture(volumeTexture, textcoord).x;\r\n            float scaled_px = (px - low) * inv_range;\r\n\r\n            if (scaled_px > 0.0) {\r\n                #if (USE_MASK == 1)\r\n                float maskOpacity = getMaskOpacity(textcoord);\r\n                #else\r\n                float maskOpacity = 1.0;\r\n                #endif\r\n\r\n                if (maskOpacity > 0.0) {\r\n                    #if (USE_SHADOW == 1)\r\n                    shadow =\r\n                    (getShadow(textcoord, sliceCount) +\r\n                    getShadow(textcoord + vec3(1.0 / lightMapSize.x, 0, 0), sliceCount) +\r\n                    getShadow(textcoord - vec3(1.0 / lightMapSize.x, 0, 0), sliceCount) +\r\n                    getShadow(textcoord + vec3(0, 1.0 / lightMapSize.y, 0), sliceCount) +\r\n                    getShadow(textcoord - vec3(0, 1.0 / lightMapSize.y, 0), sliceCount) +\r\n                    getShadow(textcoord + vec3(0, 0, 1.0 / lightMapSize.z), sliceCount) +\r\n                    getShadow(textcoord - vec3(0, 0, 1.0 / lightMapSize.z), sliceCount)) / 7.0;\r\n                    #else\r\n                    shadow = 0.0;\r\n                    #endif\r\n\r\n                    scaled_px = min(scaled_px, 0.99);\r\n\r\n                    pxColor = texture(colormap, vec2(scaled_px, 0.5));\r\n\r\n                    pxColor.a = 1.0 - pow(1.0 - pxColor.a, step * alpha_coef);\r\n                    pxColor.a *= (1.0 - value.a);\r\n                    pxColor.a *= maskOpacity;\r\n\r\n                    pxColor.rgb *= pxColor.a;\r\n\r\n                    // LIGHT\r\n                    #if NUM_DIR_LIGHTS > 0\r\n                    if (pxColor.a > 0.0) {\r\n                        vec4 addedLights = vec4(ambientLightColor / PI, 1.0);\r\n                        vec3 specularColor = vec3(0.0);\r\n\r\n                        vec3 normal = worldGetNormal(px * maskOpacity, textcoord);\r\n\r\n                        vec3 lightDirection;\r\n                        float lightingIntensity;\r\n\r\n                        vec3 lightReflect;\r\n                        float specularFactor;\r\n\r\n                        #pragma unroll_loop_start\r\n                        for (int i = 0; i < NUM_DIR_LIGHTS; i++) {\r\n                            lightDirection = directionalLights[i].direction;\r\n                            lightingIntensity = clamp(dot(lightDirection, normal), 0.0, 1.0);\r\n                            addedLights.rgb += directionalLights[i].color / PI * (0.2 + 0.8 * lightingIntensity) * (1.0 - shadow);\r\n\r\n                            lightReflect = normalize(reflect(lightDirection, normal));\r\n                            specularFactor = dot(direction, lightReflect);\r\n\r\n                            if (specularFactor > 0.0)\r\n                            specularColor += 0.002 * scaled_px * (1.0 / step) *\r\n                            directionalLights[i].color / PI * pow(specularFactor, 250.0) *\r\n                            pxColor.a * (1.0 - shadow);\r\n                        }\r\n                        #pragma unroll_loop_end\r\n\r\n                        pxColor.rgb = pxColor.rgb * addedLights.xyz + specularColor;\r\n                    }\r\n                    #endif\r\n\r\n                    value += pxColor;\r\n\r\n                    if (value.a >= 0.99) {\r\n                        value.a = 1.0;\r\n                        break;\r\n                    }\r\n                }\r\n            }\r\n        }\r\n\r\n        #if (RAY_SAMPLES_COUNT > 0)\r\n\r\n        accuColor += value;\r\n    }\r\n\r\n    gl_FragColor = accuColor / float(RAY_SAMPLES_COUNT);\r\n\r\n    #else\r\n\r\n    gl_FragColor = value;\r\n\r\n    #endif\r\n}\r\n"},472:e=>{"use strict";e.exports="#include <common>\r\n#include <clipping_planes_pars_fragment>\r\n#include <lights_pars_begin>\r\n\r\nprecision highp sampler3D;\r\n\r\nvarying vec2 vUv;\r\n\r\nuniform vec3 lightMapSize;\r\nuniform vec2 lightMapRenderTargetSize;\r\nuniform vec3 volumeMapSize;\r\nuniform sampler2D colormap;\r\nuniform sampler3D volumeTexture;\r\nuniform float low;\r\nuniform float high;\r\nuniform vec4 scale;\r\nuniform vec4 translation;\r\nuniform float samples;\r\nuniform float alpha_coef;\r\nuniform vec3 lightDirection;\r\nuniform mat4 modelViewMatrix;\r\n\r\nuniform sampler3D mask;\r\nuniform float maskOpacities[256];\r\nuniform bool maskEnabled;\r\n\r\nfloat inv_range;\r\n\r\nstruct Ray {\r\n    vec3 origin;\r\n    vec3 direction;\r\n    vec3 inv_direction;\r\n    int sign[3];\r\n};\r\n\r\nvec3 aabb[2] = vec3[2](\r\n    vec3(-0.5, -0.5, -0.5),\r\n    vec3(0.5, 0.5, 0.5)\r\n);\r\n\r\nRay makeRay(vec3 origin, vec3 direction) {\r\n    vec3 inv_direction = vec3(1.0) / direction;\r\n\r\n    return Ray(\r\n        origin,\r\n        direction,\r\n        inv_direction,\r\n        int[3](\r\n            ((inv_direction.x < 0.0) ? 1 : 0),\r\n            ((inv_direction.y < 0.0) ? 1 : 0),\r\n            ((inv_direction.z < 0.0) ? 1 : 0)\r\n        )\r\n    );\r\n}\r\n\r\n/*\r\n\tFrom: https://github.com/hpicgs/cgsee/wiki/Ray-Box-Intersection-on-the-GPU\r\n*/\r\nvoid intersect(\r\nin Ray ray, in vec3 aabb[2],\r\nout float tmin, out float tmax\r\n) {\r\n    float tymin, tymax, tzmin, tzmax;\r\n    tmin = (aabb[ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tmax = (aabb[1 - ray.sign[0]].x - ray.origin.x) * ray.inv_direction.x;\r\n    tymin = (aabb[ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tymax = (aabb[1 - ray.sign[1]].y - ray.origin.y) * ray.inv_direction.y;\r\n    tzmin = (aabb[ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tzmax = (aabb[1 - ray.sign[2]].z - ray.origin.z) * ray.inv_direction.z;\r\n    tmin = max(max(tmin, tymin), tzmin);\r\n    tmax = min(min(tmax, tymax), tzmax);\r\n}\r\n\r\nfloat getMaskOpacity(vec3 pos) {\r\n    int maskValue = int(texture(mask, pos).r * 255.0);\r\n\r\n    return maskOpacities[maskValue];\r\n}\r\n\r\nvoid main() {\r\n    vec2 sliceCount = lightMapRenderTargetSize / lightMapSize.xy;\r\n    float zidx = floor(vUv.x * lightMapRenderTargetSize.x / lightMapSize.x) +\r\n    floor(vUv.y * lightMapRenderTargetSize.y / lightMapSize.y) * sliceCount.x;\r\n\r\n    if (zidx > lightMapSize.z) {\r\n        discard;\r\n    }\r\n\r\n    float x = mod(vUv.x * lightMapRenderTargetSize.x, lightMapSize.x) / lightMapSize.x;\r\n    float y = mod(vUv.y * lightMapRenderTargetSize.y, lightMapSize.y) / lightMapSize.y;\r\n    float z = zidx / lightMapSize.z;\r\n\r\n    vec3 localPosition = vec3(x, y, z);\r\n\r\n    // check if inside\r\n    vec3 delta_step = vec3(1.0) / lightMapSize;\r\n    vec3 s = step(delta_step, localPosition) - step(vec3(1.0) - delta_step, localPosition);\r\n\r\n    if (s.x * s.y * s.z < 1.0) {\r\n        discard;\r\n    }\r\n\r\n    // start intersection\r\n    float tmin = 0.0;\r\n    float tmax = 0.0;\r\n    float reducedSamples = samples / 2.0;\r\n    float dist;\r\n\r\n    inv_range = 1.0 / (high - low);\r\n    aabb[0] = aabb[0] * scale.xyz + translation.xyz;\r\n    aabb[1] = aabb[1] * scale.xyz + translation.xyz;\r\n\r\n    intersect(makeRay((localPosition - vec3(0.5)) * scale.xyz + translation.xyz, -lightDirection), aabb, tmin, tmax);\r\n\r\n    float backoff = length(scale.xyz / volumeMapSize);\r\n\r\n    if (tmin >= tmax) {\r\n        dist = 0.0;\r\n    } else {\r\n        dist = abs(tmax);\r\n    }\r\n\r\n    dist += backoff;\r\n    backoff *= 3.0;\r\n\r\n    if (dist <= backoff) {\r\n        discard;\r\n    }\r\n    vec3 textcoord_start = localPosition - dist * lightDirection / scale.xyz;\r\n    vec3 textcoord_end = localPosition - backoff * lightDirection / scale.xyz;\r\n    vec3 textcoord_delta = textcoord_end - textcoord_start;\r\n\r\n    // @TODO: protection. Sometimes strange situation happen and sampleCount is out the limit\r\n    int sampleCount = min(int(length(textcoord_delta) * reducedSamples), int(reducedSamples * 1.8));\r\n\r\n    textcoord_delta = textcoord_delta / float(sampleCount);\r\n    vec3 textcoord = textcoord_start - textcoord_delta;\r\n\r\n    float textcoord_delta_step = length(textcoord_delta);\r\n    float sum_density = 0.0;\r\n\r\n    for (int count = 0; count < sampleCount; count++) {\r\n        textcoord += textcoord_delta;\r\n\r\n        #if NUM_CLIPPING_PLANES > 0\r\n        vec4 plane;\r\n        vec3 pos = -vec3(modelViewMatrix * vec4(textcoord - vec3(0.5), 1.0));\r\n\r\n        #pragma unroll_loop_start\r\n        for (int i = 0; i < UNION_CLIPPING_PLANES; i++) {\r\n            plane = clippingPlanes[i];\r\n            if (dot(pos, plane.xyz) > plane.w) continue;\r\n        }\r\n        #pragma unroll_loop_end\r\n        #endif\r\n\r\n        float px = texture(volumeTexture, textcoord).x;\r\n        float scaled_px = (px - low) * inv_range;\r\n\r\n        if (scaled_px > 0.0) {\r\n            scaled_px = min(scaled_px, 0.99);\r\n            float alpha = texture(colormap, vec2(scaled_px, 0.5)).a;\r\n\r\n            float density = 1.0 - pow(1.0 - alpha, textcoord_delta_step * alpha_coef);\r\n            density *= (1.0 - sum_density);\r\n\r\n            #if (USE_MASK == 1)\r\n            density *= getMaskOpacity(textcoord);\r\n            #endif\r\n\r\n            sum_density += density;\r\n\r\n            if (sum_density >= 0.99) {\r\n                sum_density = 1.0;\r\n                break;\r\n            }\r\n        }\r\n    }\r\n\r\n    gl_FragColor = vec4(sum_density, 0, 0, 1.0);\r\n}\r\n"},2085:e=>{"use strict";e.exports="#include <common>\r\n\r\nvarying vec2 vUv;\r\n\r\nvoid main() {\r\n    gl_Position = projectionMatrix * vec4(position, 1.0);\r\n    vUv = uv;\r\n}\r\n"},2307:e=>{"use strict";e.exports="uniform vec4 rotation;\r\nuniform vec4 translation;\r\n\r\nvarying vec4 worldPosition;\r\nvarying vec3 localPosition;\r\nvarying vec3 transformedCameraPosition;\r\nvarying vec3 transformedWorldPosition;\r\n\r\nvec3 rotate_vertex_position(vec3 pos, vec3 t, vec4 q) {\r\n    vec3 p = pos.xyz - t.xyz;\r\n\r\n    return p.xyz + 2.0 * cross(cross(p.xyz, q.xyz) + q.w * p.xyz, q.xyz) + t.xyz;\r\n}\r\n\r\nvoid main() {\r\n    vec3 p;\r\n\r\n    #include <begin_vertex>\r\n    #include <project_vertex>\r\n\r\n    localPosition = position;\r\n    worldPosition = modelMatrix * vec4(transformed, 1.0);\r\n\r\n    transformedCameraPosition = rotate_vertex_position(cameraPosition.xyz, translation.xyz, rotation);\r\n    transformedWorldPosition = rotate_vertex_position(worldPosition.xyz, translation.xyz, rotation);\r\n\r\n    #include <worldpos_vertex>\r\n}\r\n"},2497:e=>{"use strict";e.exports="export default \"<div id=\\\"canvasTarget_[ID]\\\" class=\\\"k3d_plot\\\" style=\\\"position: relative;\\\"></div>\\r\\n\\r\\n<script>\\r\\n  var K3DInstance;\\r\\n  var data_[ID] = '[DATA]';\\r\\n\\r\\n  function loadScript(path, cb) {\\r\\n    var script = document.createElement('script');\\r\\n    script.src = path;\\r\\n    script.onload = cb;\\r\\n    script.onerror = cb;\\r\\n    document.head.appendChild(script);\\r\\n  }\\r\\n\\r\\n  function loadK3D() {\\r\\n    function load(lib) {\\r\\n      function _base64ToArrayBuffer(base64) {\\r\\n        var binary_string = window.atob(base64);\\r\\n        var len = binary_string.length;\\r\\n        var bytes = new Uint8Array(len);\\r\\n        for (var i = 0; i < len; i++) {\\r\\n          bytes[i] = binary_string.charCodeAt(i);\\r\\n        }\\r\\n        return bytes;\\r\\n      }\\r\\n\\r\\n      try {\\r\\n        document.getElementById('canvasTarget_[ID]').style.cssText = [\\r\\n          `height:[HEIGHT]px`,\\r\\n          'position: relative',\\r\\n        ].join(';');\\r\\n\\r\\n        K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n          _base64ToArrayBuffer(data_[ID]),\\r\\n          document.getElementById('canvasTarget_[ID]'),\\r\\n        );\\r\\n\\r\\n        K3DInstance.then(function (K3DInstance) {\\r\\n          [ADDITIONAL]\\r\\n        });\\r\\n      } catch (e) {\\r\\n        console.log(e);\\r\\n        return;\\r\\n      }\\r\\n    }\\r\\n\\r\\n    require(['k3d'],\\r\\n            load,\\r\\n            function () {\\r\\n              loadScript('https://unpkg.com/k3d@[VERSION]/dist/standalone.js', function () {\\r\\n                try {\\r\\n                  delete require.s.contexts._.registry.k3d;\\r\\n                } catch(err) {\\r\\n                  console.log(err);\\r\\n                }\\r\\n\\r\\n                require(['k3d'], load);\\r\\n              });\\r\\n            });\\r\\n  }\\r\\n\\r\\n  if (typeof (require) === 'undefined') {\\r\\n    loadScript('https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js', loadK3D);\\r\\n  } else {\\r\\n    loadK3D();\\r\\n  }\\r\\n<\/script>\";"},2656:e=>{"use strict";e.exports='export default "<!doctype html>\\r\\n<html>\\r\\n<head>\\r\\n    <meta charset=\\"utf-8\\">\\r\\n    <title>K3D snapshot viewer - [TIMESTAMP]</title>\\r\\n    <style>\\r\\n        body, html {\\r\\n            background-color: #F5F5F5;\\r\\n            margin: 0;\\r\\n            padding: 0;\\r\\n            overflow: hidden;\\r\\n        }\\r\\n\\r\\n        #canvasTarget {\\r\\n            width: 100%;\\r\\n            height: 100%;\\r\\n            position: absolute;\\r\\n        }\\r\\n    </style>\\r\\n    <script src=\\"https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js\\"><\/script>\\r\\n    <script src=\\"https://unpkg.com/k3d@[VERSION]/dist/standalone.js\\"><\/script>\\r\\n</head>\\r\\n<body>\\r\\n<div id=\\"canvasTarget\\"></div>\\r\\n\\r\\n<script>\\r\\n    var K3DInstance;\\r\\n    var data = \'[DATA]\';\\r\\n\\r\\n    function _base64ToArrayBuffer(base64) {\\r\\n        var binary_string = window.atob(base64);\\r\\n        var len = binary_string.length;\\r\\n        var bytes = new Uint8Array(len);\\r\\n        for (var i = 0; i < len; i++) {\\r\\n            bytes[i] = binary_string.charCodeAt(i);\\r\\n        }\\r\\n        return bytes;\\r\\n    }\\r\\n\\r\\n    require([\'k3d\'], function (lib) {\\r\\n        try {\\r\\n            K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n                _base64ToArrayBuffer(data),\\r\\n                document.getElementById(\'canvasTarget\'),\\r\\n            );\\r\\n\\r\\n            K3DInstance.then(function(K3DInstance) {\\r\\n                [ADDITIONAL]\\r\\n            });\\r\\n        } catch (e) {\\r\\n            console.log(e);\\r\\n            return;\\r\\n        }\\r\\n    });\\r\\n<\/script>\\r\\n</body>\\r\\n</html>\\r\\n";'},7546:e=>{"use strict";e.exports="export default \"<!doctype html>\\r\\n<html>\\r\\n<head>\\r\\n    <meta charset=\\\"utf-8\\\">\\r\\n    <title>K3D snapshot viewer - [TIMESTAMP]</title>\\r\\n    <style>\\r\\n        body, html {\\r\\n            background-color: #F5F5F5;\\r\\n            margin: 0;\\r\\n            padding: 0;\\r\\n            overflow: hidden;\\r\\n        }\\r\\n\\r\\n        #canvasTarget {\\r\\n            width: 100%;\\r\\n            height: 100%;\\r\\n            position: absolute;\\r\\n        }\\r\\n    </style>\\r\\n    <script id='fflatejs'>[FFLATE_JS]<\/script>\\r\\n    <script>\\r\\n        window.k3dCompressed = '[K3D_SOURCE]';\\r\\n\\r\\n        function _base64ToArrayBuffer(base64) {\\r\\n            var binary_string = window.atob(base64);\\r\\n            var len = binary_string.length;\\r\\n            var bytes = new Uint8Array(len);\\r\\n            for (var i = 0; i < len; i++) {\\r\\n                bytes[i] = binary_string.charCodeAt(i);\\r\\n            }\\r\\n            return bytes;\\r\\n        }\\r\\n\\r\\n        var k3dSource = fflate.strFromU8(\\r\\n            fflate.unzlibSync(_base64ToArrayBuffer(window.k3dCompressed))\\r\\n        );\\r\\n    <\/script>\\r\\n    <script id='requirejs'>[REQUIRE_JS]<\/script>\\r\\n</head>\\r\\n<body>\\r\\n<div id=\\\"canvasTarget\\\"></div>\\r\\n<script>\\r\\n    var K3DInstance;\\r\\n    var data = '[DATA]';\\r\\n\\r\\n    eval(k3dSource);\\r\\n\\r\\n    require(['k3d'], function (lib) {\\r\\n        try {\\r\\n            K3DInstance = new lib.CreateK3DAndLoadBinarySnapshot(\\r\\n                _base64ToArrayBuffer(data),\\r\\n                document.getElementById('canvasTarget'),\\r\\n            );\\r\\n\\r\\n            K3DInstance.then(function(K3DInstance) {\\r\\n                [ADDITIONAL]\\r\\n            });\\r\\n        } catch (e) {\\r\\n            console.log(e);\\r\\n            return;\\r\\n        }\\r\\n    });\\r\\n<\/script>\\r\\n</body>\\r\\n</html>\\r\\n\";"},7723:(e,t,r)=>{const n=r(7761),o=r(7360),a=r(7357).GUI,{viewModes:i}=r(7861),s=r(5843),{cameraModes:l}=r(7996),c=r(4061),d=r(5251),p=r(3949),u=r(52),m=r(7602),h=r(6860),g=r(5399),{viewModeGUI:f}=r(7861),{cameraModeGUI:v}=r(7996),y=r(1847),{getColorLegend:_}=r(4744),x=r(9513),b=r(500),w=r(227),{base64ToArrayBuffer:M}=r(5321),C=o.createCodec({preset:!0}),E=r(1020);function S(e,t,E){const A=this;let P=null,z=1;const D=t.ownerDocument.defaultView||t.ownerDocument.parentWindow,T={ObjectsListJson:{},ObjectsById:{},chunkList:{},targetDOMNode:t,overlayDOMNode:null};let k={},O=0;const j={controls:null,objects:null};let I;function L(e,t){return!!k[e]&&(Object.keys(k[e]).forEach((r=>{k[e][r](t)})),!0)}function F(e,t){L(A.events.PARAMETERS_CHANGE,{key:e,value:t})}function V(){A.gui=new a({width:220,autoPlace:!1,title:"K3D panel"}),I.appendChild(A.gui.domElement),j.controls=A.gui.addFolder("Controls").close(),j.objects=A.gui.addFolder("Objects").close(),j.info=A.gui.addFolder("Info").close(),p.screenshotGUI(j.controls,A),u.snapshotGUI(j.controls,A),m(j.controls,A),D===window&&(h(j.controls,A),g.isAvailable()&&g.initialize(T.targetDOMNode,j.controls,D,A)),j.controls.add(A.parameters,"cameraAutoFit").onChange(F.bind(A,"camera_auto_fit")),j.controls.add(A.parameters,"gridAutoFit").onChange((e=>{A.setGridAutoFit(e),F.call(A,"grid_auto_fit",e)})),j.controls.add(A.parameters,"gridVisible").onChange((e=>{A.setGridVisible(e),F.call(A,"grid_visible",e)})),j.controls.add(A.parameters,"fpsMeter").onChange((e=>{A.setFpsMeter(e),F.call(A,"fps_meter",e)})),f(j.controls,A),v(j.controls,A),y.manipulateGUI(j.controls,A,F),j.controls.add(A.parameters,"cameraFov").step(.1).min(1).max(179).name("FOV").onChange((e=>{A.setCameraFOV(e),F.call(A,"camera_fov",e)})),j.controls.add(A.parameters,"voxelPaintColor").step(1).min(0).max(255).name("voxelColor").onChange(F.bind(A,"voxel_paint_color")),j.controls.add(A.parameters,"lighting").step(.01).min(0).max(4).name("lighting").onChange((e=>{A.setDirectionalLightingIntensity(e),F.call(A,"lighting",e)})),w.timeSeriesGUI(j.controls,A,F),j.clippingPlanes=j.controls.addFolder("Clipping planes").close(),j.info.add(A.parameters,"guiVersion").name("Js version:"),j.info.controllers[0].$input.readOnly=!0,A.parameters.backendVersion&&(j.info.add({version:A.parameters.backendVersion},"version").name("Python version:"),j.info.controllers[1].$input.readOnly=!0),Object.keys(T.ObjectsListJson).forEach((e=>{x.update(A,T.ObjectsListJson[e],j.objects,null)}))}function R(e){let t=A.Provider.Helpers.getObjectById(T,e);t&&(T.K3DObjects.remove(t),delete T.ObjectsById[e],t.onRemove&&t.onRemove(),t.geometry&&(t.geometry.dispose(),t.geometry=void 0),t.material&&t.material.map&&(t.material.map.dispose(),t.material.map=void 0),t.material&&(t.material.dispose(),t.material=void 0),t.mesh&&(t.mesh.dispose(),t.mesh=void 0),t=void 0)}if(r(1552),!(this instanceof S))return new S(e,t,E);if("object"!=typeof e)throw new Error("Provider should be an object (a key-value map following convention)");this.refreshAfterObjectsChange=function(e,t){return!(!A.parameters.autoRendering&&!t)&&(e||A.getWorld().setCameraToFitScene(),j.controls&&w.refreshTimeScale(A,j),e?A.render(!0):A.rebuildSceneData().then(A.render.bind(null,!0)))},this.render=function(e){T.render(e)},this.resizeHelper=function(){A.disabling||(A.gui&&(A.gui.domElement.parentNode.style["max-height"]=`${T.targetDOMNode.offsetHeight}px`),A.Provider.Helpers.resizeListener(T),L(A.events.RESIZED),A.render())},T.overlayDOMNode=D.document.createElement("div"),T.overlayDOMNode.style.cssText=["position: absolute","width: 100%","height: 100%","top: 0","right: 0","pointer-events: none","overflow: hidden"].join(";"),this.GUI=j,this.parameters=s.assignWith({viewMode:i.view,cameraMode:l.trackball,manipulateMode:y.manipulateModes.translate,voxelPaintColor:0,snapshotIncludeJs:!0,menuVisibility:!0,cameraAutoFit:!0,gridAutoFit:!0,gridVisible:!0,grid:[-1,-1,-1,1,1,1],gridColor:15132390,labelColor:4473924,antialias:1,logarithmicDepthBuffer:!0,screenshotScale:5,renderingSteps:1,clearColor:16777215,clippingPlanes:[],fpsMeter:!1,lighting:1.5,time:0,colorbarObjectId:-1,colorbarScientific:!1,fps:25,axes:["x","y","z"],minimumFps:-1,cameraNoRotate:!1,cameraNoZoom:!1,cameraNoPan:!1,cameraRotateSpeed:1,cameraZoomSpeed:1.2,cameraPanSpeed:.3,cameraDampingFactor:0,name:null,cameraFov:60,cameraAnimation:{},autoRendering:!0,axesHelper:1,axesHelperColors:[16711680,65280,255],snapshotType:"full",customData:null,guiVersion:r(8008).version},E||{},((e,t)=>void 0===t?e:t)),this.autoRendering=!1,this.setMinimumFps=function(e){A.parameters.minimumFps=e},this.startAutoPlay=function(){w.startAutoPlay(A,F)},this.stopAutoPlay=function(){w.stopAutoPlay(A)},this.setFps=function(e){A.parameters.fps=e,j.controls&&j.controls.controllers.forEach((e=>{"fps"===e.property&&e.updateDisplay()}))},this.setFpsMeter=function(e){let t;if(e){if(P)return;t=r(6548),P=new t,P.dom.style.position="absolute",T.targetDOMNode.appendChild(P.dom),requestAnimationFrame((function e(){P&&(P.update(),requestAnimationFrame(e))}))}else P&&(P.domElement.remove(),P=null);A.parameters.fpsMeter=e,j.controls&&j.controls.controllers.forEach((e=>{"fpsMeter"===e.property&&e.updateDisplay()}))},this.dispatch=L,this.Provider=e,this.setFullscreen=function(e){e?g.screenfull.request(T.targetDOMNode):g.screenfull.exit()},this.getFullscreen=function(){return g.screenfull.isFullscreen},this.setDirectionalLightingIntensity=function(e){A.parameters.lighting=Math.min(Math.max(e,0),4),A.getWorld().recalculateLights(A.parameters.lighting),A.render(),j.controls&&j.controls.controllers.forEach((e=>{"lighting"===e.property&&e.updateDisplay()}))},this.setViewMode=function(e){A.parameters.viewMode=e,L(A.events.VIEW_MODE_CHANGE,e)&&A.render(),j.controls&&(j.controls.controllers.forEach((e=>{"viewMode"===e.property&&e.updateDisplay()})),y.refreshManipulateGUI(A,j)),T.targetDOMNode.style.cursor="auto"},this.setCameraMode=function(e){void 0===s.invert(l)[e]&&(e=l.trackball),A.parameters.cameraMode=e,A.getWorld().changeControls(),A.getWorld().setCameraToFitScene(!0),L(A.events.CAMERA_MODE_CHANGE,e),A.render(),j.controls&&j.controls.controllers.forEach((e=>{"cameraMode"===e.property&&e.updateDisplay()}))},this.setManipulateMode=function(e){A.parameters.manipulateMode=e,L(A.events.MANIPULATE_MODE_CHANGE,e)&&A.render(),j.controls&&j.controls.controllers.forEach((e=>{"manipulateMode"===e.property&&e.updateDisplay()}))},this.setAutoRendering=function(e){A.parameters.autoRendering=e},this.setMenuVisibility=function(e){A.parameters.menuVisibility=e,e?A.gui||V():A.gui&&(A.gui_map={},A.gui_groups={},A.gui_counts={},A.gui.destroy(),A.gui.domElement.remove(),A.gui=null)},this.setClippingPlanes=function(e){const t=s.cloneDeep(e);A.parameters.clippingPlanes.length=0,t.forEach((e=>{A.parameters.clippingPlanes.push(e)})),j.clippingPlanes&&b(A,j.clippingPlanes),A.render()},this.setColorbarScientific=function(e){A.parameters.colorbarScientific=e,A.render()},this.setColorMapLegend=function(e){const t=e.id||e;A.parameters.colorbarObjectId!==t&&(A.parameters.colorbarObjectId=t,F("colorbar_object_id",A.parameters.colorbarObjectId),Object.keys(T.ObjectsListJson).forEach((e=>{T.ObjectsListJson[e].colorLegend&&(T.ObjectsListJson[e].colorLegend=!1)})),t>0&&void 0!==T.ObjectsListJson[t]&&(T.ObjectsListJson[t].colorLegend=!0),j.objects&&Object.keys(j.objects.folders).forEach((e=>{j.objects.folders[e].controllers.forEach((e=>{"colorLegend"===e.property&&e.updateDisplay()}))}))),_(A,T.ObjectsListJson[A.parameters.colorbarObjectId]||e)},this.setCameraAutoFit=function(e){A.parameters.cameraAutoFit=e,j.controls&&j.controls.controllers.forEach((e=>{"cameraAutoFit"===e.property&&e.updateDisplay()})),e&&A.getWorld().setCameraToFitScene()},this.setRenderingSteps=function(e){A.parameters.renderingSteps=e},this.setAxes=function(e){A.parameters.axes=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setName=function(e){A.parameters.name=e},this.setAxesHelper=function(e){A.parameters.axesHelper=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setAxesHelperColors=function(e){A.parameters.axesHelperColors=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setGridAutoFit=function(e){A.parameters.gridAutoFit=e,j.controls&&j.controls.controllers.forEach((e=>{"gridAutoFit"===e.property&&e.updateDisplay()}))},this.setCameraLock=function(e,t,r){A.parameters.cameraNoRotate=e,A.parameters.cameraNoZoom=t,A.parameters.cameraNoPan=r,T.controls.noRotate=e,T.controls.noZoom=t,T.controls.noPan=r},this.setCameraSpeeds=function(e,t,r){A.parameters.cameraRotateSpeed=e,A.parameters.cameraZoomSpeed=t,A.parameters.cameraPanSpeed=r,T.controls.rotateSpeed=e,T.controls.zoomSpeed=t,T.controls.panSpeed=r},this.setCameraFOV=function(e){A.parameters.cameraFov=e,T.setupCamera(null,e),j.controls&&j.controls.controllers.forEach((e=>{"cameraFov"===e.property&&e.updateDisplay()})),A.rebuildSceneData(!1).then((()=>{A.render()}))},this.setCameraDampingFactor=function(e){A.parameters.cameraDampingFactor=e,A.getWorld().changeControls(!0),j.controls&&j.controls.controllers.forEach((e=>{"damping_factor"===e.property&&e.updateDisplay()}))},this.setGridVisible=function(e){A.parameters.gridVisible=e,j.controls&&j.controls.controllers.forEach((e=>{"gridVisible"===e.property&&e.updateDisplay()})),A.refreshGrid(),A.render()},this.setGridColor=function(e){A.parameters.gridColor=e,A.rebuildSceneData().then((()=>{A.render()}))},this.setLabelColor=function(e){A.parameters.labelColor=e,A.rebuildSceneData(!0).then((()=>{A.render()}))},this.setScreenshotScale=function(e){A.parameters.screenshotScale=e},this.setSnapshotType=function(e){A.parameters.snapshotType=e},this.setGrid=function(e){A.parameters.grid=e,A.rebuildSceneData(!0).then((()=>{A.refreshGrid(),A.render()}))},this.setCamera=function(e){e.length>0&&T.setupCamera(e)},this.setCameraAnimation=function(e){A.parameters.cameraAnimation=e,j.controls&&w.refreshTimeScale(A,j)},this.resetCamera=function(e){T.setCameraToFitScene(!0,e),T.render()},this.setVoxelPaint=function(e){A.parameters.voxelPaintColor=e,j.controls&&j.controls.controllers.forEach((e=>{"voxelPaintColor"===e.property&&e.updateDisplay()}))},this.setClearColor=function(e){if(A.parameters.clearColor=e,e>=0){const t=parseInt(e,10)+16777216;T.targetDOMNode.style.backgroundColor=`#${t.toString(16).substr(1)}`}else T.targetDOMNode.style.backgroundColor="#fff"},this.on=function(e,t){return k[e]=k[e]||{},k[e][O]=t,O+=1,O-1},this.off=function(e,t){k[e]=k[e]||{},delete k[e][t]},this.getScene=function(){return T.scene},this.addOrUpdateObject=function(e,t){try{R(e.id)}catch(e){}return"Text"!==e.type&&"Text2d"!==e.type&&T.K3DObjects.add(t),z+=1,A.heavyOperationSync=!0,z},this.getObjectById=function(e){return A.Provider.Helpers.getObjectById(T,e)},this.setChunkList=function(e){T.chunkList=e},this.removeObject=function(e){return R(e),delete T.ObjectsListJson[e],e===A.parameters.colorbarObjectId&&A.setColorMapLegend(-1),L(A.events.OBJECT_REMOVED,e),A.refreshAfterObjectsChange(!1),Promise.resolve(!0)},this.setTime=function(e){const t=w.getObjectsWithTimeSeriesAndMinMax(A);A.parameters.time=Math.min(Math.max(e,t.min),t.max);const r=t.objects.reduce(((e,t)=>(e.push(A.reload(t,null,!0)),e)),[]);if(Object.keys(A.parameters.cameraAnimation).length>0){const t={camera:A.parameters.cameraAnimation};t.camera.timeSeries=!0;const r=w.interpolateTimeSeries(t,e);T.setupCamera(r.json.camera,null,!0)}return j.controls&&j.controls.controllers.forEach((e=>{"time"===e.property&&e.updateDisplay()})),Promise.all(r).then((()=>A.refreshAfterObjectsChange(!0)))},this.load=function(e){return c(A,e).then((e=>(e.forEach((e=>{x.update(A,e.json,j.objects,null),T.ObjectsListJson[e.json.id]=e.json,T.ObjectsById[e.json.id]=e.obj,(-1===A.parameters.colorbarObjectId&&e.json.color_range&&2===e.json.color_range.length||A.parameters.colorbarObjectId===e.json.id)&&A.setColorMapLegend(e.json)})),L(A.events.OBJECT_LOADED),A.refreshAfterObjectsChange(!1),e)))},this.reload=function(e,t,r){if(!1===e.visible){!0!==r&&(A.refreshAfterObjectsChange(!0),x.update(A,e,j.objects,t));try{R(e.id)}catch(e){}return Promise.resolve(!0)}const n={objects:[e]};return null!==t&&(n.changes=[t]),c(A,n).then((e=>(e.forEach((e=>{!0!==r&&x.update(A,e.json,j.objects,t),T.ObjectsListJson[e.json.id]=e.json,T.ObjectsById[e.json.id]=e.obj,(-1===A.parameters.colorbarObjectId&&e.json.color_range&&2===e.json.color_range.length||A.parameters.colorbarObjectId===e.json.id)&&A.setColorMapLegend(e.json)})),L(A.events.OBJECT_LOADED),!0!==r&&A.refreshAfterObjectsChange(!0),e)))},this.getWorld=function(){return T},this.getScreenshot=function(e,t){return p.getScreenshot(this,e,t)},this.getHTMLSnapshot=function(e){return u.getHTMLSnapshot(this,e)},this.getSnapshot=function(e){const t=Object.keys(T.chunkList).reduce(((e,t)=>{const r=T.chunkList[t].attributes;return e[t]=Object.keys(r).reduce(((e,t)=>(e[t]=d.serialize(r[t]),e)),{}),e}),{}),r=s.values(T.ObjectsListJson).map((e=>Object.keys(e).reduce(((t,r)=>(t[r]=d.serialize(e[r]),t)),{}))),a=s.cloneDeep(A.parameters);return a.camera=A.getWorld().controls.getCameraArray(),n.zlibSync(o.encode({objects:r,chunkList:t,plot:a},{codec:C}),{level:e})},this.setSnapshot=function(e){return"string"==typeof e&&(e=n.unzlibSync(new Uint8Array(M(e)))),e instanceof Uint8Array&&(e=o.decode(e,{codec:C})),Object.keys(e.chunkList).forEach((t=>{const r=e.chunkList[t];T.chunkList[r.id]={attributes:Object.keys(r).reduce(((e,t)=>(e[t]=d.deserialize(r[t]),e)),{})}})),e.objects.forEach((e=>{Object.keys(e).forEach((t=>{e[t]=d.deserialize(e[t])}))})),A.load({objects:e.objects}).then((()=>A.refreshAfterObjectsChange(!1,!0)))},this.extractSnapshot=function(e){return e.match(/var data = '(.+)';/im)},this.disable=function(){this.disabling=!0,this.gui&&this.gui.destroy(),this.autoRendering=!1,Object.keys(T.ObjectsListJson).forEach((function(e){R(e),delete T.ObjectsListJson[e]})),T.cleanup(),P&&P.domElement.remove(),k={},this.resizeObserver.disconnect(),T.renderer.removeContextLossListener(),T.renderer.forceContextLoss()},T.targetDOMNode.appendChild(T.overlayDOMNode),this.Provider.Initializers.Renderer.call(T,this),this.Provider.Initializers.Setup.call(T,this),this.Provider.Initializers.Camera.call(T,this),this.Provider.Initializers.Canvas.call(T,this),this.Provider.Initializers.Scene.call(T,this),this.Provider.Initializers.Manipulate.call(T,this),this.resizeObserver=new ResizeObserver((e=>{this.resizeHelper()})),this.resizeObserver.observe(t),I=D.document.createElement("div"),I.className="dg",I.style.cssText=["position: absolute","top: 0","color: black","right: 0","z-index: 16777271",`max-height: ${t.clientHeight}px`].join(";"),T.targetDOMNode.appendChild(I),A.parameters.menuVisibility&&V(),this.resizeHelper(),A.setScreenshotScale(A.parameters.screenshotScale),A.setClearColor(A.parameters.clearColor),A.setMenuVisibility(A.parameters.menuVisibility),A.setTime(A.parameters.time),A.setGridAutoFit(A.parameters.gridAutoFit),A.setGridVisible(A.parameters.gridVisible),A.setGrid(A.parameters.grid),A.setCameraAutoFit(A.parameters.cameraAutoFit),A.setCameraDampingFactor(A.parameters.cameraDampingFactor),A.setClippingPlanes(A.parameters.clippingPlanes),A.setDirectionalLightingIntensity(A.parameters.lighting),A.setColorMapLegend(A.parameters.colorbarObjectId),A.setColorbarScientific(A.parameters.colorbarScientific),A.setAutoRendering(A.parameters.autoRendering),A.setCameraLock(A.parameters.cameraNoRotate,A.parameters.cameraNoZoom,A.parameters.cameraNoPan),A.setCameraSpeeds(A.parameters.cameraRotateSpeed,A.parameters.cameraZoomSpeed,A.parameters.cameraPanSpeed),A.setCameraFOV(A.parameters.cameraFov),A.setFps(A.parameters.fps),A.setViewMode(A.parameters.viewMode),A.setFpsMeter(A.parameters.fpsMeter),A.MsgpackCodec=C,A.msgpack=o,A.serialize=d,A.render(),T.targetDOMNode.className+=" k3d-target"}window.Float16Array=E,C.addExtPacker(32,E,(e=>e)),C.addExtUnpacker(32,(e=>E(e.buffer))),S.prototype.events={VIEW_MODE_CHANGE:"viewModeChange",CAMERA_MODE_CHANGE:"cameraModeChange",MANIPULATE_MODE_CHANGE:"manipulateModeChange",RENDERED:"rendered",BEFORE_RENDER:"before_render",RESIZED:"resized",CAMERA_CHANGE:"cameraChange",OBJECT_LOADED:"objectLoaded",OBJECT_REMOVED:"objectRemoved",OBJECT_CHANGE:"objectChange",OBJECT_HOVERED:"objectHovered",OBJECT_CLICKED:"objectClicked",PARAMETERS_CHANGE:"parametersChange",VOXELS_CALLBACK:"voxelsCallback",MOUSE_MOVE:"mouseMove",MOUSE_CLICK:"mouseClick"},e.exports=S},6482:e=>{let t;e.exports={error:function(e,r,n){t instanceof Node||(t=document.createElement("ul"),t.id="K3D-error-console",t.style.cssText=["font: 12px sans-serif","color: #FFFFFF","position: absolute","top: 0px","left: 0px","padding: 0px","z-index: 999","margin: 0px","list-style: none outside none"].join(";"),document.body.appendChild(t));const o=function(){const e=document.createElement("li");return e.style.cssText=["background-color: #B50F0F","padding: 5px","margin-bottom: 1px"].join(";"),t.appendChild(e),e}();o.innerHTML=["<b>",e||"Error","</b>: ",r].join(""),n||setTimeout((()=>{t.removeChild(o)}),5e3)},defaultTimeout:5e3}},4061:(e,t,r)=>{const n=r(2809),o=r(5843),a=r(227),{error:i}=r(6482);e.exports=function(e,t){let r,s;const l=[];let c;try{return t.objects.forEach(((d,p)=>{if(c=!1,n(e,d),r=d&&e.Provider.Objects[d.type],void 0===r)return void i("Loader Error",`Unsupported object type ${d.type}`);s=(new Date).getTime();const u=a.interpolateTimeSeries(d,e.parameters.time),m=t.changes&&t.changes[p]||u.changes||{};if(r.update&&!o.isEmpty(m)){const t=e.getObjectById(u.json.id);void 0!==t&&(c=r.update(d,m,t,e))}c||(Object.keys(m).forEach((e=>{null!==m[e]&&m[e].timeSeries||(u.json[e]=m[e])})),c=r.create(u.json,e).then((t=>{t.visible=u.json.visible;const r=e.addOrUpdateObject(d,t);return t.K3DIdentifier=d.id||`K3DAutoIncrement_${r}`,d.id=t.K3DIdentifier,console.log(`K3D: Object type "${d.type}" loaded in: `,((new Date).getTime()-s)/1e3,"s"),{json:d,obj:t}})).catch((e=>{console.error(e),i("Loader Error",`Object of type "${d.type}" was not loaded.`)}))),l.push(c)})),Promise.all(l)}catch(e){throw i("Loader Error","K3D Loader failed, please consult browser error console!",!1),e}}},7996:e=>{const t={trackball:"trackball",fly:"fly",orbit:"orbit"};e.exports={cameraModeGUI:function(e,r){e.add(r.parameters,"cameraMode",{Trackball:t.trackball,Orbit:t.orbit,Fly:t.fly}).name("Camera").onChange((e=>{r.setCameraMode(e),r.dispatch(r.events.PARAMETERS_CHANGE,{key:"camera_mode",value:e})}))},cameraModes:t}},500:(e,t,r)=>{const n=r(8348);e.exports=function(e,t){n.init(e,t,e.parameters.clippingPlanes,"clippingPlanes",(function(){e.dispatch(e.events.PARAMETERS_CHANGE,{key:"clipping_planes",value:e.parameters.clippingPlanes})}))}},4744:(e,t,r)=>{const n=r(984),o=r(5103),a=r(5843);e.exports={getColorLegend:function(e,t){let r,i,s,l,c,d;const p=[],u=[],m=[];let h,g,f=0,v=0,y=null;if(e.lastColorMap||(e.lastColorMap={objectId:null,colorRange:[null,null],colorMap:null}),"object"!=typeof t)return;if(p[0]=Math.min(t.color_range[0],t.color_range[1]),p[1]=Math.max(t.color_range[0],t.color_range[1]),e.lastColorMap.objectId===t.id&&e.lastColorMap.colorRange[0]==p[0]&&e.lastColorMap.colorRange[1]==p[1]&&a.isEqual(e.lastColorMap.colorMap,t.color_map.data))return;e.colorMapNode&&(e.getWorld().targetDOMNode.removeChild(e.colorMapNode),e.colorMapNode=null);const _=document.createElementNS("http://www.w3.org/2000/svg","svg"),x=_.namespaceURI,b=document.createElementNS(x,"rect");_.setAttribute("class","colorMapLegend"),_.setAttribute("viewBox","0 0 100 100"),_.style.cssText=["position: absolute","bottom: 10px","left: 10px","width: 30vh","height: 30vh","max-width: 250px","max-height: 250px","min-width: 150px","min-height: 150px","z-index: 16777271","pointer-events: none","font-family: KaTeX_Main"].join(";"),o.createSVGGradient(_,`colormap${t.id}`,t.color_map.data),b.setAttribute("stroke-width",.5.toString(10)),b.setAttribute("stroke-linecap","square"),b.setAttribute("stroke","black"),b.setAttribute("fill",`url(#colormap${t.id})`),b.setAttribute("width",10..toString(10)),b.setAttribute("height",90..toString(10)),b.setAttribute("x",5..toString(10)),b.setAttribute("y",5..toString(10)),_.appendChild(b);const w=p[1]-p[0];for(d=n.pow10ceil(Math.abs(w))/10;v<4;)h=n.fmod(p[0],d),h=h>0?d-h:0,v=Math.floor((Math.abs(w)-h+.001*d)/d),v<4&&(d/=2);for(g=0;g<=v;g++)u.push(p[0]+h+g*d);u.forEach((t=>{l=document.createElementNS(x,"g"),r=document.createElementNS(x,"line"),i=document.createElementNS(x,"text"),s=document.createElementNS(x,"text");const n=5+90*(1-(t-p[0])/w);c=e.parameters.colorbarScientific?t.toPrecision(4):t.toFixed((d.toString(10).split(".")[1]||"").length),r.setAttribute("x1","13"),r.setAttribute("y1",n.toString(10)),r.setAttribute("x2","17"),r.setAttribute("y2",n.toString(10)),r.setAttribute("stroke-width",.5.toString(10)),r.setAttribute("stroke","black"),_.appendChild(r),i.setAttribute("x","0"),i.setAttribute("y","0"),i.setAttribute("alignment-baseline","middle"),i.setAttribute("text-anchor","end"),i.setAttribute("font-size","0.5em"),i.setAttribute("fill","rgb(68, 68, 68)"),i.innerHTML=c,s.setAttribute("x","0.5"),s.setAttribute("y","0.5"),s.setAttribute("alignment-baseline","middle"),s.setAttribute("text-anchor","end"),s.setAttribute("font-size","0.5em"),s.setAttribute("fill","rgb(255, 255, 255)"),s.innerHTML=c,l.setAttribute("pos_y",n.toString(10)),l.appendChild(s),l.appendChild(i),m.push(l),_.appendChild(l)})),e.getWorld().targetDOMNode.appendChild(_),function t(){e.getWorld().width<10||e.getWorld().height<10?null===y&&(y=e.on(e.events.RESIZED,(()=>{t()}))):(null!==y&&(e.off(e.events.RESIZED,y),y=null),f=m.reduce(((e,t)=>Math.max(e,t.getBBox().width)),0),m.forEach((e=>{const t=(f+20).toString(10),r=e.getAttribute("pos_y");e.setAttribute("transform",`translate(${t}, ${r})`)})))}(),e.colorMapNode=_,e.lastColorMap={objectId:t.id,colorRange:p,colorMap:t.color_map.data}}}},6860:(e,t,r)=>{const n=r(5843);e.exports=function(e,t){let o,a;const i=t.getWorld().targetDOMNode,s=document.createElement("div");function l(e,t){const r=e.getElementsByTagName(t);for(;r[0];)r[0].parentNode.removeChild(r[0])}function c(e){const r=t.getWorld(),o=new t.constructor(t.Provider,e,t.parameters),a=r.K3DObjects.children.reduce(((e,t)=>(e.push(r.ObjectsListJson[t.K3DIdentifier]),e)),[]);t.disable(),o.load({objects:a}),o.setCamera(t.getWorld().controls.getCameraArray()),n.assign(t,o)}function d(){o&&(o.close(),o=null,i.removeChild(s),c(i))}function p(){o&&o.closed&&(clearInterval(a),d())}s.className="detachedInfo",s.innerHTML="K3D works in detached mode. Please close window or click on this text to attach it here.",s.style.cssText=["cursor: pointer","padding: 2em"].join(";");const u={detachWidget(){o=window.open("","_blank","width=800,height=600,resizable=1"),o.document.body.innerHTML=r(7529);const e=document.getElementsByTagName("style");for(let t=0;t<e.length;t++)o.document.body.appendChild(e[t].cloneNode(!0));setTimeout((()=>{c(o.document.getElementById("canvasTarget")),l(i,"canvas"),l(i,"div"),l(i,"svg"),i.appendChild(s)}),100),o.opener.addEventListener("unload",(()=>{o&&o.close()}),!1),a=setInterval(p,500)}};e.add(u,"detachWidget").name("Detach widget"),s.addEventListener("click",(()=>{d()}),!1)}},5399:(e,t,r)=>{const n=r(5391).default;e.exports={isAvailable:()=>n.isEnabled,initialize:function(e,t,r,o){const a={fullscreen:!1},i=t.add(a,"fullscreen").name("Full screen").onChange((t=>{o.heavyOperationSync=!0,t?n.request(e):n.exit()}));r.addEventListener(n.raw.fullscreenchange,(()=>{a.fullscreen=n.isFullscreen,i.updateDisplay(),r.dispatchEvent(new Event("resize"))}))},screenfull:n}},5321:e=>{function t(e){const t=e.length,r=new Uint8Array(t);let n;for(n=0;n<t;n++)r[n]=e.charCodeAt(n);return r}e.exports={colorsToFloat32Array:function(e){const t=new Float32Array(3*e.length);return e.forEach(((e,r)=>{t[3*r]=(e>>16&255)/255,t[3*r+1]=(e>>8&255)/255,t[3*r+2]=(255&e)/255})),t},bufferToBase64:function(e){const t=new Uint8Array(e);let r,n="";for(r=0;r<t.length;r++)n+=String.fromCharCode(t[r]);return window.btoa(n)},base64ToArrayBuffer:function(e){return t(window.atob(e))},arrayBufferToBase64:function(e){let t="";const r=new Uint8Array(e),n=r.byteLength;for(let e=0;e<n;e++)t+=String.fromCharCode(r[e]);return window.btoa(t)},stringToArrayBuffer:t}},5103:e=>{function t(e){return e>1&&(e=1),e<0&&(e=0),Math.round(255*e)}function r(e,t){const r={};let n,o;function a(e,t){const o=function(e,t){const o=n.indexOf(e);let a=o,i=o;for(;void 0===r[n[a]][t]&&a>0;)a-=1;for(;void 0===r[n[i]][t]&&i<n.length-1;)i+=1;return[n[a],n[i]]}(e,t),a=(e-o[0])/(o[1]-o[0]);let i,s;return i=void 0!==r[o[0]][t]?r[o[0]][t]:0,s=void 0!==r[o[1]][t]?r[o[1]][t]:1,i*(1-a)+s*a}for(o=0;o<e.length;o+=4)r[e[o]]={r:e[o+1],g:e[o+2],b:e[o+3]};for(t||(n=Object.keys(r).map(parseFloat).sort(((e,t)=>e-t)),t=[n[0],1,n[n.length-1],1]),o=0;o<t.length;o+=2)r[t[o]]||(r[t[o]]={}),r[t[o]].a=t[o+1];return n=Object.keys(r).map(parseFloat).sort(((e,t)=>e-t)),n.forEach((e=>{void 0===r[e].a&&(r[e].a=a(e,"a")),void 0===r[e].r&&(r[e].r=a(e,"r"),r[e].g=a(e,"g"),r[e].b=a(e,"b"))})),n.reduce(((e,t)=>e.concat([parseFloat(t),r[t].r,r[t].g,r[t].b,r[t].a])),[])}e.exports={createCanvasGradient:function(e,n,o){const a=document.createElement("canvas"),i=a.getContext("2d");let s,l;const c=r(e,o);a.height=1,a.width=n;const d=i.createLinearGradient(0,0,a.width,a.height),p=c[0],u=c[c.length-5];for(l=0;l<c.length/5;l++)s=c.slice(5*l,5*l+5),d.addColorStop((s[0]-p)/(u-p),`rgba(${t(s[1])}, ${t(s[2])}, ${t(s[3])}, ${s[4]})`);return i.fillStyle=d,i.fillRect(0,0,a.width,a.height),a},createCanvasColorList:function(e){const t=document.createElement("canvas"),r=t.getContext("2d");let n;t.height=1,t.width=256;const o=r.getImageData(0,0,t.width,t.height);for(n=0;n<e.length;n++)o.data[4*n+3]=255,o.data[4*n]=e[n]>>16&255,o.data[4*n+1]=e[n]>>8&255,o.data[4*n+2]=255&e[n];return r.putImageData(o,0,0),t},createSVGGradient:function(e,n,o,a,i){const s=e.namespaceURI,l=document.createElementNS(s,"linearGradient");e.getElementById(n)&&e.getElementById(n).remove(),l.setAttribute("id",n),i?(l.setAttribute("x1","0"),l.setAttribute("x2","1"),l.setAttribute("y1","0"),l.setAttribute("y2","0")):(l.setAttribute("x1","0"),l.setAttribute("x2","0"),l.setAttribute("y1","1"),l.setAttribute("y2","0"));const c=r(o,a),d=c[0],p=c[c.length-5];for(let e=0;e<c.length;e+=5){const r=document.createElementNS(s,"stop"),n=c.slice(e,e+5);r.setAttribute("offset",((n[0]-d)/(p-d)).toString(10)),r.setAttribute("stop-color",`rgb(${t(n[1])},${t(n[2])},${t(n[3])})`),r.setAttribute("stop-opacity",n[4]),l.appendChild(r)}return(e.querySelector("defs")||e.insertBefore(document.createElementNS(s,"defs"),e.firstChild)).appendChild(l)},mergeColorMapWithOpacity:r}},7529:e=>{e.exports='<style>body { margin: 0;}</style><div id="canvasTarget" style="width: 100%; height: 100%;"></div>'},6150:e=>{e.exports=function(e,t){const r=new XMLHttpRequest;r.open("GET",e,!0),r.onreadystatechange=function(){4===r.readyState&&t(r.response)},r.send(null)}},1020:e=>{e.exports=function e(t){const r=new Uint16Array(t);return r.constructor=e,r}},2518:e=>{e.exports={edgeTable:new Int32Array([0,265,515,778,1030,1295,1541,1804,2060,2309,2575,2822,3082,3331,3593,3840,400,153,915,666,1430,1183,1941,1692,2460,2197,2975,2710,3482,3219,3993,3728,560,825,51,314,1590,1855,1077,1340,2620,2869,2111,2358,3642,3891,3129,3376,928,681,419,170,1958,1711,1445,1196,2988,2725,2479,2214,4010,3747,3497,3232,1120,1385,1635,1898,102,367,613,876,3180,3429,3695,3942,2154,2403,2665,2912,1520,1273,2035,1786,502,255,1013,764,3580,3317,4095,3830,2554,2291,3065,2800,1616,1881,1107,1370,598,863,85,348,3676,3925,3167,3414,2650,2899,2137,2384,1984,1737,1475,1226,966,719,453,204,4044,3781,3535,3270,3018,2755,2505,2240,2240,2505,2755,3018,3270,3535,3781,4044,204,453,719,966,1226,1475,1737,1984,2384,2137,2899,2650,3414,3167,3925,3676,348,85,863,598,1370,1107,1881,1616,2800,3065,2291,2554,3830,4095,3317,3580,764,1013,255,502,1786,2035,1273,1520,2912,2665,2403,2154,3942,3695,3429,3180,876,613,367,102,1898,1635,1385,1120,3232,3497,3747,4010,2214,2479,2725,2988,1196,1445,1711,1958,170,419,681,928,3376,3129,3891,3642,2358,2111,2869,2620,1340,1077,1855,1590,314,51,825,560,3728,3993,3219,3482,2710,2975,2197,2460,1692,1941,1183,1430,666,915,153,400,3840,3593,3331,3082,2822,2575,2309,2060,1804,1541,1295,1030,778,515,265,0]),triangleTable:new Int32Array([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,9,8,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,2,10,0,2,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,8,3,2,10,8,10,9,8,-1,-1,-1,-1,-1,-1,-1,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,8,11,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,11,2,1,9,11,9,8,11,-1,-1,-1,-1,-1,-1,-1,3,10,1,11,10,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,10,1,0,8,10,8,11,10,-1,-1,-1,-1,-1,-1,-1,3,9,0,3,11,9,11,10,9,-1,-1,-1,-1,-1,-1,-1,9,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,7,3,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,1,9,4,7,1,7,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,8,4,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,4,7,3,0,4,1,2,10,-1,-1,-1,-1,-1,-1,-1,9,2,10,9,0,2,8,4,7,-1,-1,-1,-1,-1,-1,-1,2,10,9,2,9,7,2,7,3,7,9,4,-1,-1,-1,-1,8,4,7,3,11,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,4,7,11,2,4,2,0,4,-1,-1,-1,-1,-1,-1,-1,9,0,1,8,4,7,2,3,11,-1,-1,-1,-1,-1,-1,-1,4,7,11,9,4,11,9,11,2,9,2,1,-1,-1,-1,-1,3,10,1,3,11,10,7,8,4,-1,-1,-1,-1,-1,-1,-1,1,11,10,1,4,11,1,0,4,7,11,4,-1,-1,-1,-1,4,7,8,9,0,11,9,11,10,11,0,3,-1,-1,-1,-1,4,7,11,4,11,9,9,11,10,-1,-1,-1,-1,-1,-1,-1,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,5,4,1,5,0,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,5,4,8,3,5,3,1,5,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,10,4,9,5,-1,-1,-1,-1,-1,-1,-1,5,2,10,5,4,2,4,0,2,-1,-1,-1,-1,-1,-1,-1,2,10,5,3,2,5,3,5,4,3,4,8,-1,-1,-1,-1,9,5,4,2,3,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,11,2,0,8,11,4,9,5,-1,-1,-1,-1,-1,-1,-1,0,5,4,0,1,5,2,3,11,-1,-1,-1,-1,-1,-1,-1,2,1,5,2,5,8,2,8,11,4,8,5,-1,-1,-1,-1,10,3,11,10,1,3,9,5,4,-1,-1,-1,-1,-1,-1,-1,4,9,5,0,8,1,8,10,1,8,11,10,-1,-1,-1,-1,5,4,0,5,0,11,5,11,10,11,0,3,-1,-1,-1,-1,5,4,8,5,8,10,10,8,11,-1,-1,-1,-1,-1,-1,-1,9,7,8,5,7,9,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,3,0,9,5,3,5,7,3,-1,-1,-1,-1,-1,-1,-1,0,7,8,0,1,7,1,5,7,-1,-1,-1,-1,-1,-1,-1,1,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,7,8,9,5,7,10,1,2,-1,-1,-1,-1,-1,-1,-1,10,1,2,9,5,0,5,3,0,5,7,3,-1,-1,-1,-1,8,0,2,8,2,5,8,5,7,10,5,2,-1,-1,-1,-1,2,10,5,2,5,3,3,5,7,-1,-1,-1,-1,-1,-1,-1,7,9,5,7,8,9,3,11,2,-1,-1,-1,-1,-1,-1,-1,9,5,7,9,7,2,9,2,0,2,7,11,-1,-1,-1,-1,2,3,11,0,1,8,1,7,8,1,5,7,-1,-1,-1,-1,11,2,1,11,1,7,7,1,5,-1,-1,-1,-1,-1,-1,-1,9,5,8,8,5,7,10,1,3,10,3,11,-1,-1,-1,-1,5,7,0,5,0,9,7,11,0,1,0,10,11,10,0,-1,11,10,0,11,0,3,10,5,0,8,0,7,5,7,0,-1,11,10,5,7,11,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,0,1,5,10,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,8,3,1,9,8,5,10,6,-1,-1,-1,-1,-1,-1,-1,1,6,5,2,6,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,6,5,1,2,6,3,0,8,-1,-1,-1,-1,-1,-1,-1,9,6,5,9,0,6,0,2,6,-1,-1,-1,-1,-1,-1,-1,5,9,8,5,8,2,5,2,6,3,2,8,-1,-1,-1,-1,2,3,11,10,6,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,0,8,11,2,0,10,6,5,-1,-1,-1,-1,-1,-1,-1,0,1,9,2,3,11,5,10,6,-1,-1,-1,-1,-1,-1,-1,5,10,6,1,9,2,9,11,2,9,8,11,-1,-1,-1,-1,6,3,11,6,5,3,5,1,3,-1,-1,-1,-1,-1,-1,-1,0,8,11,0,11,5,0,5,1,5,11,6,-1,-1,-1,-1,3,11,6,0,3,6,0,6,5,0,5,9,-1,-1,-1,-1,6,5,9,6,9,11,11,9,8,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,3,0,4,7,3,6,5,10,-1,-1,-1,-1,-1,-1,-1,1,9,0,5,10,6,8,4,7,-1,-1,-1,-1,-1,-1,-1,10,6,5,1,9,7,1,7,3,7,9,4,-1,-1,-1,-1,6,1,2,6,5,1,4,7,8,-1,-1,-1,-1,-1,-1,-1,1,2,5,5,2,6,3,0,4,3,4,7,-1,-1,-1,-1,8,4,7,9,0,5,0,6,5,0,2,6,-1,-1,-1,-1,7,3,9,7,9,4,3,2,9,5,9,6,2,6,9,-1,3,11,2,7,8,4,10,6,5,-1,-1,-1,-1,-1,-1,-1,5,10,6,4,7,2,4,2,0,2,7,11,-1,-1,-1,-1,0,1,9,4,7,8,2,3,11,5,10,6,-1,-1,-1,-1,9,2,1,9,11,2,9,4,11,7,11,4,5,10,6,-1,8,4,7,3,11,5,3,5,1,5,11,6,-1,-1,-1,-1,5,1,11,5,11,6,1,0,11,7,11,4,0,4,11,-1,0,5,9,0,6,5,0,3,6,11,6,3,8,4,7,-1,6,5,9,6,9,11,4,7,9,7,11,9,-1,-1,-1,-1,10,4,9,6,4,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,10,6,4,9,10,0,8,3,-1,-1,-1,-1,-1,-1,-1,10,0,1,10,6,0,6,4,0,-1,-1,-1,-1,-1,-1,-1,8,3,1,8,1,6,8,6,4,6,1,10,-1,-1,-1,-1,1,4,9,1,2,4,2,6,4,-1,-1,-1,-1,-1,-1,-1,3,0,8,1,2,9,2,4,9,2,6,4,-1,-1,-1,-1,0,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,3,2,8,2,4,4,2,6,-1,-1,-1,-1,-1,-1,-1,10,4,9,10,6,4,11,2,3,-1,-1,-1,-1,-1,-1,-1,0,8,2,2,8,11,4,9,10,4,10,6,-1,-1,-1,-1,3,11,2,0,1,6,0,6,4,6,1,10,-1,-1,-1,-1,6,4,1,6,1,10,4,8,1,2,1,11,8,11,1,-1,9,6,4,9,3,6,9,1,3,11,6,3,-1,-1,-1,-1,8,11,1,8,1,0,11,6,1,9,1,4,6,4,1,-1,3,11,6,3,6,0,0,6,4,-1,-1,-1,-1,-1,-1,-1,6,4,8,11,6,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,10,6,7,8,10,8,9,10,-1,-1,-1,-1,-1,-1,-1,0,7,3,0,10,7,0,9,10,6,7,10,-1,-1,-1,-1,10,6,7,1,10,7,1,7,8,1,8,0,-1,-1,-1,-1,10,6,7,10,7,1,1,7,3,-1,-1,-1,-1,-1,-1,-1,1,2,6,1,6,8,1,8,9,8,6,7,-1,-1,-1,-1,2,6,9,2,9,1,6,7,9,0,9,3,7,3,9,-1,7,8,0,7,0,6,6,0,2,-1,-1,-1,-1,-1,-1,-1,7,3,2,6,7,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,11,10,6,8,10,8,9,8,6,7,-1,-1,-1,-1,2,0,7,2,7,11,0,9,7,6,7,10,9,10,7,-1,1,8,0,1,7,8,1,10,7,6,7,10,2,3,11,-1,11,2,1,11,1,7,10,6,1,6,7,1,-1,-1,-1,-1,8,9,6,8,6,7,9,1,6,11,6,3,1,3,6,-1,0,9,1,11,6,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,8,0,7,0,6,3,11,0,11,6,0,-1,-1,-1,-1,7,11,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,8,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,1,9,11,7,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,1,9,8,3,1,11,7,6,-1,-1,-1,-1,-1,-1,-1,10,1,2,6,11,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,8,6,11,7,-1,-1,-1,-1,-1,-1,-1,2,9,0,2,10,9,6,11,7,-1,-1,-1,-1,-1,-1,-1,6,11,7,2,10,3,10,8,3,10,9,8,-1,-1,-1,-1,7,2,3,6,2,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,7,0,8,7,6,0,6,2,0,-1,-1,-1,-1,-1,-1,-1,2,7,6,2,3,7,0,1,9,-1,-1,-1,-1,-1,-1,-1,1,6,2,1,8,6,1,9,8,8,7,6,-1,-1,-1,-1,10,7,6,10,1,7,1,3,7,-1,-1,-1,-1,-1,-1,-1,10,7,6,1,7,10,1,8,7,1,0,8,-1,-1,-1,-1,0,3,7,0,7,10,0,10,9,6,10,7,-1,-1,-1,-1,7,6,10,7,10,8,8,10,9,-1,-1,-1,-1,-1,-1,-1,6,8,4,11,8,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,6,11,3,0,6,0,4,6,-1,-1,-1,-1,-1,-1,-1,8,6,11,8,4,6,9,0,1,-1,-1,-1,-1,-1,-1,-1,9,4,6,9,6,3,9,3,1,11,3,6,-1,-1,-1,-1,6,8,4,6,11,8,2,10,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,3,0,11,0,6,11,0,4,6,-1,-1,-1,-1,4,11,8,4,6,11,0,2,9,2,10,9,-1,-1,-1,-1,10,9,3,10,3,2,9,4,3,11,3,6,4,6,3,-1,8,2,3,8,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,0,4,2,4,6,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,9,0,2,3,4,2,4,6,4,3,8,-1,-1,-1,-1,1,9,4,1,4,2,2,4,6,-1,-1,-1,-1,-1,-1,-1,8,1,3,8,6,1,8,4,6,6,10,1,-1,-1,-1,-1,10,1,0,10,0,6,6,0,4,-1,-1,-1,-1,-1,-1,-1,4,6,3,4,3,8,6,10,3,0,3,9,10,9,3,-1,10,9,4,6,10,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,5,7,6,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,5,11,7,6,-1,-1,-1,-1,-1,-1,-1,5,0,1,5,4,0,7,6,11,-1,-1,-1,-1,-1,-1,-1,11,7,6,8,3,4,3,5,4,3,1,5,-1,-1,-1,-1,9,5,4,10,1,2,7,6,11,-1,-1,-1,-1,-1,-1,-1,6,11,7,1,2,10,0,8,3,4,9,5,-1,-1,-1,-1,7,6,11,5,4,10,4,2,10,4,0,2,-1,-1,-1,-1,3,4,8,3,5,4,3,2,5,10,5,2,11,7,6,-1,7,2,3,7,6,2,5,4,9,-1,-1,-1,-1,-1,-1,-1,9,5,4,0,8,6,0,6,2,6,8,7,-1,-1,-1,-1,3,6,2,3,7,6,1,5,0,5,4,0,-1,-1,-1,-1,6,2,8,6,8,7,2,1,8,4,8,5,1,5,8,-1,9,5,4,10,1,6,1,7,6,1,3,7,-1,-1,-1,-1,1,6,10,1,7,6,1,0,7,8,7,0,9,5,4,-1,4,0,10,4,10,5,0,3,10,6,10,7,3,7,10,-1,7,6,10,7,10,8,5,4,10,4,8,10,-1,-1,-1,-1,6,9,5,6,11,9,11,8,9,-1,-1,-1,-1,-1,-1,-1,3,6,11,0,6,3,0,5,6,0,9,5,-1,-1,-1,-1,0,11,8,0,5,11,0,1,5,5,6,11,-1,-1,-1,-1,6,11,3,6,3,5,5,3,1,-1,-1,-1,-1,-1,-1,-1,1,2,10,9,5,11,9,11,8,11,5,6,-1,-1,-1,-1,0,11,3,0,6,11,0,9,6,5,6,9,1,2,10,-1,11,8,5,11,5,6,8,0,5,10,5,2,0,2,5,-1,6,11,3,6,3,5,2,10,3,10,5,3,-1,-1,-1,-1,5,8,9,5,2,8,5,6,2,3,8,2,-1,-1,-1,-1,9,5,6,9,6,0,0,6,2,-1,-1,-1,-1,-1,-1,-1,1,5,8,1,8,0,5,6,8,3,8,2,6,2,8,-1,1,5,6,2,1,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,6,1,6,10,3,8,6,5,6,9,8,9,6,-1,10,1,0,10,0,6,9,5,0,5,6,0,-1,-1,-1,-1,0,3,8,5,6,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,10,5,6,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,7,5,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,11,5,10,11,7,5,8,3,0,-1,-1,-1,-1,-1,-1,-1,5,11,7,5,10,11,1,9,0,-1,-1,-1,-1,-1,-1,-1,10,7,5,10,11,7,9,8,1,8,3,1,-1,-1,-1,-1,11,1,2,11,7,1,7,5,1,-1,-1,-1,-1,-1,-1,-1,0,8,3,1,2,7,1,7,5,7,2,11,-1,-1,-1,-1,9,7,5,9,2,7,9,0,2,2,11,7,-1,-1,-1,-1,7,5,2,7,2,11,5,9,2,3,2,8,9,8,2,-1,2,5,10,2,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,8,2,0,8,5,2,8,7,5,10,2,5,-1,-1,-1,-1,9,0,1,5,10,3,5,3,7,3,10,2,-1,-1,-1,-1,9,8,2,9,2,1,8,7,2,10,2,5,7,5,2,-1,1,3,5,3,7,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,8,7,0,7,1,1,7,5,-1,-1,-1,-1,-1,-1,-1,9,0,3,9,3,5,5,3,7,-1,-1,-1,-1,-1,-1,-1,9,8,7,5,9,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,5,8,4,5,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,5,0,4,5,11,0,5,10,11,11,3,0,-1,-1,-1,-1,0,1,9,8,4,10,8,10,11,10,4,5,-1,-1,-1,-1,10,11,4,10,4,5,11,3,4,9,4,1,3,1,4,-1,2,5,1,2,8,5,2,11,8,4,5,8,-1,-1,-1,-1,0,4,11,0,11,3,4,5,11,2,11,1,5,1,11,-1,0,2,5,0,5,9,2,11,5,4,5,8,11,8,5,-1,9,4,5,2,11,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,5,10,3,5,2,3,4,5,3,8,4,-1,-1,-1,-1,5,10,2,5,2,4,4,2,0,-1,-1,-1,-1,-1,-1,-1,3,10,2,3,5,10,3,8,5,4,5,8,0,1,9,-1,5,10,2,5,2,4,1,9,2,9,4,2,-1,-1,-1,-1,8,4,5,8,5,3,3,5,1,-1,-1,-1,-1,-1,-1,-1,0,4,5,1,0,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,8,4,5,8,5,3,9,0,5,0,3,5,-1,-1,-1,-1,9,4,5,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,11,7,4,9,11,9,10,11,-1,-1,-1,-1,-1,-1,-1,0,8,3,4,9,7,9,11,7,9,10,11,-1,-1,-1,-1,1,10,11,1,11,4,1,4,0,7,4,11,-1,-1,-1,-1,3,1,4,3,4,8,1,10,4,7,4,11,10,11,4,-1,4,11,7,9,11,4,9,2,11,9,1,2,-1,-1,-1,-1,9,7,4,9,11,7,9,1,11,2,11,1,0,8,3,-1,11,7,4,11,4,2,2,4,0,-1,-1,-1,-1,-1,-1,-1,11,7,4,11,4,2,8,3,4,3,2,4,-1,-1,-1,-1,2,9,10,2,7,9,2,3,7,7,4,9,-1,-1,-1,-1,9,10,7,9,7,4,10,2,7,8,7,0,2,0,7,-1,3,7,10,3,10,2,7,4,10,1,10,0,4,0,10,-1,1,10,2,8,7,4,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,7,1,3,-1,-1,-1,-1,-1,-1,-1,4,9,1,4,1,7,0,8,1,8,7,1,-1,-1,-1,-1,4,0,3,7,4,3,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,4,8,7,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,9,10,8,10,11,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,11,9,10,-1,-1,-1,-1,-1,-1,-1,0,1,10,0,10,8,8,10,11,-1,-1,-1,-1,-1,-1,-1,3,1,10,11,3,10,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,2,11,1,11,9,9,11,8,-1,-1,-1,-1,-1,-1,-1,3,0,9,3,9,11,1,2,9,2,11,9,-1,-1,-1,-1,0,2,11,8,0,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,3,2,11,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,10,8,9,-1,-1,-1,-1,-1,-1,-1,9,10,2,0,9,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,2,3,8,2,8,10,0,1,8,1,10,8,-1,-1,-1,-1,1,10,2,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,1,3,8,9,1,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,9,1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,0,3,8,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1])}},2314:(e,t,r)=>{const n=new Float32Array(36),o=new Float32Array(8),{edgeTable:a}=r(2518),{triangleTable:i}=r(2518);e.exports=function(e,t,r,s,l,c,d,p,u,m,h,g,f,v,y){let _=0;const x=u*s*l+p*s+d;let b=0;for(o[0]=t[x],o[1]=t[x+1],o[2]=t[x+s*l+1],o[3]=t[x+s*l],o[4]=t[x+s],o[5]=t[x+s+1],o[6]=t[x+s+s*l+1],o[7]=t[x+s+s*l],d=0;d<8;d++)o[d]<r&&(_|=1<<d);const w=a[_];if(0!==w)for(1&w&&(n[0]=m+f*(r-o[0])/(o[1]-o[0]),n[1]=h,n[2]=g),2&w&&(n[3]=m+f,n[4]=h,n[5]=g+y*(r-o[1])/(o[2]-o[1])),4&w&&(n[6]=m+f*(r-o[3])/(o[2]-o[3]),n[7]=h,n[8]=g+y),8&w&&(n[9]=m,n[10]=h,n[11]=g+y*(r-o[0])/(o[3]-o[0])),16&w&&(n[12]=m+f*(r-o[4])/(o[5]-o[4]),n[13]=h+v,n[14]=g),32&w&&(n[15]=m+f,n[16]=h+v,n[17]=g+y*(r-o[5])/(o[6]-o[5])),64&w&&(n[18]=m+f*(r-o[7])/(o[6]-o[7]),n[19]=h+v,n[20]=g+y),128&w&&(n[21]=m,n[22]=h+v,n[23]=g+y*(r-o[4])/(o[7]-o[4])),256&w&&(n[24]=m,n[25]=h+v*(r-o[0])/(o[4]-o[0]),n[26]=g),512&w&&(n[27]=m+f,n[28]=h+v*(r-o[1])/(o[5]-o[1]),n[29]=g),1024&w&&(n[30]=m+f,n[31]=h+v*(r-o[2])/(o[6]-o[2]),n[32]=g+y),2048&w&&(n[33]=m,n[34]=h+v*(r-o[3])/(o[7]-o[3]),n[35]=g+y),_<<=4,d=0;-1!==i[_+d];d++)b=3*i[_+d],e.push(n[b]),e.push(n[b+1]),e.push(n[b+2])}},984:e=>{e.exports={pow10ceil:e=>10**Math.ceil(Math.log10(e)),fmod:(e,t)=>Number((e-Math.floor(e/t)*t).toPrecision(8)),decodeFloat16(e){const t=(31744&e)>>10,r=1023&e;return(e>>15?-1:1)*(t?31===t?r?NaN:1/0:2**(t-15)*(1+r/1024):r/1024*6103515625e-14)}}},2809:e=>{e.exports=function(e,t){const r="object"==typeof t,n=r&&t.hasOwnProperty("type"),o=n&&e.Provider.hasOwnProperty("Objects")&&e.Provider.Objects.hasOwnProperty(t.type);if(!r)throw new Error("Object definition should be a valid javascript object!");if(!n)throw new Error("Object definition should have a `type` attribute set!");if(!o)throw new Error(`Unknown object type (${t.type}) passed, no loader supporting it found!`);return t}},8348:(e,t,r)=>{const n=r(108);e.exports={init:function e(t,r,o,a,i){function s(e){o.length=0,Object.keys(r[a].map).forEach((e=>{if("addNew"!==e){const t=r[a].map[e].obj;o.push([t.x,t.y,t.z,t.constant])}})),e&&t.render(),i(o)}function l(e,r){const{camera:o}=t.getWorld();o.updateMatrixWorld();const a=(new n.Plane).setFromCoplanarPoints(new n.Vector3(-1,-1,-1).unproject(o),new n.Vector3(1,1,-1).unproject(o),new n.Vector3(1,-1,-1).unproject(o));a.constant-=e.obj.camDist,e.obj.x=a.normal.x,e.obj.y=a.normal.y,e.obj.z=a.normal.z,e.obj.constant=a.constant,e.folder.controllers.forEach((e=>{e.updateDisplay()})),s(r)}for(void 0===r[a]&&(r[a]={}),void 0===r[a].count&&(r[a].count=1),void 0===r[a].map&&(r[a].map={},r[a].map.addNew=r.add({addPlane(){o.push([1,0,0,0]),e(t,r,o,a,i),t.render(),i(o)}},"addPlane").name("Add new"));o.length<Object.keys(r[a].map).length-1;){const e=Object.keys(r[a].map).length-1,t=r[a].map[e-1].folder.controllers;t[t.length-1].object.delete(!0)}let c=0;Object.keys(r[a].map).sort().forEach((e=>{"addNew"!==e&&(parseInt(e,10)!==c&&(r[a].map[c]=r[a].map[e],delete r[a].map[e]),c+=1)})),o.forEach((function(e,n){if(void 0===r[a].map[n]){const o={folder:r.addFolder("Plane #"+r[a].count++),obj:{x:e[0],y:e[1],z:e[2],camDist:5e3*t.getWorld().camera.near,constant:e[3]}};r[a].map[n]=o,o.folder.add(o.obj,"x").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"y").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"z").step(.001).onChange(s.bind(this,!0)),o.folder.add(o.obj,"constant").step(.001).onChange(s.bind(this,!0)),o.folder.add({fromCamera(){o.eventId?(o.folder.controllers[4].name("From camera [start]"),t.off(t.events.CAMERA_CHANGE,o.eventId),o.eventId=null):(o.folder.controllers[4].name("From camera [stop]"),o.eventId=t.on(t.events.CAMERA_CHANGE,l.bind(this,o)),l(o,!0))}},"fromCamera").name("From camera [start]"),o.folder.add(o.obj,"camDist").name("Distance").onChange((()=>{o.eventId&&l(o,!0)})),o.folder.controllers[4].domElement.previousSibling.style.width="100%",o.folder.add({delete(e){Object.keys(r[a].map).forEach((e=>{if(o.obj===r[a].map[e].obj){const{folder:n}=r[a].map[e];n.destroy(),o.eventId&&(t.off(t.events.CAMERA_CHANGE,o.eventId),o.eventId=null),delete r[a].map[e]}})),e||s(!0)}},"delete").name("Delete")}else r[a].map[n].obj.x=e[0],r[a].map[n].obj.y=e[1],r[a].map[n].obj.z=e[2],r[a].map[n].obj.constant=e[3],r[a].map[n].folder.controllers.forEach((e=>{e.updateDisplay()}))}))}}},5251:(e,t,r)=>{const n=r(7761),o=r(5843),a=r(1020),i=r(7360),s=r(5321),l={int8:Int8Array,int16:Int16Array,int32:Int32Array,uint8:Uint8Array,uint16:Uint16Array,uint32:Uint32Array,float16:a,float32:Float32Array,float64:Float64Array},c=i.createCodec({preset:!0});function d(e){return function(e){return o.isNumber(e)||"string"==typeof e||"boolean"==typeof e?e:null!==e?void 0!==e.data&&void 0!==e.shape?function(e){return e.compression_level&&e.compression_level>0?{dtype:o.invert(l)[e.data.constructor],compressed_data:n.zlibSync(e.data.buffer,{level:e.compression_level}),shape:e.shape}:{dtype:o.invert(l)[e.data.constructor],data:e.data,shape:e.shape}}(e):Array.isArray(e)?e.reduce(((e,t)=>(e.push(d(t)),e)),[]):Object.keys(e).reduce(((t,r)=>(t[r]=d(e[r]),t)),{}):null}(e)}c.addExtPacker(32,a,(e=>e)),c.addExtUnpacker(32,(e=>a(e.buffer))),e.exports={deserialize:function e(t,r){if(null==t)return null;if("string"==typeof t&&"base64_"===t.substring(0,7)&&(t=i.decode(s.base64ToArrayBuffer(t.substring(7)),{codec:c})),"string"==typeof t||"boolean"==typeof t)return t;if(o.isNumber(t))return t;if(void 0!==t.shape)return function(e){let t;return void 0!==e.data?{data:new l[e.dtype](e.data.buffer),shape:e.shape}:void 0!==e.compressed_data?(t=new l[e.dtype](n.unzlibSync(new Uint8Array(e.compressed_data.buffer)).buffer),console.log(`K3D: Receive: ${t.byteLength} bytes compressed to ${e.compressed_data.byteLength} bytes`),{data:t,shape:e.shape}):e}(t);if(Array.isArray(t))return t.reduce(((t,n)=>(t.push(e(n,r)),t)),[]);let a=!0;const d=Object.keys(t).reduce(((n,o)=>{var i;return i=o,(Number.isNaN(parseFloat(i))||!Number.isFinite(parseFloat(i)))&&(a=!1),n[o]=e(t[o],r),n}),{});return a&&(d.timeSeries=!0),d},serialize:d}},2960:e=>{function t(e,t){if(Array.isArray(t)){const r=3*(Math.abs(t[0])-1),n=3*(Math.abs(t[1])-1);return[(e[r]+e[n])/2,(e[r+1]+e[n+1])/2,(e[r+2]+e[n+2])/2]}const r=3*(Math.abs(t)-1);return[e[r],e[r+1],e[r+2]]}function r(e,t,r,n,o){const a=18*o;t[a]=e[0][0],t[a+1]=e[0][1],t[a+2]=e[0][2],t[a+3]=e[3][0],t[a+4]=e[3][1],t[a+5]=e[3][2],t[a+6]=e[1][0],t[a+7]=e[1][1],t[a+8]=e[1][2],t[a+9]=e[1][0],t[a+10]=e[1][1],t[a+11]=e[1][2],t[a+12]=e[3][0],t[a+13]=e[3][1],t[a+14]=e[3][2],t[a+15]=e[2][0],t[a+16]=e[2][1],t[a+17]=e[2][2];for(let e=0;e<18;e+=3)r[a+e]=n[0],r[a+e+1]=n[1],r[a+e+2]=n[2]}function n(e,n,o,a,i){const s=[],l=[],c=[];let d=0,p=0;const{width:u}=o,{height:m}=o,{length:h}=o,g=[u,m,h],f=e.voxels instanceof Uint8Array,v=Math.max.apply(null,e.size),y=new Array((v+1)*(v+1)).fill(0);let _,x,b,w,M,C,E,S,A,P,z,D,T,k,O,j,I;const L=[e.offset[0]+e.size[0],e.offset[1]+e.size[1],e.offset[2]+e.size[2]],F=[Math.min(L[0]+1,u),Math.min(L[1]+1,m),Math.min(L[2]+1,h)];function V(t,r,n){return[[(t[0]-e.offset[0])/u,(t[1]-e.offset[1])/m,(t[2]-e.offset[2])/h],[(t[0]-e.offset[0]+n[0])/u,(t[1]-e.offset[1]+n[1])/m,(t[2]-e.offset[2]+n[2])/h],[(t[0]-e.offset[0]+r[0]+n[0])/u,(t[1]-e.offset[1]+r[1]+n[1])/m,(t[2]-e.offset[2]+r[2]+n[2])/h],[(t[0]-e.offset[0]+r[0])/u,(t[1]-e.offset[1]+r[1])/m,(t[2]-e.offset[2]+r[2])/h]]}function R(t,r,n,o,a,i,s,l,c){let d,p,u=o;for(d=1;n+d<s[i];d++)for(u+=l[a]-e.offset[a],p=0;p<t;p++)if(r!==c[p+u])return d;return d}function B(t,r,n,o){const a=6*o,i=[0,0,0];i[n]=1,t[a]=(r[0]-e.offset[0])/u,t[a+1]=(r[1]-e.offset[1])/m,t[a+2]=(r[2]-e.offset[2])/h,t[a+3]=(r[0]-e.offset[0]+i[0])/u,t[a+4]=(r[1]-e.offset[1]+i[1])/m,t[a+5]=(r[2]-e.offset[2]+i[2])/h}const N=[1,u,u*m],U=[[1,0,0],[0,1,0],[0,0,1]];for(_=0;_<3;_++)for(x=[0,0,0],b=(_+1)%3,w=(_+2)%3,x[_]=-1+e.offset[_];x[_]<L[_];){let o=!1;for(x[w]=e.offset[w],k=0;x[w]<F[w];x[w]++)for(x[b]=e.offset[b],j=x[0]+u*(x[1]+m*x[2]);x[b]<F[b];x[b]++,k++,j+=N[b])f?(M=x[_]>=0?e.voxels[j]:-1,C=x[_]<g[_]-1?e.voxels[j+N[_]]:-1):(M=x[_]>=0?e.voxels.get(x[0],x[1],x[2]):-1,C=x[_]<g[_]-1?e.voxels.get(x[0]+U[_][0],x[1]+U[_][1],x[2]+U[_][2]):-1),M===C||M>0&&C>0&&!i?y[k]=0:M>0?(y[k]=i&&C>0?[M,C]:M,o=!0):(y[k]=C>0?-C:0,o|=C>0);if(x[_]+=1,o){if(a)for(S=e.offset[w],k=0;S<L[w];S++){for(x[b]=e.offset[b],x[w]=S,0===e.offset[b]&&0!==y[k]&&B(c,x,w,p++),E=e.offset[b];E<F[b]-1;E++,k++)x[b]=E+1,y[k]!==y[k+1]&&B(c,x,w,p++);x[b]=L[b],E===g[b]-1&&0!==y[k]&&B(c,x,w,p++),k+=1}for(S=e.offset[w],k=0;S<L[w];S++){for(E=e.offset[b];E<L[b];)if(O=y[k],O){for(P=1;O===y[k+P]&&E+P<L[b];)P+=1;z=R(P,O,S,k,b,w,L,F,y),x[b]=E,x[w]=S,D=[0,0,0],T=[0,0,0],O>0?(T[w]=z,D[b]=P):(D[w]=z,T[b]=P),r(V(x,D,T),s,l,t(n,y[k]),d++),I=k;for(let t=0;t<z;t++){for(A=0;A<P;A++)y[I+A]=0;I+=F[b]-e.offset[b]}E+=P,k+=P}else E+=1,k+=1;L[b]!==F[b]&&(k+=1)}}}return{offset:e.offset,vertices:s,colors:l,outlines:c}}e.exports={initializeGreedyVoxelMesh:function(e,t,r,o,a){return n.bind(null,e,t,r,o,a)},generateGreedyVoxelMesh:n}},7290:e=>{e.exports=function(e,t,r,n){let o=0;!function a(){const i=Math.min(o+t,e);for(;o<i;++o)r.call(null,o);o<e?setTimeout(a,0):void 0!==n&&n.call(null)}()}},1847:(e,t,r)=>{const{viewModes:n}=r(7861),o={translate:"translate",scale:"scale",rotate:"rotate"};e.exports={refreshManipulateGUI(e,t){t.controls.controllers.forEach((t=>{"manipulateMode"===t.property&&(t.domElement.hidden=e.parameters.viewMode!==n.manipulate,t.updateDisplay())}))},manipulateGUI(e,t,r){e.add(t.parameters,"manipulateMode",{Translate:o.translate,Rotate:o.rotate,Scale:o.scale}).name("Manipulate mode").onChange((e=>{t.setManipulateMode(e),r("manipulate_mode",e)}))},manipulateModes:o}},9513:e=>{function t(e,t,r,n,o){const a={};a[r]=n,"name"!==r&&e.reload(t,a,o),e.dispatch(e.events.OBJECT_CHANGE,{id:t.id,key:r,value:n})}e.exports={update:function(e,r,n,o){function a(e,t,r,n,o,a){const i=e.add(t,r,n,o,a);return e.controllersMap[r]=i,i}function i(e,t,r){const n=e.addColor(t,r);return e.controllersMap[r]=n,n}function s(t){const n=e.gui_map[r.id];let o,a,i;if("color_range"===t){if(a=n.controllersMap[`_${t}_low`],i=n.controllersMap[`_${t}_high`],void 0!==a)return[a,i]}else if(o=n.controllersMap[t],void 0!==o)return[o];return[]}if(!n)return;if(void 0===e.gui_map&&(e.gui_map={}),void 0===e.gui_groups&&(e.gui_groups={}),void 0===e.gui_counts&&(e.gui_counts={}),void 0===e.gui_map[r.id]){let t;e.gui_counts[r.type]=e.gui_counts[r.type]+1||1,null===r.group?t=n:(void 0===e.gui_groups[r.group]&&(e.gui_groups[r.group]=n.addFolder(`${r.group}`).close()),t=e.gui_groups[r.group]),e.gui_map[r.id]=t.addFolder(`${r.type} #${e.gui_counts[r.type]}`).close(),e.gui_map[r.id].controllersMap={},e.gui_map[r.id].listenersId=e.on(e.events.OBJECT_REMOVED,(t=>{if(t===r.id.toString()){const{listenersId:t}=e.gui_map[r.id];e.gui_map[r.id].destroy(),null!==r.group&&e.gui_groups[r.group]&&0===e.gui_groups[r.group].children.length&&(e.gui_groups[r.group].destroy(),delete e.gui_groups[r.group]),delete e.gui_map[r.id],e.off(e.events.OBJECT_REMOVED,t)}}))}const l=["visible","outlines","wireframe","flat_shading","use_head","head_size","line_width","scale","font_size","font_weight","size","point_size","level","samples","alpha_coef","gradient_step","shadow_delay","focal_length","focal_plane","on_top","max_length","label_box","is_html"],c=l.concat(["color","origin_color","origin_color","head_color","outlines_color","text","shader","shadow_res","shadow","ray_samples_count","width","radial_segments","mesh_detail","opacity","color_range","name","group","color_map","mode"]);if((o&&Object.keys(o)||Object.keys(r)).forEach((function(o){let d,p;if(-1!==c.indexOf(o)&&("name"===o&&(null===r.name?(r.name=`${r.type} #${e.gui_counts[r.type]}`,e.gui_map[r.id].title(r.name),t(e,r,"name",r.name)):e.gui_map[r.id].title(r.name)),"group"===o&&function(t){let r;null!=t.group?(void 0===e.gui_groups[t.group]&&(e.gui_groups[t.group]=n.addFolder(`${t.group}`).close()),r=e.gui_groups[t.group]):r=n,e.gui_map[t.id].parent.children.splice(e.gui_map[t.id].parent.children.indexOf(e.gui_map[t.id]),1),e.gui_map[t.id].parent.folders.splice(e.gui_map[t.id].parent.folders.indexOf(e.gui_map[t.id]),1),e.gui_map[t.id].parent=r,e.gui_map[t.id].parent.$children.append(e.gui_map[t.id].domElement),-1===r.children.indexOf(e.gui_map[t.id])&&r.children.push(e.gui_map[t.id]),-1===r.folders.indexOf(e.gui_map[t.id])&&r.folders.push(e.gui_map[t.id]),Object.keys(e.gui_groups).forEach((t=>{0===e.gui_groups[t].children.length&&(e.gui_groups[t].destroy(),delete e.gui_groups[t])}))}(r),"color_range"===o&&2===r[o].length&&(r[`_${o}_low`]=r[o][0],r[`_${o}_high`]=r[o][1],d=s("colorLegend"),0===d.length&&(r.colorLegend=e.parameters.colorbarObjectId===r.id,a(e.gui_map[r.id],r,"colorLegend").onChange((t=>{r.colorLegend=t,t?e.setColorMapLegend(r):e.setColorMapLegend(0)})))),r.colorLegend=e.parameters.colorbarObjectId===r.id,"color_map"!==o&&"color_range"!==o||r.colorLegend&&e.setColorMapLegend(r),!function(e){const t=s(e);return t.forEach((e=>{e.object=r,e.updateDisplay()})),t.length>0}(o)&&(-1===l.indexOf(o)||r[o].timeSeries||a(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o)),"color"===o&&(-1===["Line","Points","VectorField","Vectors"].indexOf(r.type)?i(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o)):-1!==["Points","VectorField","Vectors"].indexOf(r.type)?void 0!==r.colors&&0!==r.colors.length||i(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o)):"Line"===r.type&&(void 0!==r.colors&&0!==r.colors.length||void 0!==r.attribute&&0!==r.attribute.length||void 0!==r.color_range&&0!==r.colors.color_range||void 0!==r.color_map&&0!==r.colors.color_map||i(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o)))),null===r[o]||!r[o].timeSeries)))switch(o){case"origin_color":case"head_color":void 0===r.colors&&i(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o));break;case"outlines_color":i(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o));break;case"text":"STL"===r.type||Array.isArray(r.text)||a(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o));break;case"shader":"Points"===r.type&&a(e.gui_map[r.id],r,o,["3dSpecular","3d","flat","mesh","dot"]).onChange(t.bind(this,e,r,o)),"Lines"!==r.type&&"Line"!==r.type||a(e.gui_map[r.id],r,o,["simple","thick","mesh"]).onChange(t.bind(this,e,r,o));break;case"mode":"Label"===r.type&&a(e.gui_map[r.id],r,o,["dynamic","local","side"]).onChange(t.bind(this,e,r,o));break;case"shadow_res":"Volume"===r.type&&a(e.gui_map[r.id],r,o,[32,64,128,256,512]).onChange(t.bind(this,e,r,o));break;case"shadow":"Volume"===r.type&&a(e.gui_map[r.id],r,o,["off","on_demand","dynamic"]).onChange(t.bind(this,e,r,o));break;case"ray_samples_count":"Volume"===r.type&&a(e.gui_map[r.id],r,o,[8,16,32,64]).onChange(t.bind(this,e,r,o));break;case"width":"Line"!==r.type&&"Lines"!==r.type||"mesh"!==r.shader||a(e.gui_map[r.id],r,o).onChange(t.bind(this,e,r,o));break;case"radial_segments":a(e.gui_map[r.id],r,o,0,64,1).name("radialSeg").onChange(t.bind(this,e,r,o));break;case"mesh_detail":"mesh"===r.shader&&a(e.gui_map[r.id],r,o,0,12,1).name("meshDetail").onChange(t.bind(this,e,r,o));break;case"opacity":r[o].timeSeries||a(e.gui_map[r.id],r,o,0,1).name("opacity").onChange(t.bind(this,e,r,o));break;case"color_range":2===r[o].length&&(p=a(e.gui_map[r.id],r,`_${o}_low`).name("vmin").onChange((n=>{r.color_range[0]=n,t(e,r,"color_range",r.color_range)})),p.initialValue<20&&(p._step=.1),p=a(e.gui_map[r.id],r,`_${o}_high`).name("vmax").onChange((n=>{r.color_range[1]=n,t(e,r,"color_range",r.color_range)})),p.initialValue<20&&(p._step=.1))}})),"Volume"===r.type&&0===s("refreshLightMap").length){const t={refreshLightMap(){e.getObjectById(r.id).refreshLightMap(),e.render()}};a(e.gui_map[r.id],t,"refreshLightMap").name("Refresh light map")}},changeParameter:t}},7602:e=>{e.exports=function(e,t){const r={resetCamera(){t.getWorld().setCameraToFitScene(!0),t.getWorld().render()}};e.add(r,"resetCamera").name("Reset camera")}},3949:(e,t,r)=>{const n=r(4126),o=r(9765);function a(e,t,r){return new Promise(((n,a)=>{const i=document.createElement("canvas"),s=i.getContext("2d"),l=document.createElement("canvas"),{clearColor:c}=e.parameters,d=e.getWorld(),p=d.renderer.domElement;let u,m;if(m=(new Date).getTime(),i.width=Math.floor(p.width*t),l.width=Math.floor(p.width*t),i.height=Math.floor(p.height*t),l.height=Math.floor(p.height*t),e.heavyOperationAsync=!0,e.labels=[],e.dispatch(e.events.BEFORE_RENDER),c>=0&&(s.fillStyle=`rgb(${(16711680&c)>>16},${(65280&c)>>8},${255&c})`,s.fillRect(0,0,i.width,i.height)),r)u=Promise.resolve();else{const r=document.getElementsByTagName("style");let n="";for(let e=0;e<r.length;e++)n+=r[e].outerHTML;u=o.drawHTML(`<style>body{margin:0;}</style>\n                ${n}\n                ${d.overlayDOMNode.outerHTML}\n                ${e.colorMapNode?e.colorMapNode.outerHTML:""}`,l,{zoom:t})}e.heavyOperationAsync=!0,u.then((t=>{console.log("K3D: Screenshot [html]: "+((new Date).getTime()-m)/1e3,"s"),m=(new Date).getTime(),d.renderOffScreen(i.width,i.height).then((r=>{console.log("K3D: Screenshot [canvas]: "+((new Date).getTime()-m)/1e3,"s"),m=(new Date).getTime(),s.scale(1,-1),r.forEach((e=>{const t=new ImageData(e,i.width,i.height),r=document.createElement("canvas"),n=r.getContext("2d");r.width=t.width,r.height=t.height,n.putImageData(t,0,0),s.drawImage(r,0,0,i.width,-i.height)})),t&&(s.scale(1,-1),s.drawImage(l,0,0)),e.heavyOperationAsync=!1,n(i)}))}),(e=>{a(e)}))}))}e.exports={screenshotGUI:function(e,t){const r={screenshot(){a(t,t.parameters.screenshotScale).then((e=>{e.toBlob((e=>{let r=`K3D-${Date.now()}.png`;t.parameters.name&&(r=`${t.parameters.name}.png`),n.saveAs(e,r)}))}),(()=>{console.error("Failed to render screenshot.")}))}};e.add(r,"screenshot").name("Screenshot")},getScreenshot:a}},52:(e,t,r)=>{const n=r(4126),o=r(7761),a=r(1282),i=r(667),s=r(6150),l=r(7546),c=r(2656),d=r(2497),p=r(5527).version,u=r(5321);let m=window.k3dCompressed;const h=document.getElementsByTagName("script");let g;if(void 0===m){m="";for(let e=0;e<h.length;e++)h[e].getAttribute("src")&&h[e].getAttribute("src").includes("k3d")&&h[e].getAttribute("src").includes(".js")&&(g=h[e].getAttribute("src"));g=void 0!==g?g.replace("k3d.js","standalone.js").replace("index.js","standalone.js"):`https://unpkg.com/k3d@${p}/dist/standalone.js`,s(g,(e=>{e=o.strToU8(e),m=u.arrayBufferToBase64(o.zlibSync(e))}))}function f(e,t){e.heavyOperationSync=!0;const r=u.arrayBufferToBase64(e.getSnapshot(t));let n;const o=(new Date).toUTCString();return"full"===e.parameters.snapshotType?(n=l,n=n.split("[REQUIRE_JS]").join(a),n=n.split("[FFLATE_JS]").join(i),n=n.split("[K3D_SOURCE]").join(m)):"online"===e.parameters.snapshotType?(n=c,n=n.split("[VERSION]").join(e.parameters.guiVersion)):"inline"===e.parameters.snapshotType&&(n=d,n=n.split("[ID]").join(Math.floor(1e9*Math.random())),n=n.split("[HEIGHT]").join(e.parameters.height||512),n=n.split("[VERSION]").join(e.parameters.guiVersion)),n=n.split("[DATA]").join(r),n=n.split("[TIMESTAMP]").join(o),n=n.split("[ADDITIONAL]").join("//[ADDITIONAL]"),n}function v(e,t){const{files:r}=t.dataTransfer,n=new FileReader,a=new FileReader,i=new FileReader;if(t.stopPropagation(),t.preventDefault(),n.onload=function(t){const r=e.extractSnapshot(t.target.result);r[1]&&e.setSnapshot(r[1])},a.onload=function(t){e.setSnapshot(o.unzlibSync(t.target.result))},i.onload=function(t){const r=t.target.result;e.load({objects:[{type:"STL",model_matrix:{data:[1,0,0,0,0,1,0,0,0,0,1,0,0,0,0,1]},binary:r,visible:!0,color:255,wireframe:!1,flat_shading:!1}]})},r.length>0){if("html"===r[0].name.substr(-4).toLowerCase())return void n.readAsText(r[0]);if("stl"===r[0].name.substr(-3).toLowerCase())return void i.readAsArrayBuffer(r[0]);a.readAsArrayBuffer(r[0])}}function y(e){e.stopPropagation(),e.preventDefault(),e.dataTransfer.dropEffect="copy"}e.exports={snapshotGUI:function(e,t){const r={snapshot(){let e=f(t,9),r=`K3D-snapshot-${Date.now()}.html`;t.parameters.name&&(r=`${t.parameters.name}.html`),e=new Blob([e],{type:"text/plain;charset=utf-8"}),n.saveAs(e,r)}};e.add(r,"snapshot").name("Snapshot HTML");const o=t.getWorld().targetDOMNode;o.addEventListener("dragover",y,!1),o.addEventListener("drop",v.bind(null,t),!1)},getHTMLSnapshot:f}},227:(e,t,r)=>{const n=r(108),o=r(5843),{pow10ceil:a}=r(984);function i(e){let t=0,r=0;const n=e.getWorld(),o=[];return Object.keys(n.ObjectsListJson).forEach((e=>{const a=n.ObjectsListJson[e];let i=!1;Object.keys(a).forEach((e=>{a[e]&&void 0!==a[e].timeSeries&&(i=!0,Object.keys(a[e]).forEach((e=>{Number.isNaN(parseFloat(e))||(t=Math.min(t,parseFloat(e)),r=Math.max(r,parseFloat(e)))})))})),i&&o.push(a)})),Object.keys(e.parameters.cameraAnimation).forEach((e=>{e=parseFloat(e),Number.isNaN(e)||(t=Math.min(t,e),r=Math.max(r,e))})),{min:t,max:r,objects:o}}function s(e,t,r,a){let i,s,l,c;if("model_matrix"===a){const o=new n.Matrix4,a=new n.Vector3,i=new n.Quaternion,s=new n.Vector3,l=new n.Vector3,c=new n.Quaternion,d=new n.Vector3;o.set.apply(o,e.data),o.decompose(a,i,s),o.set.apply(o,t.data),o.decompose(l,c,d),a.lerp(l,r),i.slerp(c,r),s.lerp(d,r),o.compose(a,i,s);const p=o.toArray();return{data:new Float32Array([p[0],p[4],p[8],p[12],p[1],p[5],p[9],p[13],p[2],p[6],p[10],p[14],p[3],p[7],p[11],p[15]]),shape:e.shape}}if("string"==typeof e)return r>.5?t:e;if("boolean"==typeof e)return r>.5?t:e;if(o.isNumber(e))return e+r*(t-e);if(e.data){if(l=Math.min(e.data.length,t.data.length),c=Math.max(e.data.length,t.data.length),s=new e.data.constructor(c),"colors"===a)for(i=0;i<l;i++){let n=255&e.data[i],o=255&t.data[i],a=e.data[i]>>8&255,l=t.data[i]>>8&255,c=e.data[i]>>16&255,d=t.data[i]>>16&255,p=Math.round(n+r*(o-n)),u=Math.round(a+r*(l-a)),m=Math.round(c+r*(d-c));s[i]=m<<16|u<<8|p}else for(i=0;i<l;i++)s[i]=e.data[i]+r*(t.data[i]-e.data[i]);if(l!==c)for(i=l;i<c;i++)s[i]=e.data[i]||t.data[i];return{data:s,shape:e.shape}}for(l=Math.min(e.length,t.length),c=Math.max(e.length,t.length),s=Array(c),i=0;i<s.length;i++)s[i]=e[i]+r*(t[i]-e[i]);if(l!==c)for(i=l;i<c;i++)s[i]=e[i]||t[i];return s}function l(e,t){let r=null,n=-1;e.autoPlayed||(e.autoPlayed=!0,requestAnimationFrame((function o(a){if(!e.autoPlayed)return;null===r&&(r=a-1e3*e.parameters.time);let i=(a-r)/1e3;const s=Math.round(i*e.parameters.fps);s!==n&&(i>e.GUI.controls.controllersMap.time._max&&(i-=e.GUI.controls.controllersMap.time._max,r=a+i),e.setTime(i),n=s,t("time",i)),requestAnimationFrame(o)})),e.GUI.controls.controllersMap.autoPlay.name("Stop loop"))}function c(e){e.autoPlayed&&(e.autoPlayed=!1,e.GUI.controls.controllersMap.autoPlay.name("Play loop"))}e.exports={refreshTimeScale(e,t){const r=i(e);t.controls.controllers.forEach((e=>{"time"===e.property&&e.min(r.min).max(r.max).step(a(r.max-r.min)/1e4),-1!==["togglePlay","fps","time"].indexOf(e.property)&&(e.domElement.hidden=r.min===r.max,e.updateDisplay())}))},interpolateTimeSeries(e,t){const r={},n={};return Object.keys(e).forEach((a=>{let i,l,c,d,p;if(e[a]&&void 0!==e[a].timeSeries){if(i=Object.keys(e[a]).reduce(((e,t)=>(Number.isNaN(parseFloat(t))||e.push({v:parseFloat(t),k:t}),e)),[]).sort(((e,t)=>e.v-t.v)),t<=i[0].v)r[a]=e[a][i[0].k];else if(t>=i[i.length-1].v)r[a]=e[a][i[i.length-1].k];else for(d=0;d<i.length;d++){if(Math.abs(i[d].v-t)<.001){r[a]="object"==typeof(u=e[a][i[d].k])?u.data?{data:u.data.slice(0),shape:u.shape}:o.cloneDeep(u):u;break}if(i[d].v>t&&d>0){l=i[d-1].v,c=i[d].v,p=(t-l)/(c-l),r[a]=s(e[a][i[d-1].k],e[a][i[d].k],p,a);break}}n[a]=r[a]}else r[a]=e[a];var u})),{json:r,changes:n}},getObjectsWithTimeSeriesAndMinMax:i,timeSeriesGUI(e,t,r){const n={togglePlay(){t.autoPlayed?c(t):l(t,r)}};e.controllersMap=e.controllersMap||{},e.controllersMap.time=e.add(t.parameters,"time").min(0).max(1).name("time").onChange((e=>{t.setTime(e),r("time",e)})),e.controllersMap.fps=e.add(t.parameters,"fps").min(0).max(120).name("fps").onChange((e=>{r("fps",e)})),e.controllersMap.autoPlay=e.add(n,"togglePlay").name("Play loop")},startAutoPlay:l,stopAutoPlay:c}},7861:e=>{const t={view:"view",add:"add",change:"change",callback:"callback",manipulate:"manipulate"};e.exports={viewModeGUI:function(e,r){e.add(r.parameters,"viewMode",{View:t.view,Add:t.add,Change:t.change,Callback:t.callback,Manipulate:t.manipulate}).name("Mode").onChange((e=>{r.setViewMode(e),r.dispatch(r.events.PARAMETERS_CHANGE,{key:"mode",value:e})}))},viewModes:t}},1772:(e,t,r)=>{const n=r(5843);e.exports=n.extend({},r(6215)),e.exports.version=r(5527).version},6215:(e,t,r)=>{const n=r(2187),o=r(5843),a=r(7723),i=r(4872),s=r(5251),l=r(7203),c=r(9452).CreateK3DAndLoadBinarySnapshot,{viewModes:d}=r(7861),p=r(5527).version,u={},m={},h=[];function g(e,t){h.forEach((r=>{-1!==r.model.get("object_ids").indexOf(e)&&t(r,r.K3DInstance.getObjectById(e))}))}class f extends n.WidgetModel{static serializers={...n.WidgetModel.serializers,voxels:s,coord:s};defaults(){return{...super.defaults(),_model_name:"ChunkModel",_model_module:"k3d",_model_module_version:p}}initialize(){const e=arguments[0];n.WidgetModel.prototype.initialize.apply(this,arguments),this.on("change",this._change,this),m[e.id]=this}_change(){const e=this.attributes;Object.keys(u).forEach((t=>{"VoxelsGroup"===u[t].attributes.type&&g(u[t].attributes.id,((t,r)=>{r.updateChunk(e)}))}))}}class v extends n.WidgetModel{static serializers={...n.WidgetModel.serializers,model_matrix:s,positions:s,scalar_field:s,alpha_coef:s,shadow:s,shadow_res:s,shadow_delay:s,ray_samples_count:s,focal_plane:s,focal_length:s,gradient_step:s,color_map:s,samples:s,color_range:s,attribute:s,triangles_attribute:s,vertices:s,indices:s,normals:s,colors:s,origins:s,vectors:s,opacity:s,opacities:s,point_sizes:s,point_size:s,width:s,shader:s,wireframe:s,radial_segments:s,color:s,flat_shading:s,heights:s,mesh_detail:s,voxels:s,voxels_group:s,sparse_voxels:s,space_size:s,volume:s,opacity_function:s,text:s,texture:s,binary:s,size:s,position:s,puv:s,visible:s,uvs:s,volume_bounds:s,spacings_x:s,spacings_y:s,spacings_z:s,mask:s,mask_opacities:s};defaults(){return{...super.defaults(),_model_name:"ObjectModel",_view_name:"ObjectView",_model_module:"k3d",_view_module:"k3d",_model_module_version:p,_view_module_version:p}}initialize(){const e=arguments[0];n.WidgetModel.prototype.initialize.apply(this,arguments),this.on("change",this._change,this),this.on("msg:custom",(function(e){let t;"fetch"===e.msg_type&&(t=this.get(e.field),o.isObject(t)&&(t.t=Math.random()),t.data&&t.shape&&(t.compression_level=this.attributes.compression_level),this.save(e.field,t)),"shadow_map_update"===e.msg_type&&"Volume"===this.get("type")&&g(this.get("id"),((t,r)=>{r&&r.refreshLightMap&&(r.refreshLightMap(e.direction),t.K3DInstance.render())}))}),this),u[e.id]=this}_change(e){h.forEach((function(t){t.refreshObject(this,e.changed)}),this)}}const y=n.WidgetView.extend({});class _ extends n.DOMWidgetModel{defaults(){return{...super.defaults(),_model_name:"PlotModel",_view_name:"PlotView",_model_module:"k3d",_view_module:"k3d",_model_module_version:p,_view_module_version:p}}}class x extends n.DOMWidgetView{render(){const e=window.document.createElement("div"),t=window.document.createElement("div");e.style.cssText=[`height:${this.model.get("height")}px`,"position: relative"].join(";"),t.style.cssText=["width: 100%","height: 100%","position: relative"].join(";"),e.appendChild(t),this.el.appendChild(e),this.container=t,this.on("displayed",this._init,this)}remove(){o.pull(h,this),this.K3DInstance.off(this.K3DInstance.events.CAMERA_CHANGE,this.cameraChangeId),this.K3DInstance.off(this.K3DInstance.events.OBJECT_CHANGE,this.GUIObjectChanges),this.K3DInstance.off(this.K3DInstance.events.PARAMETERS_CHANGE,this.GUIParametersChanges),this.K3DInstance.off(this.K3DInstance.events.VOXELS_CALLBACK,this.voxelsCallback),this.K3DInstance.off(this.K3DInstance.events.OBJECT_HOVERED,this.objectHoverCallback),this.K3DInstance.off(this.K3DInstance.events.OBJECT_CLICKED,this.objectClickCallback)}_init(){const e=this;this.renderPromises=[],h.push(this),this.model.lastCameraSync=(new Date).getTime(),this.model.on("msg:custom",(function(t){const{model:r}=this;"fetch_screenshot"===t.msg_type&&this.K3DInstance.getScreenshot(this.K3DInstance.parameters.screenshotScale,t.only_canvas).then((e=>{const t=e.toDataURL().split(",")[1];r.save("screenshot",t,{patch:!0})})),"fetch_snapshot"===t.msg_type&&r.save("snapshot",this.K3DInstance.getHTMLSnapshot(t.compression_level),{patch:!0}),"start_auto_play"===t.msg_type&&this.K3DInstance.startAutoPlay(),"stop_auto_play"===t.msg_type&&this.K3DInstance.stopAutoPlay(),"reset_camera"===t.msg_type&&this.K3DInstance.resetCamera(t.factor),"render"===t.msg_type&&(0===e.renderPromises.length?e.K3DInstance.refreshAfterObjectsChange(!1,!0):Promise.all(e.renderPromises).then((t=>{e.K3DInstance.refreshAfterObjectsChange(!1,!0),t.length===e.renderPromises.length&&(e.renderPromises=[])})))}),this),this.model.on("change:camera_auto_fit",this._setCameraAutoFit,this),this.model.on("change:lighting",this._setDirectionalLightingIntensity,this),this.model.on("change:time",this._setTime,this),this.model.on("change:grid_auto_fit",this._setGridAutoFit,this),this.model.on("change:grid_visible",this._setGridVisible,this),this.model.on("change:grid_color",this._setGridColor,this),this.model.on("change:label_color",this._setLabelColor,this),this.model.on("change:fps_meter",this._setFpsMeter,this),this.model.on("change:fps",this._setFps,this),this.model.on("change:screenshot_scale",this._setScreenshotScale,this),this.model.on("change:voxel_paint_color",this._setVoxelPaintColor,this),this.model.on("change:background_color",this._setBackgroundColor,this),this.model.on("change:grid",this._setGrid,this),this.model.on("change:auto_rendering",this._setAutoRendering,this),this.model.on("change:camera",this._setCamera,this),this.model.on("change:camera_animation",this._setCameraAnimation,this),this.model.on("change:clipping_planes",this._setClippingPlanes,this),this.model.on("change:object_ids",this._onObjectsListChange,this),this.model.on("change:menu_visibility",this._setMenuVisibility,this),this.model.on("change:colorbar_object_id",this._setColorMapLegend,this),this.model.on("change:colorbar_scientific",this._setColorbarScientific,this),this.model.on("change:rendering_steps",this._setRenderingSteps,this),this.model.on("change:axes",this._setAxes,this),this.model.on("change:camera_no_rotate",this._setCameraLock,this),this.model.on("change:camera_no_zoom",this._setCameraLock,this),this.model.on("change:camera_no_pan",this._setCameraLock,this),this.model.on("change:camera_rotate_speed",this._setCameraSpeeds,this),this.model.on("change:camera_zoom_speed",this._setCameraSpeeds,this),this.model.on("change:camera_pan_speed",this._setCameraSpeeds,this),this.model.on("change:camera_fov",this._setCameraFOV,this),this.model.on("change:camera_damping_factor",this._setCameraDampingFactor,this),this.model.on("change:axes_helper",this._setAxesHelper,this),this.model.on("change:axes_helper_colors",this._setAxesHelperColors,this),this.model.on("change:snapshot_type",this._setSnapshotType,this),this.model.on("change:name",this._setName,this),this.model.on("change:mode",this._setViewMode,this),this.model.on("change:minimum_fps",this._setMinimumFps,this),this.model.on("change:camera_mode",this._setCameraMode,this),this.model.on("change:manipulate_mode",this._setManipulateMode,this);try{this.K3DInstance=new a(l,this.container,{antialias:this.model.get("antialias"),logarithmicDepthBuffer:this.model.get("logarithmic_depth_buffer"),lighting:this.model.get("lighting"),cameraMode:this.model.get("camera_mode"),snapshotType:this.model.get("snapshot_type"),backendVersion:this.model.get("_backend_version"),screenshotScale:this.model.get("screenshot_scale"),menuVisibility:this.model.get("menu_visibility"),cameraAutoFit:this.model.get("camera_auto_fit"),cameraNoRotate:this.model.get("camera_no_rotate"),cameraNoZoom:this.model.get("camera_no_zoom"),cameraNoPan:this.model.get("camera_no_pan"),cameraRotateSpeed:this.model.get("camera_rotate_speed"),cameraZoomSpeed:this.model.get("camera_zoom_speed"),cameraPanSpeed:this.model.get("camera_pan_speed"),cameraDampingFactor:this.model.get("camera_damping_factor"),cameraFov:this.model.get("camera_fov"),colorbarObjectId:this.model.get("colorbar_object_id"),cameraAnimation:this.model.get("camera_animation"),name:this.model.get("name"),axes:this.model.get("axes"),axesHelper:this.model.get("axes_helper"),grid:this.model.get("grid"),fps:this.model.get("fps"),autoRendering:this.model.get("auto_rendering"),gridVisible:this.model.get("grid_visible"),gridColor:this.model.get("grid_color"),gridAutoFit:this.model.get("grid_auto_fit"),clippingPlanes:this.model.get("clipping_planes"),labelColor:this.model.get("label_color"),voxelPaintColor:this.model.get("voxel_paint_color")}),!1===this.model.get("camera_auto_fit")&&this.K3DInstance.setCamera(this.model.get("camera"))}catch(e){return void console.log(e)}this.K3DInstance.setClearColor(this.model.get("background_color")),this.K3DInstance.setChunkList(m),this.model.get("object_ids").forEach((function(e){this.renderPromises.push(this.K3DInstance.load({objects:[u[e].attributes]}))}),this),this.cameraChangeId=this.K3DInstance.on(this.K3DInstance.events.CAMERA_CHANGE,(t=>{e.model._comm_live&&(new Date).getTime()-e.model.lastCameraSync>200&&(e.model.lastCameraSync=(new Date).getTime(),e.model.save("camera",t,{patch:!0}))})),this.GUIObjectChanges=this.K3DInstance.on(this.K3DInstance.events.OBJECT_CHANGE,(t=>{e.model._comm_live&&(t.value.data&&t.value.shape&&(t.value.compression_level=u[t.id].attributes.compression_level),u[t.id]&&u[t.id].save(t.key,t.value,{patch:!0}))})),this.GUIParametersChanges=this.K3DInstance.on(this.K3DInstance.events.PARAMETERS_CHANGE,(t=>{e.model.save(t.key,t.value,{patch:!0})})),this.voxelsCallback=this.K3DInstance.on(this.K3DInstance.events.VOXELS_CALLBACK,(e=>{u[e.object.K3DIdentifier]&&u[e.object.K3DIdentifier].send({msg_type:"click_callback",coord:e.coord})})),this.objectHoverCallback=this.K3DInstance.on(this.K3DInstance.events.OBJECT_HOVERED,(e=>{u[e.K3DIdentifier]&&this.K3DInstance.parameters.viewMode===d.callback&&u[e.K3DIdentifier].send(o.extend({msg_type:"hover_callback"},e))})),this.objectClickCallback=this.K3DInstance.on(this.K3DInstance.events.OBJECT_CLICKED,(e=>{u[e.K3DIdentifier]&&this.K3DInstance.parameters.viewMode===d.callback&&u[e.K3DIdentifier].send(o.extend({msg_type:"click_callback"},e))}))}_setDirectionalLightingIntensity(){this.K3DInstance.setDirectionalLightingIntensity(this.model.get("lighting"))}_setTime(){this.K3DInstance.parameters.time!==this.model.get("time")&&this.renderPromises.push(this.K3DInstance.setTime(this.model.get("time")))}_setCameraAutoFit(){this.K3DInstance.setCameraAutoFit(this.model.get("camera_auto_fit"))}_setGridAutoFit(){this.K3DInstance.setGridAutoFit(this.model.get("grid_auto_fit"))}_setGridVisible(){this.K3DInstance.setGridVisible(this.model.get("grid_visible"))}_setGridColor(){this.K3DInstance.setGridColor(this.model.get("grid_color"))}_setLabelColor(){this.K3DInstance.setLabelColor(this.model.get("label_color"))}_setFps(){this.K3DInstance.setFps(this.model.get("fps"))}_setFpsMeter(){this.K3DInstance.setFpsMeter(this.model.get("fps_meter"))}_setScreenshotScale(){this.K3DInstance.setScreenshotScale(this.model.get("screenshot_scale"))}_setVoxelPaintColor(){this.K3DInstance.setVoxelPaint(this.model.get("voxel_paint_color"))}_setBackgroundColor(){this.K3DInstance.setClearColor(this.model.get("background_color"))}_setGrid(){this.K3DInstance.setGrid(this.model.get("grid"))}_setAutoRendering(){this.K3DInstance.setAutoRendering(this.model.get("auto_rendering"))}_setMenuVisibility(){this.K3DInstance.setMenuVisibility(this.model.get("menu_visibility"))}_setColorMapLegend(){this.K3DInstance.setColorMapLegend(this.model.get("colorbar_object_id"))}_setColorbarScientific(){this.K3DInstance.setColorbarScientific(this.model.get("colorbar_scientific"))}_setCamera(){this.K3DInstance.setCamera(this.model.get("camera"))}_setCameraAnimation(){this.K3DInstance.setCameraAnimation(this.model.get("camera_animation"))}_setRenderingSteps(){this.K3DInstance.setRenderingSteps(this.model.get("rendering_steps"))}_setAxes(){this.K3DInstance.setAxes(this.model.get("axes"))}_setName(){this.K3DInstance.setName(this.model.get("name"))}_setViewMode(){this.K3DInstance.setViewMode(this.model.get("mode"))}_setMinimumFps(){this.K3DInstance.setMinimumFps(this.model.get("minimum_fps"))}_setCameraMode(){this.K3DInstance.setCameraMode(this.model.get("camera_mode"))}_setManipulateMode(){this.K3DInstance.setManipulateMode(this.model.get("manipulate_mode"))}_setAxesHelper(){this.K3DInstance.setAxesHelper(this.model.get("axes_helper"))}_setAxesHelperColors(){this.K3DInstance.setAxesHelperColors(this.model.get("axes_helper_colors"))}_setSnapshotType(){this.K3DInstance.setSnapshotType(this.model.get("snapshot_type"))}_setCameraLock(){this.K3DInstance.setCameraLock(this.model.get("camera_no_rotate"),this.model.get("camera_no_zoom"),this.model.get("camera_no_pan"))}_setCameraSpeeds(){this.K3DInstance.setCameraSpeeds(this.model.get("camera_rotate_speed"),this.model.get("camera_zoom_speed"),this.model.get("camera_pan_speed"))}_setCameraFOV(){this.K3DInstance.setCameraFOV(this.model.get("camera_fov"))}_setCameraDampingFactor(){this.K3DInstance.setCameraDampingFactor(this.model.get("camera_damping_factor"))}_setClippingPlanes(){this.K3DInstance.setClippingPlanes(this.model.get("clipping_planes"))}_onObjectsListChange(){const e=this.model.previous("object_ids"),t=this.model.get("object_ids");o.difference(e,t).forEach((function(e){this.renderPromises.push(this.K3DInstance.removeObject(e))}),this),o.difference(t,e).forEach((function(e){this.renderPromises.push(this.K3DInstance.load({objects:[u[e].attributes]}))}),this)}refreshObject(e,t){-1!==this.model.get("object_ids").indexOf(e.get("id"))&&this.renderPromises.push(this.K3DInstance.reload(u[e.get("id")].attributes,t))}processPhosphorMessage(e){switch(n.DOMWidgetView.prototype.processPhosphorMessage.call(this,e),e.type){case"after-attach":this.el.addEventListener("contextmenu",this,!0);break;case"before-detach":this.el.removeEventListener("contextmenu",this,!0);break;case"resize":this.handleResize(e)}}handleEvent(e){"contextmenu"===e.type?this.handleContextMenu(e):n.DOMWidgetView.prototype.handleEvent.call(this,e)}handleContextMenu(e){this.container.contains(e.target)&&(e.preventDefault(),e.stopPropagation())}handleResize(){this.K3DInstance&&this.K3DInstance.resizeHelper()}}e.exports={ChunkModel:f,PlotModel:_,PlotView:x,ObjectModel:v,ObjectView:y,ThreeJsProvider:l,CreateK3DAndLoadBinarySnapshot:c,TransferFunctionEditor:i.transferFunctionEditor,TransferFunctionModel:i.transferFunctionModel,TransferFunctionView:i.transferFunctionView,K3D:a}},1026:(e,t,r)=>{const n=r(2187),o=r(1772),{version:a}=r(5527);e.exports={id:"jupyter.extensions.k3d",requires:[n.IJupyterWidgetRegistry],activate(e,t){r(2876),r(80),t.registerWidget({name:"k3d",version:a,exports:o})},autoStart:!0}},5843:(e,t,r)=>{e.exports={extend:r(4925),result:r(6080),pull:r(2092),difference:r(8288),assign:r(9530),assignWith:r(8395),eq:r(5173),cloneDeep:r(543),clone:r(8802),values:r(9792),keys:r(6066),invert:r(560),isNumber:r(2591),intersection:r(8130),range:r(4237),merge:r(9085),isObject:r(6283),isEmpty:r(8795),isEqual:r(4303),isArray:r(3067)}},9724:(e,t,r)=>{const n=r(108),{createCanvasGradient:o}=r(5103),a=r(1020);function i(e){return[e.targetDOMNode.offsetWidth,e.targetDOMNode.offsetHeight]}function s(e){const t={front:n.FrontSide,back:n.BackSide,double:n.DoubleSide};return e.opacity<1?t.double:e.side&&t[e.side]||t.front}e.exports={closestPowOfTwo:e=>2**Math.ceil(Math.log(e)/Math.log(2)),getObjectById:(e,t)=>e.ObjectsById[t],getSpaceDimensionsFromTargetElement:i,resizeListener(e){const t=i(e);e.width=t[0],e.height=t[1],e.camera.aspect=e.width/e.height,e.camera.updateProjectionMatrix(),e.renderer.setSize(e.width,e.height)},getColorsArray(e,t){const r=new Float32Array(3*t);let n;for(n=0;n<r.length;n+=3)r[n]=e.r,r[n+1]=e.g,r[n+2]=e.b;return r},getTwoColorsArray(e,t,r){const n=new Float32Array(3*r);let o;for(o=0;o<n.length;o+=6)n[o]=e.r,n[o+1]=e.g,n[o+2]=e.b,n[o+3]=t.r,n[o+4]=t.g,n[o+5]=t.b;return n},expandBoundingBox(e,t){e.min.x-=t,e.max.x+=t,e.min.y-=t,e.max.y+=t,e.min.z-=t,e.max.z+=t},generateArrow(e,t,r,o,a,i,s){const l=new n.Vector3,c=(new n.Vector3).subVectors(a,o),d=c.length(),p=[];let u,m,h=new n.Quaternion;if(c.normalize(),t.push(o.x,o.y,o.z),null!==e){for(e=e.clone(),m=(new n.Vector3).copy(o).add(c.clone().multiplyScalar(d-s)),t.push(m.x,m.y,m.z),u=0;u<e.attributes.position.count;u++)p.push(i.r),p.push(i.g),p.push(i.b);e.setAttribute("color",new n.Float32BufferAttribute(p,3)),c.y>.99999?h.set(0,0,0,1):c.y<-.99999?h.set(1,0,0,0):(l.set(c.z,0,-c.x).normalize(),h=(new n.Quaternion).setFromAxisAngle(l,Math.acos(c.y))),e.applyMatrix4((new n.Matrix4).makeRotationFromQuaternion(h)),e.translate(a.x,a.y,a.z),r?r.push(e):r=[e]}else t.push(a.x,a.y,a.z);return r},handleColorMap(e,t,r,a,i){let s,l;const c=o(t,1024),d=new n.CanvasTexture(c,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);if(d.needsUpdate=!0,i.setValues({map:d,color:16777215}),a){for(s=new Float32Array(a.length),l=0;l<a.length;l++)s[l]=(a[l]-r[0])/(r[1]-r[0]);e.setAttribute("uv",new n.BufferAttribute(s,1))}},typedArrayToThree:e=>e===Int16Array?n.ShortType:e===Int32Array?n.IntType:e===a?n.HalfFloatType:e===Float32Array?n.FloatType:null,areAllChangesResolve:(e,t)=>Object.keys(e).every((e=>void 0!==t[e])),recalculateFrustum(e){e.frustum.setFromProjectionMatrix((new n.Matrix4).multiplyMatrices(e.projectionMatrix,e.matrixWorldInverse))},commonUpdate(e,t,r,o){if(null!==r.model_matrix&&void 0!==t.model_matrix&&!t.model_matrix.timeSeries){const e=new n.Matrix4;e.set.apply(e,t.model_matrix.data),o.initialPosition?o.position.copy(o.initialPosition):o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),o.applyMatrix4(e),o.updateMatrixWorld(),o.transformControls&&o.transformControls.updateMatrixWorld(),r.model_matrix=null}null===r.visible||void 0===t.visible||t.visible.timeSeries||(o.visible=t.visible,r.visible=null),null===r.opacity||void 0===t.opacity||t.opacity.timeSeries||(o.material.opacity=t.opacity,o.material.side=s({opacity:t.opacity,side:e.side}),o.material.uniforms&&o.material.uniforms.opacity&&(o.material.uniforms.opacity.value=t.opacity),o.material.depthWrite=1===t.opacity,o.material.transparent=1!==t.opacity,o.material.needsUpdate=!0,r.opacity=null)},ensure256size(e){const t=new Float32Array(256);for(let r=0;r<Math.min(256,e.length);r++)t[r]=e[r];return t},getSide:s}},2539:(e,t,r)=>{const n=r(2736),o=r(5498);e.exports={init(e,t,r,a,i,s){t.startInteraction=function(){t.interactions||(void 0===i&&(i=t.geometry),t.geometry.boundsTree=new n.MeshBVH(i),t.interactions=a?a(t,r):o(t,r),void 0!==s&&(t.interactions.intersect=s(t)))},t.stopInteraction=function(){t.interactions&&(t.geometry.boundsTree=null,t.interactions=null)},(e.click_callback||e.hover_callback)&&t.startInteraction()},update(e,t,r,n){void 0===t.click_callback&&void 0===t.hover_callback||((t.click_callback||t.hover_callback)&&n.startInteraction(),t.click_callback||t.hover_callback||n.stopInteraction(),r.click_callback=null,r.hover_callback=null)}}},6841:(e,t,r)=>{const n=r(108),o=[[[0,0]],[[4,4],[-4,-4]],[[-2,-6],[6,-2],[-6,2],[2,6]],[[1,-3],[-1,3],[5,1],[-3,-5],[-5,5],[-7,-1],[3,7],[7,-7]],[[1,1],[-1,-3],[-3,2],[4,-1],[-5,-2],[2,5],[5,3],[3,-5],[-2,6],[0,-7],[-4,-6],[-6,4],[-8,0],[7,-4],[6,7],[-7,-8]],[[-4,-7],[-7,-5],[-3,-5],[-5,-4],[-1,-4],[-2,-2],[-6,-1],[-4,0],[-7,1],[-1,2],[-6,3],[-3,3],[-7,6],[-3,6],[-5,7],[-1,7],[5,-7],[1,-6],[6,-5],[4,-4],[2,-3],[7,-2],[1,-1],[4,-1],[2,1],[6,2],[0,4],[4,4],[2,5],[7,5],[5,6],[3,7]]];e.exports=function(e,t,r,a,i,s,l,c,d){return new Promise((p=>{const u=o[Math.max(0,Math.min(c,5))],{autoClear:m}=e,h=n.CopyShader,g=n.UniformsUtils.clone(h.uniforms),f=new n.ShaderMaterial({uniforms:g,vertexShader:h.vertexShader,fragmentShader:h.fragmentShader,premultipliedAlpha:!0,transparent:!0,blending:n.AdditiveBlending,depthTest:!1,depthWrite:!1}),v=new n.WebGLRenderTarget(a.width,a.height,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RGBAFormat,stencilBuffer:!0}),y=new n.OrthographicCamera(-1,1,1,-1,0,1),_=new n.Scene,x=new n.Mesh(new n.PlaneBufferGeometry(2,2),f);x.frustumCulled=!1,_.add(x),e.autoClear=!1;let b=new n.Color;e.getClearColor(b),b=b.getHex();const w=e.getClearAlpha(),M=1/u.length;g.tDiffuse.value=v.texture;const C=new Uint8ClampedArray(i*s*4);let E=Promise.resolve();l.forEach((n=>{E=E.then((()=>{const{width:o}=a,l=n[1];for(let c=0;c<u.length;c++){const p=u[c];r.setViewOffset(i,s,.0625*p[0],.0625*p[1]+n[0],o,l);let m=M;m+=.03125*((c+.5)/u.length-.5),g.opacity.value=m,e.setClearColor(0,0),e.setRenderTarget(v),e.clear(),d(t,r,v),e.setRenderTarget(a),0===c&&(e.setClearColor(0,0),e.clear()),e.render(_,y)}C.set(function(e,t){const r=new Float32Array(t.width*t.height*4),n=new Uint8ClampedArray(t.width*t.height*4);let o;for(e.readRenderTargetPixels(t,0,0,t.width,t.height,r),o=0;o<r.length;o++)n[o]=Math.floor(256*r[o]);return n}(e,a).subarray(0,o*l*4),(s-l-n[0])*o*4)})),E=E.then((()=>new Promise((e=>{setTimeout(e,100)}))))})),E=E.then((()=>{r.clearViewOffset&&r.clearViewOffset(),e.autoClear=m,e.setClearColor(b,w),v.dispose(),p(C)}))}))}},7241:(e,t,r)=>{const n=r(108);e.exports=function(e,t,r,o,a,i,s){const l=new n.BufferGeometry,c=[],d=[],p=[],u=[],m=[];let h=null,g=null;const f=new n.Vector3;let v,y,_,x,b,w,M,C,E,S,A,P=0;function z(e){let t,r,n,a,i;for(let s=e;s<e+P-1;s++)for(i=0;i<o;i++)t=o*s+i,r=o*(s+1)+i,n=o*(s+1)+(i+1)%o,a=o*s+(i+1)%o,m.push(t,r,a),m.push(r,n,a)}function D(e,l,m,h){const v=new n.Vector3,y=new n.Vector3,_=new n.Vector3,x=l.clone().sub(e).normalize();let b,w,M,C,E,S,A;null===g?(b=Number.MAX_VALUE,w=Math.abs(x.x),M=Math.abs(x.y),C=Math.abs(x.z),w<=b&&(b=w,v.set(1,0,0)),M<=b&&(b=M,v.set(0,1,0)),C<=b&&v.set(0,0,1),y.crossVectors(x,v).normalize(),g=new n.Vector3,g.crossVectors(x,y)):h&&g.applyMatrix4(h),_.crossVectors(x,g);for(let n=0;n<o;n++)E=n/o*(2*Math.PI),S=Math.sin(E),A=-Math.cos(E),v.x=A*g.x+S*_.x,v.y=A*g.y+S*_.y,v.z=A*g.z+S*_.z,v.normalize(),d.push(v.x,v.y,v.z),f.x=e.x+r*v.x,f.y=e.y+r*v.y,f.z=e.z+r*v.z,c.push(f.x,f.y,f.z),null!==t&&t.length>0?p.push((t[m]-s[0])/(s[1]-s[0]),n/o):null!==i&&i.length>0?u.push(i[3*m],i[3*m+1],i[3*m+2]):u.push(a.r,a.g,a.b);P++}A=0;for(let t=0;t<e.length/3;t++)x=null,t!==e.length/3-1?(v=(new n.Vector3).fromArray(e,3*t),y=(new n.Vector3).fromArray(e,3*t+3),_=y.clone().sub(v).normalize()):(v=(new n.Vector3).fromArray(e,3*t),y=(new n.Vector3).fromArray(e,3*t-3),y.add(v.clone().sub(y).multiplyScalar(2))),Number.isNaN(v.x)||Number.isNaN(v.y)||Number.isNaN(v.z)||Number.isNaN(y.x)||Number.isNaN(y.y)||Number.isNaN(y.z)?(z(A),h=null,g=null,A+=P,P=0):(h&&_&&(b=(new n.Vector3).crossVectors(h,_),w=b.length(),w>Number.EPSILON&&(w>.3&&(C=Math.min(r,y.clone().sub(v).length()/5),E=v.clone(),S=y.clone(),v.sub(h.clone().multiplyScalar(C)),y.copy(E).add(h.clone().multiplyScalar(C)),D(v,y,t),v.copy(E).add(_.clone().multiplyScalar(C)),y.copy(S)),b=b.divideScalar(w),M=Math.acos(n.Math.clamp(h.clone().dot(_),-1,1)),x=(new n.Matrix4).makeRotationAxis(b,M))),D(v,y,t,x),h=_.clone());return z(A),l.setIndex(m),l.setAttribute("position",new n.Float32BufferAttribute(c,3)),l.setAttribute("normal",new n.Float32BufferAttribute(d,3)),null!==t&&t.length>0?l.setAttribute("uv",new n.Float32BufferAttribute(p,2)):l.setAttribute("color",new n.Float32BufferAttribute(u,3)),l}},8117:e=>{e.exports=function(e){e.CopyShader={uniforms:{tDiffuse:{value:null},opacity:{value:1}},vertexShader:["varying vec2 vUv;","void main() {","vUv = uv;","gl_Position = projectionMatrix * modelViewMatrix * vec4( position, 1.0 );","}"].join("\n"),fragmentShader:["uniform float opacity;","uniform sampler2D tDiffuse;","varying vec2 vUv;","void main() {","vec4 texel = texture2D( tDiffuse, vUv );","gl_FragColor = opacity * texel;","}"].join("\n")}}},2460:e=>{e.exports=function(e){function t(){this.positions=[],this.previous=[],this.next=[],this.side=[],this.width=[],this.indices_array=[],this.uvs=[],this.counters=[],this.geometry=new e.BufferGeometry}function r(t){let r;function n(e,t){return void 0===e?t:e}return t=t||{},this.lineWidth=n(t.lineWidth,1),this.map=n(t.map,null),this.useMap=n(t.useMap,0),this.color=n(t.color,new e.Color(16777215)),this.opacity=n(t.opacity,1),this.resolution=n(t.resolution,new e.Vector2(1,1)),this.sizeAttenuation=n(t.sizeAttenuation,1),this.near=n(t.near,1),this.far=n(t.far,1),this.visibility=n(t.visibility,1),r=new e.ShaderMaterial({uniforms:{lineWidth:{type:"f",value:this.lineWidth},map:{type:"t",value:this.map},useMap:{type:"f",value:this.useMap},color:{type:"c",value:this.color},opacity:{type:"f",value:this.opacity},resolution:{type:"v2",value:this.resolution},sizeAttenuation:{type:"f",value:this.sizeAttenuation},near:{type:"f",value:this.near},far:{type:"f",value:this.far},visibility:{type:"f",value:this.visibility}},vertexShader:["precision highp float;","","attribute vec3 previous;","attribute vec3 next;","attribute vec3 colors;","attribute float side;","attribute float width;","attribute float counters;","","uniform vec2 resolution;","uniform float lineWidth;","uniform vec3 color;","uniform float opacity;","uniform float near;","uniform float far;","uniform float sizeAttenuation;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","#include <common>","#include <logdepthbuf_pars_vertex>","#include <clipping_planes_pars_vertex>","","vec2 fix( vec4 i, float aspect ) {","","    vec2 res = i.xy / i.w;","    res.x *= aspect;","    vCounters = counters;","    return res;","","}","","void main() {","","    float aspect = resolution.x / resolution.y;","    float pixelWidthRatio = 1. / (resolution.x * projectionMatrix[0][0]);","","    vColor = vec4( color * colors, opacity );","    vUV = uv;","","    vec3 mvPosition = (modelViewMatrix * vec4(position, 1.0)).xyz;","    #include <clipping_planes_vertex>","","    mat4 m = projectionMatrix * modelViewMatrix;","    vec4 finalPosition = m * vec4( position, 1.0 );","    vec4 prevPos = m * vec4( previous, 1.0 );","    vec4 nextPos = m * vec4( next, 1.0 );","","    vec2 currentP = fix( finalPosition, aspect );","    vec2 prevP = fix( prevPos, aspect );","    vec2 nextP = fix( nextPos, aspect );","","    float pixelWidth = finalPosition.w * pixelWidthRatio;","    float w = 1.8 * pixelWidth * lineWidth * width;","","    if( sizeAttenuation == 1. ) {","        w = max(1.8 * pixelWidth * 2.0, 1.8 * lineWidth * width);","    }","","    vec2 dir;","    if( nextP == currentP ) dir = normalize( currentP - prevP );","    else if( prevP == currentP ) dir = normalize( nextP - currentP );","    else {","        vec2 dir1 = normalize( currentP - prevP );","        vec2 dir2 = normalize( nextP - currentP );","        dir = normalize( dir1 + dir2 );","","        vec2 perp = vec2( -dir1.y, dir1.x );","        vec2 miter = vec2( -dir.y, dir.x );","        //w = clamp( w / dot( miter, perp ), 0., 4. * lineWidth * width );","","    }","","    //vec2 normal = ( cross( vec3( dir, 0. ), vec3( 0., 0., 1. ) ) ).xy;","    vec2 normal = vec2( -dir.y, dir.x );","    normal.x /= aspect;","    normal *= .5 * w;","","    vec4 offset = vec4( normal * side, 0.0, 1.0 );","    finalPosition.xy += offset.xy;","","","    gl_Position = finalPosition;","    #include <logdepthbuf_vertex>","","}"].join("\r\n"),fragmentShader:["precision mediump float;","","uniform sampler2D map;","uniform float useMap;","uniform float visibility;","","varying vec2 vUV;","varying vec4 vColor;","varying float vCounters;","","#include <logdepthbuf_pars_fragment>","#include <clipping_planes_pars_fragment>","","void main() {",""," #include <clipping_planes_fragment>"," #include <logdepthbuf_fragment>","","    vec4 c = vColor;","    if( useMap == 1. ) c *= texture2D( map, vUV);","    gl_FragColor = c;","    gl_FragColor.a *= step(vCounters, visibility);","}"].join("\r\n"),clipping:!0}),delete t.lineWidth,delete t.map,delete t.useMap,delete t.color,delete t.opacity,delete t.resolution,delete t.sizeAttenuation,delete t.near,delete t.far,delete t.visibility,r.type="MeshLineMaterial",r.setValues(t),r}return t.prototype.setGeometry=function(e,t,r,n,o){let a,i,s;if(e instanceof Float32Array||e instanceof Array)for(this.positions=new Float32Array(2*e.length),this.counters=new Float32Array(2*e.length/3),a=0;a<e.length;a+=3)i=a/e.length,this.positions[2*a]=this.positions[2*a+3]=e[a],this.positions[2*a+1]=this.positions[2*a+4]=e[a+1],this.positions[2*a+2]=this.positions[2*a+5]=e[a+2],this.counters[2*a]=this.counters[2*a+1]=i;for(s=this.positions.length/6,this.width=new Float32Array(2*s),this.colors=new Float32Array(6*s),this.uvs=new Float32Array(4*s),a=0;a<s;a++)this.width[2*a]=this.width[2*a+1]=r?r[a]:1,n?(this.colors[6*a]=this.colors[6*a+3]=n[3*a],this.colors[6*a+1]=this.colors[6*a+4]=n[3*a+1],this.colors[6*a+2]=this.colors[6*a+5]=n[3*a+2]):this.colors[6*a]=this.colors[6*a+1]=this.colors[6*a+2]=this.colors[6*a+3]=this.colors[6*a+4]=this.colors[6*a+5]=1,o?(this.uvs[4*a]=this.uvs[4*a+2]=o[a],this.uvs[4*a+1]=0,this.uvs[4*a+3]=1):(this.uvs[4*a]=this.uvs[4*a+2]=a/(s-1),this.uvs[4*a+1]=0,this.uvs[4*a+3]=1);this.process(t)},t.prototype.compareV3=function(e,t){const r=6*e,n=6*t;return this.positions[r]===this.positions[n]&&this.positions[r+1]===this.positions[n+1]&&this.positions[r+2]===this.positions[n+2]},t.prototype.copyV3=function(e){const t=6*e;return[this.positions[t],this.positions[t+1],this.positions[t+2]]},t.prototype.process=function(t){const r=this.positions.length/6;let n,o,a,i,s;for(this.previous=new Float32Array(12*r/2),this.next=new Float32Array(12*r/2),this.side=new Float32Array(2*r),this.indices_array=new Uint32Array(6*(Math.max(r,1)-1)),n=0;n<r;n++)this.side[2*n]=1,this.side[2*n+1]=-1;if(t){for(n=0;n<r;n+=2)s=n/2*12,this.previous[s]=this.previous[s+3]=this.previous[s+6]=this.previous[s+9]=this.positions[6*n],this.previous[s+1]=this.previous[s+4]=this.previous[s+7]=this.previous[s+10]=this.positions[6*n+1],this.previous[s+2]=this.previous[s+5]=this.previous[s+8]=this.previous[s+11]=this.positions[6*n+2];for(n=0;n<r;n+=2)a=n+1,s=n/2*12,this.next[s]=this.next[s+3]=this.next[s+6]=this.next[s+9]=this.positions[6*a],this.next[s+1]=this.next[s+4]=this.next[s+7]=this.next[s+10]=this.positions[6*a+1],this.next[s+2]=this.next[s+5]=this.next[s+8]=this.next[s+11]=this.positions[6*a+2];for(n=0;n<r-1;n+=2)o=2*n,this.indices_array[6*n]=o,this.indices_array[6*n+1]=o+1,this.indices_array[6*n+2]=o+2,this.indices_array[6*n+3]=o+2,this.indices_array[6*n+4]=o+1,this.indices_array[6*n+5]=o+3}else{for(i=this.compareV3(0,r-1)?this.copyV3(r-2):this.copyV3(0),this.previous[0]=this.previous[3]=i[0],this.previous[1]=this.previous[4]=i[1],this.previous[2]=this.previous[5]=i[2],n=0;n<r-1;n++)i=this.copyV3(n),this.previous[6+6*n]=this.previous[6+6*n+3]=i[0],this.previous[6+6*n+1]=this.previous[6+6*n+4]=i[1],this.previous[6+6*n+2]=this.previous[6+6*n+5]=i[2];for(n=1;n<r;n++)i=this.copyV3(n),this.next[6*(n-1)]=this.next[6*(n-1)+3]=i[0],this.next[6*(n-1)+1]=this.next[6*(n-1)+4]=i[1],this.next[6*(n-1)+2]=this.next[6*(n-1)+5]=i[2];for(i=this.compareV3(r-1,0)?this.copyV3(1):this.copyV3(r-1),this.next[6*(r-1)]=this.next[6*(r-1)+3]=i[0],this.next[6*(r-1)+1]=this.next[6*(r-1)+4]=i[1],this.next[6*(r-1)+2]=this.next[6*(r-1)+5]=i[2],n=0;n<r-1;n++)o=2*n,this.indices_array[6*n]=o,this.indices_array[6*n+1]=o+1,this.indices_array[6*n+2]=o+2,this.indices_array[6*n+3]=o+2,this.indices_array[6*n+4]=o+1,this.indices_array[6*n+5]=o+3}this.attributes?(this.attributes.position.copyArray(this.positions),this.attributes.position.needsUpdate=!0,this.attributes.previous.copyArray(this.previous),this.attributes.previous.needsUpdate=!0,this.attributes.next.copyArray(this.next),this.attributes.next.needsUpdate=!0,this.attributes.side.copyArray(this.side),this.attributes.side.needsUpdate=!0,this.attributes.width.copyArray(this.width),this.attributes.width.needsUpdate=!0,this.attributes.uv.copyArray(this.uvs),this.attributes.uv.needsUpdate=!0,this.attributes.index.copyArray(this.indices_array),this.attributes.index.needsUpdate=!0,this.attributes.colors.copyArray(this.colors),this.attributes.colors.needsUpdate=!0):this.attributes={position:new e.BufferAttribute(this.positions,3),previous:new e.BufferAttribute(this.previous,3),next:new e.BufferAttribute(this.next,3),side:new e.BufferAttribute(this.side,1),width:new e.BufferAttribute(this.width,1),uv:new e.BufferAttribute(this.uvs,2),index:new e.BufferAttribute(this.indices_array,1),counters:new e.BufferAttribute(this.counters,1),colors:new e.BufferAttribute(this.colors,3)},this.geometry.setAttribute("position",this.attributes.position),this.geometry.setAttribute("previous",this.attributes.previous),this.geometry.setAttribute("next",this.attributes.next),this.geometry.setAttribute("side",this.attributes.side),this.geometry.setAttribute("width",this.attributes.width),this.geometry.setAttribute("uv",this.attributes.uv),this.geometry.setAttribute("counters",this.attributes.counters),this.geometry.setAttribute("colors",this.attributes.colors),this.geometry.setIndex(this.attributes.index)},r.prototype=Object.create(e.Material.prototype),r.prototype.constructor=r,r.prototype.isMeshLineMaterial=!0,r.prototype.copy=function(t){return e.Material.prototype.copy.call(this,t),this.lineWidth=t.lineWidth,this.map=t.map,this.useMap=t.useMap,this.color.copy(t.color),this.opacity=t.opacity,this.resolution.copy(t.resolution),this.sizeAttenuation=t.sizeAttenuation,this.near=t.near,this.far=t.far,this.visibility=t.visibility,this},{MeshLine:t,MeshLineMaterial:r}}},9209:e=>{e.exports=function(e){e.OrbitControls=function(t,r){this.domElement=void 0!==r?r:window.document,this.object=t,this.domElement.style.touchAction="none",this.enabled=!0,this.target=new e.Vector3,this.minDistance=0,this.maxDistance=1/0,this.minZoom=0,this.maxZoom=1/0,this.minPolarAngle=0,this.maxPolarAngle=Math.PI,this.minAzimuthAngle=-1/0,this.maxAzimuthAngle=1/0,this.enableDamping=!1,this.dampingFactor=.05,this.enableZoom=!0,this.zoomSpeed=1,this.enableRotate=!0,this.rotateSpeed=1,this.enablePan=!0,this.panSpeed=1,this.screenSpacePanning=!0,this.keyPanSpeed=7,this.autoRotate=!1,this.autoRotateSpeed=2,this.keys={LEFT:"ArrowLeft",UP:"ArrowUp",RIGHT:"ArrowRight",BOTTOM:"ArrowDown"},this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.touches={ONE:e.TOUCH.ROTATE,TWO:e.TOUCH.DOLLY_PAN},this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.zoom0=this.object.zoom,this._domElementKeyEvents=null,this.getPolarAngle=function(){return d.phi},this.getAzimuthalAngle=function(){return d.theta},this.getDistance=function(){return this.object.position.distanceTo(this.target)},this.listenToKeyEvents=function(e){e.addEventListener("keydown",Y),this._domElementKeyEvents=e},this.saveState=function(){n.target0.copy(n.target),n.position0.copy(n.object.position),n.zoom0=n.object.zoom},this.reset=function(){n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),n.dispatchEvent(o),n.update(),l=s.NONE},this.update=function(r){const a=new e.Vector3,i=(new e.Quaternion).setFromUnitVectors(t.up,new e.Vector3(0,1,0)),g=i.clone().invert(),f=new e.Vector3,v=new e.Quaternion,y=2*Math.PI;return function(){const e=n.object.position;a.copy(e).sub(n.target),a.applyQuaternion(i),d.setFromVector3(a),n.autoRotate&&l===s.NONE&&A(2*Math.PI/60/60*n.autoRotateSpeed),n.enableDamping?(d.theta+=p.theta*n.dampingFactor,d.phi+=p.phi*n.dampingFactor):(d.theta+=p.theta,d.phi+=p.phi);let t=n.minAzimuthAngle,r=n.maxAzimuthAngle;return isFinite(t)&&isFinite(r)&&(t<-Math.PI?t+=y:t>Math.PI&&(t-=y),r<-Math.PI?r+=y:r>Math.PI&&(r-=y),d.theta=t<=r?Math.max(t,Math.min(r,d.theta)):d.theta>(t+r)/2?Math.max(t,d.theta):Math.min(r,d.theta)),d.phi=Math.max(n.minPolarAngle,Math.min(n.maxPolarAngle,d.phi)),d.makeSafe(),d.radius*=u,d.radius=Math.max(n.minDistance,Math.min(n.maxDistance,d.radius)),!0===n.enableDamping?n.target.addScaledVector(m,n.dampingFactor):n.target.add(m),a.setFromSpherical(d),a.applyQuaternion(g),e.copy(n.target).add(a),n.object.lookAt(n.target),!0===n.enableDamping?(p.theta*=1-n.dampingFactor,p.phi*=1-n.dampingFactor,m.multiplyScalar(1-n.dampingFactor)):(p.set(0,0,0),m.set(0,0,0)),u=1,!!(h||f.distanceToSquared(n.object.position)>c||8*(1-v.dot(n.object.quaternion))>c)&&(n.dispatchEvent(o),f.copy(n.object.position),v.copy(n.object.quaternion),h=!1,!0)}}(),this.dispose=function(){n.domElement.removeEventListener("contextmenu",Z),n.domElement.removeEventListener("pointerdown",U),n.domElement.removeEventListener("pointercancel",H),n.domElement.removeEventListener("wheel",K),n.domElement.removeEventListener("pointermove",W),n.domElement.removeEventListener("pointerup",G),null!==n._domElementKeyEvents&&n._domElementKeyEvents.removeEventListener("keydown",Y)};const n=this,o={type:"change"},a={type:"start"},i={type:"end"};var s={NONE:-1,ROTATE:0,DOLLY:1,PAN:2,TOUCH_ROTATE:3,TOUCH_PAN:4,TOUCH_DOLLY_PAN:5,TOUCH_DOLLY_ROTATE:6};let l=s.NONE;const c=1e-6,d=new e.Spherical,p=new e.Spherical;let u=1;const m=new e.Vector3;let h=!1;const g=new e.Vector2,f=new e.Vector2,v=new e.Vector2,y=new e.Vector2,_=new e.Vector2,x=new e.Vector2,b=new e.Vector2,w=new e.Vector2,M=new e.Vector2,C=[],E={};function S(){return Math.pow(.95,n.zoomSpeed)}function A(e){p.theta-=e}function P(e){p.phi-=e}const z=function(){const t=new e.Vector3;return function(e,r){t.setFromMatrixColumn(r,0),t.multiplyScalar(-e),m.add(t)}}(),D=function(){const t=new e.Vector3;return function(e,r){!0===n.screenSpacePanning?t.setFromMatrixColumn(r,1):(t.setFromMatrixColumn(r,0),t.crossVectors(n.object.up,t)),t.multiplyScalar(e),m.add(t)}}(),T=function(){const t=new e.Vector3;return function(e,r){const o=n.domElement;if(n.object.isPerspectiveCamera){const a=n.object.position;t.copy(a).sub(n.target);let i=t.length();i*=Math.tan(n.object.fov/2*Math.PI/180),z(2*e*i/o.clientHeight,n.object.matrix),D(2*r*i/o.clientHeight,n.object.matrix)}else n.object.isOrthographicCamera?(z(e*(n.object.right-n.object.left)/n.object.zoom/o.clientWidth,n.object.matrix),D(r*(n.object.top-n.object.bottom)/n.object.zoom/o.clientHeight,n.object.matrix)):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - pan disabled."),n.enablePan=!1)}}();function k(e){n.object.isPerspectiveCamera?u/=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom*e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function O(e){n.object.isPerspectiveCamera?u*=e:n.object.isOrthographicCamera?(n.object.zoom=Math.max(n.minZoom,Math.min(n.maxZoom,n.object.zoom/e)),n.object.updateProjectionMatrix(),h=!0):(console.warn("WARNING: OrbitControls.js encountered an unknown camera type - dolly/zoom disabled."),n.enableZoom=!1)}function j(e){g.set(e.clientX,e.clientY)}function I(e){y.set(e.clientX,e.clientY)}function L(){if(1===C.length)g.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);g.set(e,t)}}function F(){if(1===C.length)y.set(C[0].pageX,C[0].pageY);else{const e=.5*(C[0].pageX+C[1].pageX),t=.5*(C[0].pageY+C[1].pageY);y.set(e,t)}}function V(){const e=C[0].pageX-C[1].pageX,t=C[0].pageY-C[1].pageY,r=Math.sqrt(e*e+t*t);b.set(0,r)}function R(e){if(1==C.length)f.set(e.pageX,e.pageY);else{const t=q(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);f.set(r,n)}v.subVectors(f,g).multiplyScalar(n.rotateSpeed);const t=n.domElement;A(2*Math.PI*v.x/t.clientHeight),P(2*Math.PI*v.y/t.clientHeight),g.copy(f)}function B(e){if(1===C.length)_.set(e.pageX,e.pageY);else{const t=q(e),r=.5*(e.pageX+t.x),n=.5*(e.pageY+t.y);_.set(r,n)}x.subVectors(_,y).multiplyScalar(n.panSpeed),T(x.x,x.y),y.copy(_)}function N(e){const t=q(e),r=e.pageX-t.x,o=e.pageY-t.y,a=Math.sqrt(r*r+o*o);w.set(0,a),M.set(0,Math.pow(w.y/b.y,n.zoomSpeed)),k(M.y),b.copy(w)}function U(t){!1!==n.enabled&&(0===C.length&&(n.domElement.setPointerCapture(t.pointerId),n.domElement.addEventListener("pointermove",W),n.domElement.addEventListener("pointerup",G)),function(e){C.push(e)}(t),"touch"===t.pointerType?function(t){switch($(t),C.length){case 1:switch(n.touches.ONE){case e.TOUCH.ROTATE:if(!1===n.enableRotate)return;L(),l=s.TOUCH_ROTATE;break;case e.TOUCH.PAN:if(!1===n.enablePan)return;F(),l=s.TOUCH_PAN;break;default:l=s.NONE}break;case 2:switch(n.touches.TWO){case e.TOUCH.DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;n.enableZoom&&V(),n.enablePan&&F(),l=s.TOUCH_DOLLY_PAN;break;case e.TOUCH.DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;n.enableZoom&&V(),n.enableRotate&&L(),l=s.TOUCH_DOLLY_ROTATE;break;default:l=s.NONE}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(a)}(t):function(t){let r;switch(t.button){case 0:r=n.mouseButtons.LEFT;break;case 1:r=n.mouseButtons.MIDDLE;break;case 2:r=n.mouseButtons.RIGHT;break;default:r=-1}switch(r){case e.MOUSE.DOLLY:if(!1===n.enableZoom)return;!function(e){b.set(e.clientX,e.clientY)}(t),l=s.DOLLY;break;case e.MOUSE.ROTATE:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enablePan)return;I(t),l=s.PAN}else{if(!1===n.enableRotate)return;j(t),l=s.ROTATE}break;case e.MOUSE.PAN:if(t.ctrlKey||t.metaKey||t.shiftKey){if(!1===n.enableRotate)return;j(t),l=s.ROTATE}else{if(!1===n.enablePan)return;I(t),l=s.PAN}break;default:l=s.NONE}l!==s.NONE&&n.dispatchEvent(a)}(t))}function W(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch($(e),l){case s.TOUCH_ROTATE:if(!1===n.enableRotate)return;R(e),n.update();break;case s.TOUCH_PAN:if(!1===n.enablePan)return;B(e),n.update();break;case s.TOUCH_DOLLY_PAN:if(!1===n.enableZoom&&!1===n.enablePan)return;!function(e){n.enableZoom&&N(e),n.enablePan&&B(e)}(e),n.update();break;case s.TOUCH_DOLLY_ROTATE:if(!1===n.enableZoom&&!1===n.enableRotate)return;!function(e){n.enableZoom&&N(e),n.enableRotate&&R(e)}(e),n.update();break;default:l=s.NONE}}(e):function(e){if(!1!==n.enabled)switch(l){case s.ROTATE:if(!1===n.enableRotate)return;!function(e){f.set(e.clientX,e.clientY),v.subVectors(f,g).multiplyScalar(n.rotateSpeed);const t=n.domElement;A(2*Math.PI*v.x/t.clientHeight),P(2*Math.PI*v.y/t.clientHeight),g.copy(f),n.update()}(e);break;case s.DOLLY:if(!1===n.enableZoom)return;!function(e){w.set(e.clientX,e.clientY),M.subVectors(w,b),M.y>0?k(S()):M.y<0&&O(S()),b.copy(w),n.update()}(e);break;case s.PAN:if(!1===n.enablePan)return;!function(e){_.set(e.clientX,e.clientY),x.subVectors(_,y).multiplyScalar(n.panSpeed),T(x.x,x.y),y.copy(_),n.update()}(e)}}(e))}function G(e){!1!==n.enabled&&(e.pointerType,n.dispatchEvent(i),l=s.NONE,X(e),0===C.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",W),n.domElement.removeEventListener("pointerup",G)))}function H(e){X(e)}function K(e){!1!==n.enabled&&!1!==n.enableZoom&&l===s.NONE&&(e.preventDefault(),n.dispatchEvent(a),function(e){e.deltaY<0?O(S()):e.deltaY>0&&k(S()),n.update()}(e),n.dispatchEvent(i))}function Y(e){!1!==n.enabled&&!1!==n.enablePan&&function(e){let t=!1;switch(e.code){case n.keys.UP:T(0,n.keyPanSpeed),t=!0;break;case n.keys.BOTTOM:T(0,-n.keyPanSpeed),t=!0;break;case n.keys.LEFT:T(n.keyPanSpeed,0),t=!0;break;case n.keys.RIGHT:T(-n.keyPanSpeed,0),t=!0}t&&(e.preventDefault(),n.update())}(e)}function Z(e){!1!==n.enabled&&e.preventDefault()}function X(e){delete E[e.pointerId];for(let t=0;t<C.length;t++)if(C[t].pointerId==e.pointerId)return void C.splice(t,1)}function $(t){let r=E[t.pointerId];void 0===r&&(r=new e.Vector2,E[t.pointerId]=r),r.set(t.pageX,t.pageY)}function q(e){const t=e.pointerId===C[0].pointerId?C[1]:C[0];return E[t.pointerId]}n.domElement.addEventListener("contextmenu",Z),n.domElement.addEventListener("pointerdown",U),n.domElement.addEventListener("pointercancel",H),n.domElement.addEventListener("wheel",K,{passive:!1}),this.update()},e.OrbitControls.prototype=Object.create(e.EventDispatcher.prototype),e.OrbitControls.prototype.constructor=e.OrbitControls}},9806:e=>{e.exports=function(e){e.STLLoader=function(t){this.manager=void 0!==t?t:e.DefaultLoadingManager},e.STLLoader.prototype={constructor:e.STLLoader,load(t,r,n,o){const a=this,i=new e.FileLoader(a.manager);i.setPath(a.path),i.setResponseType("arraybuffer"),i.load(t,(e=>{try{r(a.parse(e))}catch(e){o&&o(e)}}),n,o)},setPath(e){return this.path=e,this},parse(t){function r(e,t,r){for(let n=0,o=e.length;n<o;n++)if(e[n]!==t.getUint8(r+n,!1))return!1;return!0}const n=function(e){if("string"==typeof e){const t=new Uint8Array(e.length);for(let r=0;r<e.length;r++)t[r]=255&e.charCodeAt(r);return t.buffer||t}return e}(t);return function(e){let t,n,o,a;if(a=new DataView(e),n=50,o=a.getUint32(80,!0),t=84+50*o,t===a.byteLength)return!0;const i=[115,111,108,105,100];for(let e=0;e<5;e++)if(r(i,a,e))return!1;return!0}(n)?function(t){const r=new DataView(t),n=r.getUint32(80,!0);let o,a,i,s,l,c,d,p,u=!1;for(let e=0;e<70;e++)1129270351==r.getUint32(e,!1)&&82==r.getUint8(e+4)&&61==r.getUint8(e+5)&&(u=!0,s=[],l=r.getUint8(e+6)/255,c=r.getUint8(e+7)/255,d=r.getUint8(e+8)/255,p=r.getUint8(e+9)/255);const m=new e.BufferGeometry,h=[],g=[];for(let e=0;e<n;e++){const t=84+50*e,n=r.getFloat32(t,!0),p=r.getFloat32(t+4,!0),m=r.getFloat32(t+8,!0);if(u){const e=r.getUint16(t+48,!0);0==(32768&e)?(o=(31&e)/31,a=(e>>5&31)/31,i=(e>>10&31)/31):(o=l,a=c,i=d)}for(let e=1;e<=3;e++){const l=t+12*e;h.push(r.getFloat32(l,!0)),h.push(r.getFloat32(l+4,!0)),h.push(r.getFloat32(l+8,!0)),g.push(n,p,m),u&&s.push(o,a,i)}}return m.setAttribute("position",new e.BufferAttribute(new Float32Array(h),3)),m.setAttribute("normal",new e.BufferAttribute(new Float32Array(g),3)),u&&(m.setAttribute("color",new e.BufferAttribute(new Float32Array(s),3)),m.hasColors=!0,m.alpha=p),m}(n):function(t){const r=new e.BufferGeometry,n=/facet([\s\S]*?)endfacet/g;let o=0;const a=/[\s]+([+-]?(?:\d*)(?:\.\d*)?(?:[eE][+-]?\d+)?)/.source,i=new RegExp(`vertex${a}${a}${a}`,"g"),s=new RegExp(`normal${a}${a}${a}`,"g"),l=[],c=[],d=new e.Vector3;let p;for(;null!==(p=n.exec(t));){let e=0,t=0;const r=p[0];for(;null!==(p=s.exec(r));)d.x=parseFloat(p[1]),d.y=parseFloat(p[2]),d.z=parseFloat(p[3]),t++;for(;null!==(p=i.exec(r));)l.push(parseFloat(p[1]),parseFloat(p[2]),parseFloat(p[3])),c.push(d.x,d.y,d.z),e++;1!==t&&console.error(`THREE.STLLoader: Something isn't right with the normal of face number ${o}`),3!==e&&console.error(`THREE.STLLoader: Something isn't right with the vertices of face number ${o}`),o++}return r.setAttribute("position",new e.Float32BufferAttribute(l,3)),r.setAttribute("normal",new e.Float32BufferAttribute(c,3)),r}("string"!=typeof(o=t)?e.LoaderUtils.decodeText(new Uint8Array(o)):o);var o}}}},3866:e=>{e.exports=function(e){e.TrackballControls=function(t,r){const n=this,o=-1;let a,i;this.object=t,void 0!==r?(a=r.ownerDocument.defaultView||r.ownerDocument.parentWindow,this.domElement=r,i=r.ownerDocument):(a=window,this.domElement=a.document,i=a.document),this.domElement.style.touchAction="none",this.enabled=!0,this.screen={left:0,top:0,width:0,height:0},this.rotateSpeed=1,this.zoomSpeed=1.2,this.panSpeed=.3,this.noRotate=!1,this.noZoom=!1,this.noPan=!1,this.staticMoving=!1,this.dynamicDampingFactor=.2,this.minDistance=0,this.maxDistance=1/0,this.mouseButtons={LEFT:e.MOUSE.ROTATE,MIDDLE:e.MOUSE.DOLLY,RIGHT:e.MOUSE.PAN},this.target=new e.Vector3;const s=1e-10,l=new e.Vector3,c=new e.Vector3;let d=1,p=o,u=o,m=0,h=0,g=0;const f=new e.Vector3,v=new e.Vector2,y=new e.Vector2,_=new e.Vector3,x=new e.Vector2,b=new e.Vector2,w=new e.Vector2,M=new e.Vector2;this._pointerPositions={},this._pointers=[],this.target0=this.target.clone(),this.position0=this.object.position.clone(),this.up0=this.object.up.clone(),this.zoom0=this.object.zoom;const C={type:"change"},E={type:"start"},S={type:"end"};this.handleResize=function(){if(this.domElement===i)this.screen.left=0,this.screen.top=0,this.screen.width=a.innerWidth,this.screen.height=a.innerHeight;else{const e=n.domElement.getBoundingClientRect(),t=n.domElement.ownerDocument.documentElement;this.screen.left=e.left+a.pageXOffset-t.clientLeft,this.screen.top=e.top+a.pageYOffset-t.clientTop,this.screen.width=e.width,this.screen.height=e.height}};const A=function(){const t=new e.Vector2;return function(e,r){return t.set(e/n.screen.width,r/n.screen.height),t}}(),P=function(){const t=new e.Vector2;return function(e,r){return t.set((e-.5*n.screen.width)/(.5*n.screen.width),(n.screen.height-2*r)/n.screen.width),t}}();function z(e){!1!==n.enabled&&(0===n._pointers.length&&(n.domElement.setPointerCapture(e.pointerId),n.domElement.addEventListener("pointermove",D),n.domElement.addEventListener("pointerup",T)),function(e){n._pointers.push(e)}(e),"touch"===e.pointerType?function(e){if(1===(V(e),n._pointers.length))p=3,y.copy(P(n._pointers[0].pageX,n._pointers[0].pageY)),v.copy(y);else{p=4;const e=n._pointers[0].pageX-n._pointers[1].pageX,t=n._pointers[0].pageY-n._pointers[1].pageY;h=m=Math.sqrt(e*e+t*t);const r=(n._pointers[0].pageX+n._pointers[1].pageX)/2,o=(n._pointers[0].pageY+n._pointers[1].pageY)/2;w.copy(A(r,o)),M.copy(w)}n.dispatchEvent(E)}(e):function(e){if(p===o)switch(e.button){case n.mouseButtons.LEFT:p=0;break;case n.mouseButtons.MIDDLE:p=1;break;case n.mouseButtons.RIGHT:p=2;break;default:p=o}const t=u!==o?u:p;0!==t||n.noRotate?1!==t||n.noZoom?2!==t||n.noPan||(w.copy(A(e.offsetX,e.offsetY)),M.copy(w)):(x.copy(A(e.offsetX,e.offsetY)),b.copy(x)):(y.copy(P(e.offsetX,e.offsetY)),v.copy(y)),n.dispatchEvent(E)}(e))}function D(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(V(e),n._pointers.length){case 0:break;case 1:v.copy(y),y.copy(P(e.offsetX,e.offsetY));break;default:const t=function(e){const t=e.pointerId===n._pointers[0].pointerId?n._pointers[1]:n._pointers[0];return n._pointerPositions[t.pointerId]}(e),r=e.offsetX-t.x,o=e.offsetY-t.y;h=Math.sqrt(r*r+o*o);const a=(e.offsetX+t.x)/2,i=(e.offsetY+t.y)/2;M.copy(A(a,i))}}(e):function(e){if(!1===n.enabled)return;const t=u!==o?u:p;0!==t||n.noRotate?1!==t||n.noZoom?2!==t||n.noPan||M.copy(A(e.offsetX,e.offsetY)):b.copy(A(e.offsetX,e.offsetY)):(v.copy(y),y.copy(P(e.offsetX,e.offsetY)))}(e))}function T(e){!1!==n.enabled&&("touch"===e.pointerType?function(e){switch(n._pointers.length){case 0:p=o;break;case 1:p=3,y.copy(P(e.offsetX,e.offsetY)),v.copy(y);break;case 2:p=4,y.copy(P(e.offsetX-v.pageX,e.offsetY-v.pageY)),v.copy(y)}n.dispatchEvent(S)}(e):(p=o,n.dispatchEvent(S)),F(e),0===n._pointers.length&&(n.domElement.releasePointerCapture(e.pointerId),n.domElement.removeEventListener("pointermove",D),n.domElement.removeEventListener("pointerup",T)))}function k(e){F(e)}function O(e){!1!==n.enabled&&(a.removeEventListener("keydown",O),u!==o||(e.ctrlKey&&!n.noRotate?u=0:e.altKey&&!n.noZoom?u=1:e.shiftKey&&!n.noPan&&(u=2)))}function j(){!1!==n.enabled&&(u=o,a.addEventListener("keydown",O))}function I(e){if(!1!==n.enabled&&!0!==n.noZoom){switch(e.preventDefault(),e.deltaMode){case 2:x.y-=.025*e.deltaY;break;case 1:x.y-=.01*e.deltaY;break;default:x.y-=25e-5*e.deltaY}n.dispatchEvent(E),n.dispatchEvent(S)}}function L(e){!1!==n.enabled&&e.preventDefault()}function F(e){delete n._pointerPositions[e.pointerId];for(let t=0;t<n._pointers.length;t++)if(n._pointers[t].pointerId==e.pointerId)return void n._pointers.splice(t,1)}function V(t){let r=n._pointerPositions[t.pointerId];void 0===r&&(r=new e.Vector2,n._pointerPositions[t.pointerId]=r),r.set(t.offsetX,t.offsetY)}this.rotateCamera=function(){const t=new e.Vector3,r=new e.Quaternion,o=new e.Vector3,a=new e.Vector3,i=new e.Vector3,s=new e.Vector3;return function(){s.set(y.x-v.x,y.y-v.y,0);let e=s.length();e?(f.copy(n.object.position).sub(n.target),o.copy(f).normalize(),a.copy(n.object.up).normalize(),i.crossVectors(a,o).normalize(),a.setLength(y.y-v.y),i.setLength(y.x-v.x),s.copy(a.add(i)),t.crossVectors(s,f).normalize(),e*=n.rotateSpeed,r.setFromAxisAngle(t,e),f.applyQuaternion(r),n.object.up.applyQuaternion(r),_.copy(t),g=e):!n.staticMoving&&g&&(g*=Math.sqrt(1-n.dynamicDampingFactor),f.copy(n.object.position).sub(n.target),r.setFromAxisAngle(_,g),f.applyQuaternion(r),n.object.up.applyQuaternion(r)),v.copy(y)}}(),this.zoomCamera=function(){let e;if(4===p)e=m/h,m=h,n.object.isPerspectiveCamera?f.multiplyScalar(e):n.object.isOrthographicCamera?(n.object.zoom*=e,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type");else{if(n.flyMode||2===p||2===u)return;e=1+(b.y-x.y)*n.zoomSpeed,1!==e&&e>0&&(n.object.isPerspectiveCamera?f.multiplyScalar(e):n.object.isOrthographicCamera?(n.object.zoom/=e,n.object.updateProjectionMatrix()):console.warn("THREE.TrackballControls: Unsupported camera type")),n.staticMoving?x.copy(b):x.y+=(b.y-x.y)*n.dynamicDampingFactor}},this.panCamera=function(){const t=new e.Vector3,r=new e.Vector3,o=new e.Vector3,a=new e.Vector3;return function(){if(t.copy(M).sub(w),t.z=0,(n.flyMode||2===p||2===u)&&(t.z=(b.y-x.y)*n.panSpeed*10,n.staticMoving?x.copy(b):x.y+=(b.y-x.y)*n.dynamicDampingFactor),t.lengthSq()){if(n.object.isOrthographicCamera){const e=(n.object.right-n.object.left)/n.object.zoom/n.domElement.clientWidth,r=(n.object.top-n.object.bottom)/n.object.zoom/n.domElement.clientWidth;t.x*=e,t.y*=r}t.multiplyScalar(f.length()*n.panSpeed),a.copy(f).cross(n.object.up).setLength(t.x),a.add(r.copy(n.object.up).setLength(t.y)),a.add(o.copy(f).setLength(t.z)),n.object.position.add(a),n.target.add(a),n.staticMoving?w.copy(M):w.add(t.subVectors(M,w).multiplyScalar(n.dynamicDampingFactor))}}}(),this.checkDistances=function(){n.noZoom&&n.noPan||(f.lengthSq()>n.maxDistance*n.maxDistance&&(n.object.position.addVectors(n.target,f.setLength(n.maxDistance)),x.copy(b)),f.lengthSq()<n.minDistance*n.minDistance&&(n.object.position.addVectors(n.target,f.setLength(n.minDistance)),x.copy(b)))},this.update=function(e){f.subVectors(n.object.position,n.target),n.noRotate||n.rotateCamera(),n.noZoom||n.zoomCamera(),n.noPan||n.panCamera(),n.object.position.addVectors(n.target,f),n.object.isPerspectiveCamera?(n.checkDistances(),n.object.lookAt(n.target),(l.distanceToSquared(n.object.position)>s||c.distanceToSquared(n.object.up)>s)&&(l.copy(n.object.position),c.copy(n.object.up),e||n.dispatchEvent(C),l.copy(n.object.position))):n.object.isOrthographicCamera?(n.object.lookAt(n.target),(l.distanceToSquared(n.object.position)>s||d!==n.object.zoom)&&(e||n.dispatchEvent(C),l.copy(n.object.position),d=n.object.zoom)):console.warn("THREE.TrackballControls: Unsupported camera type")},this.reset=function(){p=o,u=o,n.target.copy(n.target0),n.object.position.copy(n.position0),n.object.up.copy(n.up0),n.object.zoom=n.zoom0,n.object.updateProjectionMatrix(),f.subVectors(n.object.position,n.target),n.object.lookAt(n.target),n.dispatchEvent(C),l.copy(n.object.position),c.copy(n.object.up),d=n.object.zoom},this.dispose=function(){n.domElement.removeEventListener("contextmenu",L),n.domElement.removeEventListener("pointerdown",z),n.domElement.removeEventListener("pointercancel",k),n.domElement.removeEventListener("wheel",I),n.domElement.removeEventListener("pointermove",D),n.domElement.removeEventListener("pointerup",T),i.removeEventListener("keydown",O),i.removeEventListener("keyup",j)},this.domElement.addEventListener("pointerdown",z),this.domElement.addEventListener("pointercancel",k),this.domElement.addEventListener("wheel",I,{passive:!1}),this.domElement.addEventListener("contextmenu",L),i.addEventListener("keydown",O),i.addEventListener("keyup",j),this.handleResize(),this.update()},e.TrackballControls.prototype=Object.create(e.EventDispatcher.prototype),e.TrackballControls.prototype.constructor=e.TrackballControls}},903:(e,t,r)=>{"use strict";r.d(t,{Ys:()=>m});var n=r(108);const o=new n.Raycaster,a=new n.Vector3,i=new n.Vector3,s=new n.Quaternion,l={X:new n.Vector3(1,0,0),Y:new n.Vector3(0,1,0),Z:new n.Vector3(0,0,1)},c={type:"change"},d={type:"mouseDown"},p={type:"mouseUp",mode:null},u={type:"objectChange"};class m extends n.Object3D{constructor(e,t){super(),void 0===t&&(console.warn('THREE.TransformControls: The second parameter "domElement" is now mandatory.'),t=document),this.visible=!1,this.domElement=t,this.domElement.style.touchAction="none";const r=new j;this._gizmo=r,this.add(r);const o=new I;this._plane=o,this.add(o);const a=this;function i(e,t){let n=t;Object.defineProperty(a,e,{get:()=>void 0!==n?n:t,set(t){n!==t&&(n=t,o[e]=t,r[e]=t,a.dispatchEvent({type:`${e}-changed`,value:t}),a.dispatchEvent(c))}}),a[e]=t,o[e]=t,r[e]=t}i("camera",e),i("object",void 0),i("enabled",!0),i("axis",null),i("mode","translate"),i("translationSnap",null),i("rotationSnap",null),i("scaleSnap",null),i("space","world"),i("size",1),i("dragging",!1),i("showX",!0),i("showY",!0),i("showZ",!0);const s=new n.Vector3,l=new n.Vector3,d=new n.Quaternion,p=new n.Quaternion,u=new n.Vector3,m=new n.Quaternion,_=new n.Vector3,x=new n.Vector3,b=new n.Vector3,w=new n.Vector3;i("worldPosition",s),i("worldPositionStart",l),i("worldQuaternion",d),i("worldQuaternionStart",p),i("cameraPosition",u),i("cameraQuaternion",m),i("pointStart",_),i("pointEnd",x),i("rotationAxis",b),i("rotationAngle",0),i("eye",w),this._offset=new n.Vector3,this._startNorm=new n.Vector3,this._endNorm=new n.Vector3,this._cameraScale=new n.Vector3,this._parentPosition=new n.Vector3,this._parentQuaternion=new n.Quaternion,this._parentQuaternionInv=new n.Quaternion,this._parentScale=new n.Vector3,this._worldScaleStart=new n.Vector3,this._worldQuaternionInv=new n.Quaternion,this._worldScale=new n.Vector3,this._positionStart=new n.Vector3,this._quaternionStart=new n.Quaternion,this._scaleStart=new n.Vector3,this._getPointer=h.bind(this),this._onPointerDown=f.bind(this),this._onPointerHover=g.bind(this),this._onPointerMove=v.bind(this),this._onPointerUp=y.bind(this),this.domElement.addEventListener("pointerdown",this._onPointerDown),this.domElement.addEventListener("pointermove",this._onPointerHover),this.domElement.addEventListener("pointerup",this._onPointerUp)}updateMatrixWorld(){void 0!==this.object&&(this.object.updateMatrixWorld(),null===this.object.parent?console.error("TransformControls: The attached 3D object must be a part of the scene graph."):this.object.parent.matrixWorld.decompose(this._parentPosition,this._parentQuaternion,this._parentScale),this.object.matrixWorld.decompose(this.worldPosition,this.worldQuaternion,this._worldScale),this._parentQuaternionInv.copy(this._parentQuaternion).invert(),this._worldQuaternionInv.copy(this.worldQuaternion).invert()),this.camera.updateMatrixWorld(),this.camera.matrixWorld.decompose(this.cameraPosition,this.cameraQuaternion,this._cameraScale),this.eye.copy(this.cameraPosition).sub(this.worldPosition).normalize(),super.updateMatrixWorld(this)}pointerHover(e){if(void 0===this.object||!0===this.dragging)return;o.setFromCamera(e,this.camera);const t=_(this._gizmo.picker[this.mode],o);this.axis=t?t.object.name:null}pointerDown(e){if(void 0!==this.object&&!0!==this.dragging&&0===e.button&&null!==this.axis){o.setFromCamera(e,this.camera);const t=_(this._plane,o,!0);t&&(this.object.updateMatrixWorld(),this.object.parent.updateMatrixWorld(),this._positionStart.copy(this.object.position),this._quaternionStart.copy(this.object.quaternion),this._scaleStart.copy(this.object.scale),this.object.matrixWorld.decompose(this.worldPositionStart,this.worldQuaternionStart,this._worldScaleStart),this.pointStart.copy(t.point).sub(this.worldPositionStart)),this.dragging=!0,d.mode=this.mode,this.dispatchEvent(d)}}pointerMove(e){const t=this.axis,r=this.mode,n=this.object;let d=this.space;if("scale"===r?d="local":"E"!==t&&"XYZE"!==t&&"XYZ"!==t||(d="world"),void 0===n||null===t||!1===this.dragging||-1!==e.button)return;o.setFromCamera(e,this.camera);const p=_(this._plane,o,!0);if(p){if(this.pointEnd.copy(p.point).sub(this.worldPositionStart),"translate"===r)this._offset.copy(this.pointEnd).sub(this.pointStart),"local"===d&&"XYZ"!==t&&this._offset.applyQuaternion(this._worldQuaternionInv),-1===t.indexOf("X")&&(this._offset.x=0),-1===t.indexOf("Y")&&(this._offset.y=0),-1===t.indexOf("Z")&&(this._offset.z=0),"local"===d&&"XYZ"!==t?this._offset.applyQuaternion(this._quaternionStart).divide(this._parentScale):this._offset.applyQuaternion(this._parentQuaternionInv).divide(this._parentScale),n.position.copy(this._offset).add(this._positionStart),this.translationSnap&&("local"===d&&(n.position.applyQuaternion(s.copy(this._quaternionStart).invert()),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.position.applyQuaternion(this._quaternionStart)),"world"===d&&(n.parent&&n.position.add(a.setFromMatrixPosition(n.parent.matrixWorld)),-1!==t.search("X")&&(n.position.x=Math.round(n.position.x/this.translationSnap)*this.translationSnap),-1!==t.search("Y")&&(n.position.y=Math.round(n.position.y/this.translationSnap)*this.translationSnap),-1!==t.search("Z")&&(n.position.z=Math.round(n.position.z/this.translationSnap)*this.translationSnap),n.parent&&n.position.sub(a.setFromMatrixPosition(n.parent.matrixWorld))));else if("scale"===r){if(-1!==t.search("XYZ")){let e=this.pointEnd.length()/this.pointStart.length();this.pointEnd.dot(this.pointStart)<0&&(e*=-1),i.set(e,e,e)}else a.copy(this.pointStart),i.copy(this.pointEnd),a.applyQuaternion(this._worldQuaternionInv),i.applyQuaternion(this._worldQuaternionInv),i.divide(a),-1===t.search("X")&&(i.x=1),-1===t.search("Y")&&(i.y=1),-1===t.search("Z")&&(i.z=1);n.scale.copy(this._scaleStart).multiply(i),this.scaleSnap&&(-1!==t.search("X")&&(n.scale.x=Math.round(n.scale.x/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Y")&&(n.scale.y=Math.round(n.scale.y/this.scaleSnap)*this.scaleSnap||this.scaleSnap),-1!==t.search("Z")&&(n.scale.z=Math.round(n.scale.z/this.scaleSnap)*this.scaleSnap||this.scaleSnap))}else if("rotate"===r){this._offset.copy(this.pointEnd).sub(this.pointStart);const e=20/this.worldPosition.distanceTo(a.setFromMatrixPosition(this.camera.matrixWorld));"E"===t?(this.rotationAxis.copy(this.eye),this.rotationAngle=this.pointEnd.angleTo(this.pointStart),this._startNorm.copy(this.pointStart).normalize(),this._endNorm.copy(this.pointEnd).normalize(),this.rotationAngle*=this._endNorm.cross(this._startNorm).dot(this.eye)<0?1:-1):"XYZE"===t?(this.rotationAxis.copy(this._offset).cross(this.eye).normalize(),this.rotationAngle=this._offset.dot(a.copy(this.rotationAxis).cross(this.eye))*e):"X"!==t&&"Y"!==t&&"Z"!==t||(this.rotationAxis.copy(l[t]),a.copy(l[t]),"local"===d&&a.applyQuaternion(this.worldQuaternion),this.rotationAngle=this._offset.dot(a.cross(this.eye).normalize())*e),this.rotationSnap&&(this.rotationAngle=Math.round(this.rotationAngle/this.rotationSnap)*this.rotationSnap),"local"===d&&"E"!==t&&"XYZE"!==t?(n.quaternion.copy(this._quaternionStart),n.quaternion.multiply(s.setFromAxisAngle(this.rotationAxis,this.rotationAngle)).normalize()):(this.rotationAxis.applyQuaternion(this._parentQuaternionInv),n.quaternion.copy(s.setFromAxisAngle(this.rotationAxis,this.rotationAngle)),n.quaternion.multiply(this._quaternionStart).normalize())}this.dispatchEvent(c),this.dispatchEvent(u)}}pointerUp(e){0===e.button&&(this.dragging&&null!==this.axis&&(p.mode=this.mode,this.dispatchEvent(p)),this.dragging=!1,this.axis=null)}dispose(){this.domElement.removeEventListener("pointerdown",this._onPointerDown),this.domElement.removeEventListener("pointermove",this._onPointerHover),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.domElement.removeEventListener("pointerup",this._onPointerUp),this.traverse((e=>{e.geometry&&e.geometry.dispose(),e.material&&e.material.dispose()}))}attach(e){return this.object=e,this.visible=!0,this}detach(){return this.object=void 0,this.visible=!1,this.axis=null,this}reset(){this.enabled&&this.dragging&&(this.object.position.copy(this._positionStart),this.object.quaternion.copy(this._quaternionStart),this.object.scale.copy(this._scaleStart),this.dispatchEvent(c),this.dispatchEvent(u),this.pointStart.copy(this.pointEnd))}getRaycaster(){return o}getMode(){return this.mode}setMode(e){this.mode=e}setTranslationSnap(e){this.translationSnap=e}setRotationSnap(e){this.rotationSnap=e}setScaleSnap(e){this.scaleSnap=e}setSize(e){this.size=e}setSpace(e){this.space=e}update(){console.warn("THREE.TransformControls: update function has no more functionality and therefore has been deprecated.")}}function h(e){if(this.domElement.ownerDocument.pointerLockElement)return{x:0,y:0,button:e.button};const t=this.domElement.getBoundingClientRect();return{x:(e.clientX-t.left)/t.width*2-1,y:-(e.clientY-t.top)/t.height*2+1,button:e.button}}function g(e){if(this.enabled)switch(e.pointerType){case"mouse":case"pen":this.pointerHover(this._getPointer(e))}}function f(e){this.enabled&&(document.pointerLockElement||this.domElement.setPointerCapture(e.pointerId),this.domElement.addEventListener("pointermove",this._onPointerMove),this.pointerHover(this._getPointer(e)),this.pointerDown(this._getPointer(e)))}function v(e){this.enabled&&this.pointerMove(this._getPointer(e))}function y(e){this.enabled&&(this.domElement.releasePointerCapture(e.pointerId),this.domElement.removeEventListener("pointermove",this._onPointerMove),this.pointerUp(this._getPointer(e)))}function _(e,t,r){const n=t.intersectObject(e,!0);for(let e=0;e<n.length;e++)if(n[e].object.visible||r)return n[e];return!1}m.prototype.isTransformControls=!0;const x=new n.Euler,b=new n.Vector3(0,1,0),w=new n.Vector3(0,0,0),M=new n.Matrix4,C=new n.Quaternion,E=new n.Quaternion,S=new n.Vector3,A=new n.Matrix4,P=new n.Vector3(1,0,0),z=new n.Vector3(0,1,0),D=new n.Vector3(0,0,1),T=new n.Vector3,k=new n.Vector3,O=new n.Vector3;class j extends n.Object3D{constructor(){super(),this.type="TransformControlsGizmo";const e=new n.MeshBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),t=new n.LineBasicMaterial({depthTest:!1,depthWrite:!1,fog:!1,toneMapped:!1,transparent:!0}),r=e.clone();r.opacity=.15;const o=t.clone();o.opacity=.5;const a=e.clone();a.color.setHex(16711680);const i=e.clone();i.color.setHex(65280);const s=e.clone();s.color.setHex(255);const l=e.clone();l.color.setHex(16711680),l.opacity=.5;const c=e.clone();c.color.setHex(65280),c.opacity=.5;const d=e.clone();d.color.setHex(255),d.opacity=.5;const p=e.clone();p.opacity=.25;const u=e.clone();u.color.setHex(16776960),u.opacity=.25,e.clone().color.setHex(16776960);const m=e.clone();m.color.setHex(7895160);const h=new n.CylinderGeometry(0,.04,.1,12);h.translate(0,.05,0);const g=new n.BoxGeometry(.08,.08,.08);g.translate(0,.04,0);const f=new n.BufferGeometry;f.setAttribute("position",new n.Float32BufferAttribute([0,0,0,1,0,0],3));const v=new n.CylinderGeometry(.0075,.0075,.5,3);function y(e,t){const r=new n.TorusGeometry(e,.0075,3,64,t*Math.PI*2);return r.rotateY(Math.PI/2),r.rotateX(Math.PI/2),r}v.translate(0,.25,0);const _={X:[[new n.Mesh(h,a),[.5,0,0],[0,0,-Math.PI/2]],[new n.Mesh(h,a),[-.5,0,0],[0,0,Math.PI/2]],[new n.Mesh(v,a),[0,0,0],[0,0,-Math.PI/2]]],Y:[[new n.Mesh(h,i),[0,.5,0]],[new n.Mesh(h,i),[0,-.5,0],[Math.PI,0,0]],[new n.Mesh(v,i)]],Z:[[new n.Mesh(h,s),[0,0,.5],[Math.PI/2,0,0]],[new n.Mesh(h,s),[0,0,-.5],[-Math.PI/2,0,0]],[new n.Mesh(v,s),null,[Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.OctahedronGeometry(.1,0),p.clone()),[0,0,0]]],XY:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),d.clone()),[.15,.15,0]]],YZ:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),l.clone()),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),c.clone()),[.15,0,.15],[-Math.PI/2,0,0]]]},x={X:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.OctahedronGeometry(.2,0),r)]],XY:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]]},b={START:[[new n.Mesh(new n.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],END:[[new n.Mesh(new n.OctahedronGeometry(.01,2),o),null,null,null,"helper"]],DELTA:[[new n.Line(function(){const e=new n.BufferGeometry;return e.setAttribute("position",new n.Float32BufferAttribute([0,0,0,1,1,1],3)),e}(),o),null,null,null,"helper"]],X:[[new n.Line(f,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.Line(f,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.Line(f,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]},w={XYZE:[[new n.Mesh(y(.5,1),m),null,[0,Math.PI/2,0]]],X:[[new n.Mesh(y(.5,.5),a)]],Y:[[new n.Mesh(y(.5,.5),i),null,[0,0,-Math.PI/2]]],Z:[[new n.Mesh(y(.5,.5),s),null,[0,Math.PI/2,0]]],E:[[new n.Mesh(y(.75,1),u),null,[0,Math.PI/2,0]]]},M={AXIS:[[new n.Line(f,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]]},C={XYZE:[[new n.Mesh(new n.SphereGeometry(.25,10,8),r)]],X:[[new n.Mesh(new n.TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,-Math.PI/2,-Math.PI/2]]],Y:[[new n.Mesh(new n.TorusGeometry(.5,.1,4,24),r),[0,0,0],[Math.PI/2,0,0]]],Z:[[new n.Mesh(new n.TorusGeometry(.5,.1,4,24),r),[0,0,0],[0,0,-Math.PI/2]]],E:[[new n.Mesh(new n.TorusGeometry(.75,.1,2,24),r)]]},E={X:[[new n.Mesh(g,a),[.5,0,0],[0,0,-Math.PI/2]],[new n.Mesh(v,a),[0,0,0],[0,0,-Math.PI/2]],[new n.Mesh(g,a),[-.5,0,0],[0,0,Math.PI/2]]],Y:[[new n.Mesh(g,i),[0,.5,0]],[new n.Mesh(v,i)],[new n.Mesh(g,i),[0,-.5,0],[0,0,Math.PI]]],Z:[[new n.Mesh(g,s),[0,0,.5],[Math.PI/2,0,0]],[new n.Mesh(v,s),[0,0,0],[Math.PI/2,0,0]],[new n.Mesh(g,s),[0,0,-.5],[-Math.PI/2,0,0]]],XY:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),d),[.15,.15,0]]],YZ:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),l),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.BoxGeometry(.15,.15,.01),c),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.BoxGeometry(.1,.1,.1),p.clone())]]},S={X:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[.3,0,0],[0,0,-Math.PI/2]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[-.3,0,0],[0,0,Math.PI/2]]],Y:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,.3,0]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,-.3,0],[0,0,Math.PI]]],Z:[[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,0,.3],[Math.PI/2,0,0]],[new n.Mesh(new n.CylinderGeometry(.2,0,.6,4),r),[0,0,-.3],[-Math.PI/2,0,0]]],XY:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[.15,.15,0]]],YZ:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[0,.15,.15],[0,Math.PI/2,0]]],XZ:[[new n.Mesh(new n.BoxGeometry(.2,.2,.01),r),[.15,0,.15],[-Math.PI/2,0,0]]],XYZ:[[new n.Mesh(new n.BoxGeometry(.2,.2,.2),r),[0,0,0]]]},A={X:[[new n.Line(f,o.clone()),[-1e3,0,0],null,[1e6,1,1],"helper"]],Y:[[new n.Line(f,o.clone()),[0,-1e3,0],[0,0,Math.PI/2],[1e6,1,1],"helper"]],Z:[[new n.Line(f,o.clone()),[0,0,-1e3],[0,-Math.PI/2,0],[1e6,1,1],"helper"]]};function P(e){const t=new n.Object3D;for(const r in e)for(let n=e[r].length;n--;){const o=e[r][n][0].clone(),a=e[r][n][1],i=e[r][n][2],s=e[r][n][3],l=e[r][n][4];o.name=r,o.tag=l,a&&o.position.set(a[0],a[1],a[2]),i&&o.rotation.set(i[0],i[1],i[2]),s&&o.scale.set(s[0],s[1],s[2]),o.updateMatrix();const c=o.geometry.clone();c.applyMatrix4(o.matrix),o.geometry=c,o.renderOrder=1/0,o.position.set(0,0,0),o.rotation.set(0,0,0),o.scale.set(1,1,1),t.add(o)}return t}this.gizmo={},this.picker={},this.helper={},this.add(this.gizmo.translate=P(_)),this.add(this.gizmo.rotate=P(w)),this.add(this.gizmo.scale=P(E)),this.add(this.picker.translate=P(x)),this.add(this.picker.rotate=P(C)),this.add(this.picker.scale=P(S)),this.add(this.helper.translate=P(b)),this.add(this.helper.rotate=P(M)),this.add(this.helper.scale=P(A)),this.picker.translate.visible=!1,this.picker.rotate.visible=!1,this.picker.scale.visible=!1}updateMatrixWorld(e){const t="local"===("scale"===this.mode?"local":this.space)?this.worldQuaternion:E;this.gizmo.translate.visible="translate"===this.mode,this.gizmo.rotate.visible="rotate"===this.mode,this.gizmo.scale.visible="scale"===this.mode,this.helper.translate.visible="translate"===this.mode,this.helper.rotate.visible="rotate"===this.mode,this.helper.scale.visible="scale"===this.mode;let r=[];r=r.concat(this.picker[this.mode].children),r=r.concat(this.gizmo[this.mode].children),r=r.concat(this.helper[this.mode].children);for(let e=0;e<r.length;e++){const n=r[e];let o;if(n.visible=!0,n.rotation.set(0,0,0),n.position.copy(this.worldPosition),o=this.camera.isOrthographicCamera?(this.camera.top-this.camera.bottom)/this.camera.zoom:this.worldPosition.distanceTo(this.cameraPosition)*Math.min(1.9*Math.tan(Math.PI*this.camera.fov/360)/this.camera.zoom,7),n.scale.set(1,1,1).multiplyScalar(o*this.size/4),"helper"!==n.tag){if(n.quaternion.copy(t),"translate"===this.mode||"scale"===this.mode){const e=.99,r=.2;"X"===n.name&&Math.abs(b.copy(P).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Y"===n.name&&Math.abs(b.copy(z).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"Z"===n.name&&Math.abs(b.copy(D).applyQuaternion(t).dot(this.eye))>e&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XY"===n.name&&Math.abs(b.copy(D).applyQuaternion(t).dot(this.eye))<r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"YZ"===n.name&&Math.abs(b.copy(P).applyQuaternion(t).dot(this.eye))<r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1),"XZ"===n.name&&Math.abs(b.copy(z).applyQuaternion(t).dot(this.eye))<r&&(n.scale.set(1e-10,1e-10,1e-10),n.visible=!1)}else"rotate"===this.mode&&(C.copy(t),b.copy(this.eye).applyQuaternion(s.copy(t).invert()),-1!==n.name.search("E")&&n.quaternion.setFromRotationMatrix(M.lookAt(this.eye,w,z)),"X"===n.name&&(s.setFromAxisAngle(P,Math.atan2(-b.y,b.z)),s.multiplyQuaternions(C,s),n.quaternion.copy(s)),"Y"===n.name&&(s.setFromAxisAngle(z,Math.atan2(b.x,b.z)),s.multiplyQuaternions(C,s),n.quaternion.copy(s)),"Z"===n.name&&(s.setFromAxisAngle(D,Math.atan2(b.y,b.x)),s.multiplyQuaternions(C,s),n.quaternion.copy(s)));n.visible=n.visible&&(-1===n.name.indexOf("X")||this.showX),n.visible=n.visible&&(-1===n.name.indexOf("Y")||this.showY),n.visible=n.visible&&(-1===n.name.indexOf("Z")||this.showZ),n.visible=n.visible&&(-1===n.name.indexOf("E")||this.showX&&this.showY&&this.showZ),n.material._color=n.material._color||n.material.color.clone(),n.material._opacity=n.material._opacity||n.material.opacity,n.material.color.copy(n.material._color),n.material.opacity=n.material._opacity,this.enabled&&this.axis&&(n.name===this.axis||this.axis.split("").some((e=>n.name===e)))&&(n.material.color.setHex(16776960),n.material.opacity=1)}else n.visible=!1,"AXIS"===n.name?(n.position.copy(this.worldPositionStart),n.visible=!!this.axis,"X"===this.axis&&(s.setFromEuler(x.set(0,0,0)),n.quaternion.copy(t).multiply(s),Math.abs(b.copy(P).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Y"===this.axis&&(s.setFromEuler(x.set(0,0,Math.PI/2)),n.quaternion.copy(t).multiply(s),Math.abs(b.copy(z).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"Z"===this.axis&&(s.setFromEuler(x.set(0,Math.PI/2,0)),n.quaternion.copy(t).multiply(s),Math.abs(b.copy(D).applyQuaternion(t).dot(this.eye))>.9&&(n.visible=!1)),"XYZE"===this.axis&&(s.setFromEuler(x.set(0,Math.PI/2,0)),b.copy(this.rotationAxis),n.quaternion.setFromRotationMatrix(M.lookAt(w,b,z)),n.quaternion.multiply(s),n.visible=this.dragging),"E"===this.axis&&(n.visible=!1)):"START"===n.name?(n.position.copy(this.worldPositionStart),n.visible=this.dragging):"END"===n.name?(n.position.copy(this.worldPosition),n.visible=this.dragging):"DELTA"===n.name?(n.position.copy(this.worldPositionStart),n.quaternion.copy(this.worldQuaternionStart),a.set(1e-10,1e-10,1e-10).add(this.worldPositionStart).sub(this.worldPosition).multiplyScalar(-1),a.applyQuaternion(this.worldQuaternionStart.clone().invert()),n.scale.copy(a),n.visible=this.dragging):(n.quaternion.copy(t),this.dragging?n.position.copy(this.worldPositionStart):n.position.copy(this.worldPosition),this.axis&&(n.visible=-1!==this.axis.search(n.name)))}super.updateMatrixWorld(e)}}j.prototype.isTransformControlsGizmo=!0;class I extends n.Mesh{constructor(){super(new n.PlaneGeometry(1e5,1e5,2,2),new n.MeshBasicMaterial({visible:!1,wireframe:!0,side:n.DoubleSide,transparent:!0,opacity:.1,toneMapped:!1})),this.type="TransformControlsPlane"}updateMatrixWorld(e){let t=this.space;switch(this.position.copy(this.worldPosition),"scale"===this.mode&&(t="local"),T.copy(P).applyQuaternion("local"===t?this.worldQuaternion:E),k.copy(z).applyQuaternion("local"===t?this.worldQuaternion:E),O.copy(D).applyQuaternion("local"===t?this.worldQuaternion:E),b.copy(k),this.mode){case"translate":case"scale":switch(this.axis){case"X":b.copy(this.eye).cross(T),S.copy(T).cross(b);break;case"Y":b.copy(this.eye).cross(k),S.copy(k).cross(b);break;case"Z":b.copy(this.eye).cross(O),S.copy(O).cross(b);break;case"XY":S.copy(O);break;case"YZ":S.copy(T);break;case"XZ":b.copy(O),S.copy(k);break;case"XYZ":case"E":S.set(0,0,0)}break;default:S.set(0,0,0)}0===S.length()?this.quaternion.copy(this.cameraQuaternion):(A.lookAt(a.set(0,0,0),S,b),this.quaternion.setFromRotationMatrix(A)),super.updateMatrixWorld(e)}}I.prototype.isTransformControlsPlane=!0},2976:(e,t,r)=>{const n=r(108),o=r(2736),a=r(2460)(n),i=r(7290),s=r(2960),l=r(9034),c=r(5321);function d(e,t,r,o){const i=new n.BufferGeometry,s=new n.Object3D,l=t.wireframe?n.MeshBasicMaterial:n.MeshPhongMaterial;let c,d,p;return s.position.set(o.offset[0]/r.width,o.offset[1]/r.height,o.offset[2]/r.length),s.updateMatrix(),i.setAttribute("position",new n.BufferAttribute(new Float32Array(o.vertices),3)),i.setAttribute("color",new n.BufferAttribute(new Float32Array(o.colors),3)),i.computeBoundingSphere(),i.computeBoundingBox(),s.add(new n.Mesh(i,new l({vertexColors:n.VertexColors,flatShading:!0,opacity:t.opacity,depthWrite:1===t.opacity,transparent:1!==t.opacity,side:n.DoubleSide,wireframe:t.wireframe}))),t.outlines&&!t.wireframe&&(c=(new n.Matrix4).fromArray(t.model_matrix.data).getMaxScaleOnAxis()/(10*Math.max(r.width,r.height,r.length)),d=new a.MeshLine,p=new a.MeshLineMaterial({color:new n.Color(t.outlines_color),opacity:.75*t.opacity,sizeAttenuation:!0,depthWrite:!1,transparent:!0,lineWidth:c,resolution:new n.Vector2(e.getWorld().width,e.getWorld().height),side:n.DoubleSide}),p.userData={outline:!0},d.setGeometry(new Float32Array(o.outlines),!0),d.geometry.computeBoundingSphere(),d.geometry.computeBoundingBox(),s.add(new n.Mesh(d.geometry,p))),s}e.exports={create(e,t,r,a){const p=new Set;return new Promise((u=>{let m;const h=new n.Group;let g;const f=new n.Mesh(new n.BoxGeometry(1.2/r[0],1.2/r[1],1.2/r[2]).translate(.5/r[0],.5/r[1],.5/r[2]),new n.MeshBasicMaterial({color:16711680,opacity:.5,transparent:!0})),{colorsToFloat32Array:v}=c;let y,_;e.opacity=void 0!==e.opacity?e.opacity:1,e.visible=void 0===e.visible||e.visible,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.outlines=void 0===e.outlines||e.outlines,e.outlines_color=void 0!==e.outlines_color?e.outlines_color:0;const x=(new n.Matrix4).fromArray(e.model_matrix.data);m=e.color_map.data||[16711680,65280,255,16776960,16711935,65535],m=v(m),h.holdRemeshing=e._hold_remeshing||!1,h.voxelSize={width:r[0],height:r[1],length:r[2]},h.rebuildChunk=function(){!function(e,t){const r={};console.log(`K3D.Voxels rebuildChunk Count:${t.size}`),e.children.forEach((e=>{e.voxel&&(r[e.voxel.chunk.id]=e)})),t.forEach((e=>{const t=r[e];let n;if(t){n=t.voxel.getVoxelChunkObject(t.voxel.generate());for(let e=0;e<t.children.length;e++)t.children[e].geometry.dispose(),t.children[e].geometry=n.children[e].geometry}})),t.clear()}(h,p),a.render()},h.updateChunk=function(e,t){h.children.some((r=>!(!r.voxel||r.voxel.chunk.id!==e.id||(r.voxel.chunk.voxels.data=e.voxels.data,p.add(e.id),t||r.voxel.chunk.voxels.neighbours.forEach((e=>{p.add(e.id)})),h.holdRemeshing||h.rebuildChunk(),0))))},h.voxelsChunks=t,h.addChunk=function(t){const r=s.initializeGreedyVoxelMesh(t,m,h.voxelSize,e.outlines,e.opacity<1);let n;return n=h.holdRemeshing?{offset:t.offset,vertices:[],colors:[],outlines:[]}:r(),g=d(a,e,h.voxelSize,n),g.voxel={generate:r,chunk:t,getVoxelChunkObject:d.bind(this,a,e,h.voxelSize)},n.vertices.length>0&&(g.children[0].geometry.boundsTree=new o.MeshBVH(g.children[0].geometry)),g.children[0].interactions=l(h,g,f,a),h.add(g),g},i(t.length,20,(e=>{h.addChunk(t[e])}),(()=>{h.position.set(-.5,-.5,-.5),h.initialPosition=h.position.clone(),h.updateMatrix(),x.set.apply(x,e.model_matrix.data),h.applyMatrix4(x),f.visible=!1,f.geometry.computeBoundingSphere(),f.geometry.computeBoundingBox(),h.add(f),h.updateMatrixWorld(),y=a.on(a.events.VIEW_MODE_CHANGE,(()=>{f.visible=!1})),_=a.on(a.events.RESIZED,(()=>{h.children.forEach((e=>{e.children[1]&&(e.children[1].material.uniforms.resolution.value.x=a.getWorld().width,e.children[1].material.uniforms.resolution.value.y=a.getWorld().height)}))})),h.onRemove=function(){a.off(a.events.VIEW_MODE_CHANGE,y),a.off(a.events.RESIZED,_)},u(h)}))}))},generateRegularChunks(e,t,r){const n=[],o=Math.ceil(t[2]/e),a=Math.ceil(t[1]/e),i=Math.ceil(t[0]/e);let s,l,c,d;for(s=0,d=0;s<o;s++)for(l=0;l<a;l++)for(c=0;c<i;c++,d++)n.push({voxels:r,size:[t[2]-(s+1)*e>0?e:t[2]-s*e,t[1]-(l+1)*e>0?e:t[1]-l*e,t[0]-(c+1)*e>0?e:t[0]-c*e],offset:[s*e,l*e,c*e],multiple:1,idx:d});return n}}},8175:(e,t,r)=>{const n=r(108),{cameraModes:o}=r(7996),{recalculateFrustum:a}=r(9724);e.exports=function(e){this.camera=new n.PerspectiveCamera(e.parameters.cameraFov,this.width/this.height,.1,1e3),this.camera.position.set(2,-3,.2),this.camera.up.set(0,0,1),this.camera.frustum=new n.Frustum,this.axesHelper.camera=new n.PerspectiveCamera(e.parameters.cameraFov,this.axesHelper.width/this.axesHelper.height,.1,1e3),this.axesHelper.camera.position.set(2,.5,.5),this.axesHelper.camera.lookAt(.5,.5,.5),this.axesHelper.camera.up.copy(this.camera.up),this.setupCamera=function(e,t,r){t&&void 0!==this.camera.fov&&void 0!==this.axesHelper.camera.fov&&(this.camera.fov=t,this.axesHelper.camera.fov=t,this.controls.dispatchEvent({type:"change"})),e&&(this.controls.object.position.fromArray(e),9===e.length&&this.controls.object.up.fromArray(e,6),this.controls.target.fromArray(e,3)),this.camera.updateProjectionMatrix(),this.axesHelper.camera.updateProjectionMatrix(),a(this.camera),this.controls.update(r)},this.setCameraToFitScene=function(t,r){let a=(new n.Box3).setFromArray(e.parameters.grid);if(!e.parameters.cameraAutoFit&&!t)return;a=e.getSceneBoundingBox()||a,void 0===r&&(r=1.5);const i=a.getBoundingSphere(new n.Sphere),s=i.radius*r/Math.sin(n.Math.degToRad(e.parameters.cameraFov/2));this.camera.position.subVectors(i.center,this.camera.getWorldDirection(new n.Vector3).setLength(s)),e.parameters.cameraMode===o.fly?this.controls.target=this.camera.position.clone().add(this.camera.getWorldDirection(new n.Vector3).setLength(s/2)):this.controls.target=i.center,this.controls.update()}}},2794:(e,t,r)=>{const n=r(108),{cameraModes:o}=r(7996),{recalculateFrustum:a}=r(9724);function i(e,t,r){r.getCameraArray=function(){const t=[];return e.controls.object.position.toArray(t),e.controls.target.toArray(t,3),e.controls.object.up.toArray(t,6),t},r.addEventListener("change",(r=>{const o=r.target.getCameraArray();a(e.camera),t.dispatch(t.events.CAMERA_CHANGE,o);const i=1.5/Math.tan(n.Math.degToRad(t.parameters.cameraFov/2));e.axesHelper.camera.position.copy(e.camera.position.clone().sub(e.controls.target).normalize().multiplyScalar(i)),e.axesHelper.camera.lookAt(0,0,0),e.axesHelper.camera.up.copy(e.camera.up)})),r.addEventListener("change",(()=>{e.render()}))}function s(e,t){return t.parameters.cameraMode===o.trackball?function(e,t){const r=new n.TrackballControls(e.camera,e.renderer.domElement);return r.type=o.trackball,r.rotateSpeed=t.parameters.cameraRotateSpeed,r.zoomSpeed=t.parameters.cameraZoomSpeed,r.panSpeed=t.parameters.cameraPanSpeed,t.parameters.cameraDampingFactor>0?(r.staticMoving=!1,r.dynamicDampingFactor=t.parameters.cameraDampingFactor):r.staticMoving=!0,i(e,t,r),r}(e,t):t.parameters.cameraMode===o.orbit?function(e,t){const r=new n.OrbitControls(e.camera,e.renderer.domElement);return r.type=o.orbit,r.rotateSpeed=t.parameters.cameraRotateSpeed,t.parameters.cameraDampingFactor>0?(r.enableDamping=!0,r.dampingFactor=t.parameters.cameraDampingFactor):r.enableDamping=!1,r.screenSpacePanning=!1,r.maxPolarAngle=Math.PI,r.screenSpacePanning=!0,i(e,t,r),r}(e,t):t.parameters.cameraMode===o.fly?function(e,t){const r=new n.TrackballControls(e.camera,e.renderer.domElement);return r.type=o.fly,r.rotateSpeed=t.parameters.cameraRotateSpeed,r.zoomSpeed=t.parameters.cameraZoomSpeed,r.panSpeed=t.parameters.cameraPanSpeed,r.flyMode=!0,t.parameters.cameraDampingFactor>0?(r.staticMoving=!1,r.dynamicDampingFactor=t.parameters.cameraDampingFactor):r.staticMoving=!0,i(e,t,r),r}(e,t):null}e.exports=function(e){const t=this;let r,n=null;const o=new Float32Array(64);let a=0,i=1;function l(t){return t<1e3/(2*e.parameters.minimumFps)?Math.min(1.5*i,1):i/Math.min(1.25*t/(1e3/e.parameters.minimumFps),5)}function c(t){return{x:t.offsetX/e.getWorld().targetDOMNode.offsetWidth*2-1,y:-t.offsetY/e.getWorld().targetDOMNode.offsetHeight*2+1}}function d(e){r=c(e)}function p(t){const n=c(t);r.x===n.x&&r.y===n.y&&e.dispatch(e.events.MOUSE_CLICK,n)}function u(t){e.dispatch(e.events.MOUSE_MOVE,c(t))}this.renderer.setSize(this.width,this.height),this.targetDOMNode.appendChild(this.renderer.domElement),this.renderer.domElement.addEventListener("pointermove",u,!1),this.renderer.domElement.addEventListener("pointerdown",d,!1),this.renderer.domElement.addEventListener("pointerup",p,!1),this.controls=s(t,e),e.on(e.events.RESIZED,(()=>{t.controls.handleResize&&t.controls.handleResize()})),window.addEventListener("visibilitychange",(()=>{n=null})),this.changeControls=function(r){(t.controls.type!==e.parameters.cameraMode||r)&&(t.controls&&t.controls.dispose(),t.controls=s(t,e))},function r(s,c){if(e.parameters.minimumFps>0){if(!s)return void requestAnimationFrame(r);if(null===n)return n=s,void requestAnimationFrame(r);const d=s;if(e.frameInterval=d-n,n=d,c>0||e.heavyOperationAsync||e.heavyOperationSync)return e.heavyOperationSync&&(c=16,e.heavyOperationSync=!1),t.controls.update(),void requestAnimationFrame((e=>{r(e,c-1)}));o[a]=e.frameInterval,a=(a+1)%o.length;const p=o.reduce(((e,t)=>e+t),0)/o.length;let u=0;for(let e=a-8+o.length;e<a+o.length;e++)u+=o[e%o.length];u/=8;const h=i;if(e.frameInterval>2e3/e.parameters.minimumFps?i=l(e.frameInterval):u>1e3/e.parameters.minimumFps?i=l(u):p<1e3/(2*e.parameters.minimumFps)&&(i=l(p)),h!==i)return console.log("qualityFactor",i),m=i,t.renderer.setPixelRatio(window.devicePixelRatio*m),e.render(),o.fill(1e3/(1.5*e.parameters.minimumFps)),void requestAnimationFrame((e=>{r(e,16)}))}var m;const{targetDOMNode:h}=e.getWorld();if(h.ownerDocument.contains(h)||e.disable(),e.disabling)return t.renderer.domElement.removeEventListener("pointermove",u),t.renderer.domElement.removeEventListener("pointerdown",d),t.renderer.domElement.removeEventListener("pointerup",p),void t.controls.dispose();t.controls.update(),requestAnimationFrame(r)}()}},6615:(e,t,r)=>{const n=r(108),{viewModes:o}=r(7861);e.exports=function(e){const t=e.getWorld();let r=!1;e.on(e.events.VIEW_MODE_CHANGE,(a=>{a===o.manipulate?t.K3DObjects.children.forEach((o=>{if(!o.transformControls&&t.ObjectsListJson[o.K3DIdentifier].model_matrix){const a=new n.TransformControls(t.camera,t.renderer.domElement);a.addEventListener("change",(()=>{t.render()})),a.addEventListener("dragging-changed",(e=>{t.controls.enabled=!e.value,!1===r&&e.value&&(r=!0,t.K3DObjects.children.forEach((t=>{t.transformControls&&t.transformControls!==e.target&&(t.transformControls.enabled=!1)}))),!0!==r||e.value||(r=!1,t.K3DObjects.children.forEach((e=>{e.transformControls&&(e.transformControls.enabled=!0)})))})),a.setMode(e.parameters.manipulateMode),t.scene.add(a),a.attach(o),o.transformControls=a}})):t.K3DObjects.children.forEach((e=>{e.transformControls&&(e.transformControls.detach(),e.transformControls.dispose(),delete e.transformControls)}))})),e.on(e.events.MANIPULATE_MODE_CHANGE,(e=>{t.K3DObjects.children.forEach((t=>{t.transformControls&&-1!==["translate","rotate","scale"].indexOf(e)&&t.transformControls.setMode(e)}))}))}},5567:(e,t,r)=>{const n=r(108),{error:o}=r(6482),a=r(6841);e.exports=function(e){const t=this;let r=null;const i=document.createElement("canvas"),s=i.getContext("webgl2",{antialias:e.parameters.antialias>0,preserveDrawingBuffer:!0,alpha:!0,stencil:!0,powerPreference:"high-performance"});function l(t){t.preventDefault(),e.disable(),o("WEBGL Error","Context lost.",!1)}t.renderer=new n.WebGLRenderer({alpha:!0,precision:"highp",premultipliedAlpha:!0,antialias:e.parameters.antialias>0,logarithmicDepthBuffer:e.parameters.logarithmicDepthBuffer,canvas:i,context:s}),s||("undefined"!=typeof WebGL2RenderingContext?o("Your browser appears to support WebGL2 but it might be disabled. Try updating your OS and/or video card driver.",!0):o("It's look like your browser has no WebGL2 support.",!0)),i.addEventListener("webglcontextlost",l,!1),t.renderer.removeContextLossListener=function(){i.removeEventListener("webglcontextlost",l)};const c=t.renderer.getContext(),d=c.getExtension("WEBGL_debug_renderer_info");function p(e,r,n){void 0===n&&(n=null),t.renderer.setRenderTarget(n),t.renderer.render(e,r)}function u(){const r=p;return new Promise((o=>{if(e.disabling)return void o(null);const a=new n.Vector2;t.renderer.getSize(a),e.refreshGrid(),t.renderer.clippingPlanes=[],t.camera.updateMatrixWorld(),t.renderer.clear(),t.renderer.render(t.gridScene,t.camera),t.renderer.setViewport(a.x-t.axesHelper.width,0,t.axesHelper.width,t.axesHelper.height),t.renderer.render(t.axesHelper.scene,t.axesHelper.camera),t.renderer.setViewport(0,0,a.x,a.y),e.parameters.clippingPlanes.forEach((e=>{t.renderer.clippingPlanes.push(new n.Plane((new n.Vector3).fromArray(e),e[3]))})),e.dispatch(e.events.BEFORE_RENDER);let i=Promise.resolve();const s=t.controls.enabled;!function(n,o,s,l){const c=[];if(e.parameters.renderingSteps>1){const t=s/e.parameters.renderingSteps;for(let r=0;r<e.parameters.renderingSteps;r++){const e=Math.round(r*t),n=Math.min(Math.round((r+1)*t),s);c.push([e,n-e])}}e.parameters.renderingSteps>1?(t.controls.enabled=!1,t.controls.beforeRender&&(i=i.then((()=>{t.controls.beforeRender()}))),c.forEach((e=>{i=i.then((()=>{t.renderer.setViewport(0+e[0],0,e[1],l),t.camera.setViewOffset(a.x,a.y,e[0],0,e[1],a.y),r(t.scene,t.camera)})),i=i.then((()=>new Promise((e=>{setTimeout(e,50)}))))})),t.controls.afterRender&&(i=i.then((()=>{t.controls.afterRender()})))):i=i.then((()=>{t.controls.beforeRender&&t.controls.beforeRender(),t.renderer.setViewport(0,0,s,l),r(t.scene,t.camera),t.controls.afterRender&&t.controls.afterRender()}))}(0,0,a.x,a.y),i=i.then((()=>{t.controls.enabled=s,t.renderer.setViewport(0,0,a.x,a.y),t.camera.clearViewOffset(),e.dispatch(e.events.RENDERED),e.autoRendering?requestAnimationFrame(u):o(!0)})),o(null)}))}console.log("K3D: (UNMASKED_VENDOR_WEBGL)",c.getParameter(d.UNMASKED_VENDOR_WEBGL)),console.log("K3D: (UNMASKED_RENDERER_WEBGL)",c.getParameter(d.UNMASKED_RENDERER_WEBGL)),console.log("K3D: (depth bits)",c.getParameter(c.DEPTH_BITS)),console.log("K3D: (stencil bits)",c.getParameter(c.STENCIL_BITS)),this.renderer.setClearColor(0,0),this.renderer.autoClear=!1,this.render=function(t){if(e.labels=[],!e.autoRendering||t){if(null===r)return r=u().then((()=>{r=null})),r;t&&(r=r.then(u).then((()=>{r=null})))}return r},this.renderOffScreen=function(r,o){const i=[],s=Math.max(Math.min(128,e.parameters.renderingSteps),1),l=Math.max(Math.min(5,e.parameters.antialias),0),c=p,d=o/s,u=new n.Vector2;t.renderer.getSize(u);const m=Math.max(r/u.x,o/u.y);for(let e=0;e<s;e++){const t=Math.round(e*d),r=Math.min(Math.round((e+1)*d),o);i.push([t,r-t])}const h=new n.WebGLRenderTarget(r,Math.ceil(o/s),{type:n.FloatType}),g=new n.WebGLRenderTarget(t.axesHelper.width*m,t.axesHelper.height*m,{type:n.FloatType});return t.renderer.clippingPlanes=[],a(t.renderer,t.axesHelper.scene,t.axesHelper.camera,g,g.width,g.height,[[0,g.height]],l,p).then((s=>{const d=new Uint8ClampedArray(r*o*4);for(let e=0;e<g.height;e++)d.set(s.slice(e*g.width*4,(e+1)*g.width*4),4*(e*r+r-g.width));return a(t.renderer,t.gridScene,t.camera,h,r,o,[[0,o]],l,p).then((s=>(e.parameters.clippingPlanes.forEach((e=>{t.renderer.clippingPlanes.push(new n.Plane((new n.Vector3).fromArray(e),e[3]))})),a(t.renderer,t.scene,t.camera,h,r,o,i,l,c).then((e=>(h.dispose(),[s,e,d]))))))}))}}},404:(e,t,r)=>{const n=r(108),o=r(5843),a=r(2932),i=r(860),s=r(2460)(n),{viewModes:l}=r(7861),{pow10ceil:c}=r(984);let d=null;function p(e){const t=new n.Box3;let r,o=e.getWorld();return Object.keys(o.ObjectsListJson).forEach((function(e){let n=o.ObjectsById[e];n&&n.traverse((e=>{if(e&&void 0!==e.position.z&&e.visible&&(e.geometry||e.boundingBox)){if(e.geometry&&e.geometry.boundingBox)r=e.geometry.boundingBox.clone();else{if(!e.boundingBox)return void console.log("Object without bbox");r=e.boundingBox.clone()}r.applyMatrix4(e.matrixWorld),t.union(r)}}))})),t.getSize(new n.Vector3).lengthSq()<Number.EPSILON&&t.max.addScalar(.1),t.isEmpty()?null:t}function u(e,t){Object.keys(e.planes).forEach((r=>{e.planes[r].forEach((e=>{t.remove(e.obj),delete e.obj}))})),Object.keys(e.labelsOnPlanes).forEach((t=>{e.labelsOnPlanes[t].labels.forEach((e=>{e.onRemove()}))}))}function m(e,t,r,l){const p=this;if(d)return Promise.all(d).then((()=>m.bind(p)(e,t,r,l)));const h=[];let g,f,v,y,_,x,b=(new n.Box3).setFromArray(e.parameters.grid);const w={x:new n.Vector3(1,0,0),y:new n.Vector3(0,1,0),z:new n.Vector3(0,0,1)},M={"+x+y+z":["+x-y","+x-z","-x+y","+y-z","-x+z","-y+z"],"+x+y-z":["+x-y","+x+z","-x+y","+y+z","-x-z","-y-z"],"+x-y+z":["+x+y","+x-z","-x-y","-y-z","-x+z","+y+z"],"+x-y-z":["+x+y","+x+z","-x-y","-y+z","-x-z","+y-z"],"-x+y+z":["-x-y","-x-z","+x+y","+y-z","+x+z","-y+z"],"-x+y-z":["-x-y","-x+z","+x+y","+y+z","+x-z","-y-z"],"-x-y+z":["-x+y","-x-z","+x-y","-y-z","+x+z","+y+z"],"-x-y-z":["-x+y","-x+z","+x-y","-y+z","+x-z","+y-z"]},C=["x","x","y","y","z","z"],E=new n.Color(e.parameters.gridColor),S=new n.Color(e.parameters.labelColor);if(f=!e.parameters.axesHelper||e.parameters.axesHelper&&!r.x,r.x&&!f&&(f|=e.parameters.axes[0]!==r.x.text||e.parameters.axes[1]!==r.y.text||e.parameters.axes[2]!==r.z.text,f|=e.parameters.axesHelperColors[0]!==r.x.color||e.parameters.axesHelperColors[1]!==r.y.color||e.parameters.axesHelperColors[2]!==r.z.color),f&&(["x","y","z"].forEach((e=>{r[e]&&(r[e].onRemove(),r.scene.remove(r[e]),r[e]=null)})),r.arrows&&(r.scene.remove(r.arrows),r.arrows=null)),e.parameters.axesHelper>1?(r.width=e.parameters.axesHelper,r.height=e.parameters.axesHelper):e.parameters.axesHelper>0&&(r.width=100,r.height=100),f&&e.parameters.axesHelper>0&&function(e,t){const r=[],o=e.parameters.axesHelperColors,s={x:[1,0,0],y:[0,1,0],z:[0,0,1]},l={x:0,y:1,z:2},c=new n.Color(e.parameters.labelColor);["x","y","z"].forEach(((i,d)=>{const p=a.create({position:(new n.Vector3).fromArray(s[i]).multiplyScalar(1.1).toArray(),reference_point:"cc",color:c,text:e.parameters.axes[l[i]],size:.75},e,t);r.push(p.then((e=>{t[i]=e,t[i].color=o[d]})))}));const d=i.create({colors:{data:[o[0],o[0],o[1],o[1],o[2],o[2]]},origins:{data:[0,0,0,0,0,0,0,0,0]},vectors:{data:[].concat(s.x,s.y,s.z)},line_width:.05,head_size:2.5},e);return r.push(d.then((e=>{t.arrows=e,t.scene.add(e)}))),r}(e,r).forEach((e=>{h.push(e)})),e.parameters.gridAutoFit||l){for(b=e.getSceneBoundingBox()||b,u(t,this.gridScene),v=b.getSize(new n.Vector3),y=c(Math.max(v.x,v.y,v.z))/10,_=y/10,["x","y","z"].forEach((e=>{b.min[e]===b.max[e]&&(b.min[e]-=y/2,b.max[e]+=y/2)})),v=b.getSize(new n.Vector3),b.min=new n.Vector3(Math.floor(b.min.x/_)*_,Math.floor(b.min.y/_)*_,Math.floor(b.min.z/_)*_),b.max=new n.Vector3(Math.ceil(b.max.x/_)*_,Math.ceil(b.max.y/_)*_,Math.ceil(b.max.z/_)*_),v=b.getSize(new n.Vector3),t.planes={x:[{normal:new n.Vector3(-1,0,0),p1:new n.Vector3(b.max.x,b.min.y,b.min.z),p2:b.max},{normal:new n.Vector3(1,0,0),p1:b.min,p2:new n.Vector3(b.min.x,b.max.y,b.max.z)}],y:[{normal:new n.Vector3(0,-1,0),p1:new n.Vector3(b.min.x,b.max.y,b.min.z),p2:b.max},{normal:new n.Vector3(0,1,0),p1:b.min,p2:new n.Vector3(b.max.x,b.min.y,b.max.z)}],z:[{normal:new n.Vector3(0,0,-1),p1:new n.Vector3(b.min.x,b.min.y,b.max.z),p2:b.max},{normal:new n.Vector3(0,0,1),p1:b.min,p2:new n.Vector3(b.max.x,b.max.y,b.min.z)}]},A=b,g={"-x+z":[new n.Vector3(A.min.x,A.min.y,A.max.z),new n.Vector3(A.min.x,A.max.y,A.max.z)],"+y+z":[new n.Vector3(A.min.x,A.max.y,A.max.z),A.max],"+x+z":[new n.Vector3(A.max.x,A.min.y,A.max.z),A.max],"-y+z":[new n.Vector3(A.min.x,A.min.y,A.max.z),new n.Vector3(A.max.x,A.min.y,A.max.z)],"-x-z":[A.min,new n.Vector3(A.min.x,A.max.y,A.min.z)],"+y-z":[new n.Vector3(A.min.x,A.max.y,A.min.z),new n.Vector3(A.max.x,A.max.y,A.min.z)],"+x-z":[new n.Vector3(A.max.x,A.min.y,A.min.z),new n.Vector3(A.max.x,A.max.y,A.min.z)],"-y-z":[A.min,new n.Vector3(A.max.x,A.min.y,A.min.z)],"-x+y":[new n.Vector3(A.min.x,A.max.y,A.min.z),new n.Vector3(A.min.x,A.max.y,A.max.z)],"-x-y":[A.min,new n.Vector3(A.min.x,A.min.y,A.max.z)],"+x+y":[new n.Vector3(A.max.x,A.max.y,A.min.z),A.max],"+x-y":[new n.Vector3(A.max.x,A.min.y,A.min.z),new n.Vector3(A.max.x,A.min.y,A.max.z)]},x=0;x<8;x++){let r=(1&x?"-":"+")+"x"+(2&x?"-":"+")+"y"+(4&x?"-":"+")+"z";t.labelsOnPlanes[r]={},t.labelsOnPlanes[r].labels=[],M[r].forEach((function(i,s){let l,c,d;const p=o.difference(["x","y","z"],i.replace(/[^xyz]/g,"").split(""))[0];let u=w[p].clone().multiplyScalar(y),m=v[p]/y,f=g[i];if(m<=2){const e=m;m=Math.max(5*e,2),u=w[p].clone().multiplyScalar(e*y/m)}let x="+"===r[2*Math.floor(s/2)];for(l=1;l<=m-1;l++)c=f[0].clone().add(u.clone().multiplyScalar(l)).add(w[C[s]].clone().multiplyScalar(_*(x?1:-1))),d=a.create({position:c.toArray(),reference_point:"cc",color:S,text:parseFloat(c[p].toFixed(10)).toString(),size:.75},e),h.push(d.then((e=>{t.labelsOnPlanes[r].labels.push(e)})));c=(new n.Vector3).lerpVectors(f[0],f[1],.5).add(w[C[s]].clone().multiplyScalar(2*_*(x?1:-1))),a.create({position:c.toArray(),reference_point:"cc",color:S,text:e.parameters.axes[["x","y","z"].indexOf(p)],size:1},e).then((e=>{t.labelsOnPlanes[r].labels.push(e)}))}))}Object.keys(t.planes).forEach((function(r){t.planes[r].forEach((function(t){let o=[];const a=[],i=[],l=["x","y","z"].filter((e=>e!==r)),c=new s.MeshLine,d=new s.MeshLineMaterial({color:new n.Color(1,1,1),opacity:.75,sizeAttenuation:!0,transparent:!0,lineWidth:.05*_,resolution:new n.Vector2(e.getWorld().width,e.getWorld().height),side:n.DoubleSide});l.forEach((e=>{const r=w[e].clone().multiplyScalar(_);let n,s,l;for(l=0;l<=v[e]/_;l++)n=t.p1.clone().add(r.clone().multiplyScalar(l)),o=o.concat(n.toArray()),s=t.p2.clone(),s[e]=n[e],o=o.concat(s.toArray()),l%10==0?(a.push(1.5,1.5),i.push(.72*E.r,.72*E.g,.72*E.b),i.push(.72*E.r,.72*E.g,.72*E.b)):(a.push(1,1),i.push(E.r,E.g,E.b),i.push(E.r,E.g,E.b))}),this),c.setGeometry(new Float32Array(o),!0,a,i),c.geometry.computeBoundingSphere(),c.geometry.computeBoundingBox(),t.obj=new n.Mesh(c.geometry,d),this.gridScene.add(t.obj)}),this)}),this)}var A;const P=b.clone();Object.keys(t.planes).forEach((function(e){t.planes[e].forEach((e=>{P.union(e.obj.geometry.boundingBox.clone())}),this)}),this);const z=P.getSize(new n.Vector3).length(),D=z/2/Math.sin(n.Math.degToRad(e.parameters.cameraFov/2));return this.camera.far=5*(D+z/2),this.camera.near=1e-4*z,this.camera.updateProjectionMatrix(),d=h,Promise.all(h).then((e=>(d=null,e)))}function h(e,t){let r="";const o=new n.Vector3;this.camera.getWorldDirection(o),Object.keys(t.planes).forEach((n=>{const a=t.planes[n][0].normal.dot(o),i=t.planes[n][1].normal.dot(o);t.planes[n][0].obj.visible=a<=i&&e.parameters.gridVisible,t.planes[n][1].obj.visible=a>i&&e.parameters.gridVisible,r+=(a<=i?"-":"+")+n}),this),Object.keys(t.labelsOnPlanes).forEach((n=>{t.labelsOnPlanes[n].labels.forEach((t=>{n===r&&e.parameters.gridVisible?t.show():t.hide()}))}))}function g(e,t,r,o,a,i){const s=[];let l=[],c=!1;if(this.raycaster.setFromCamera(new n.Vector2(t,r),o),this.K3DObjects.traverse((e=>{if(e.interactions){if(e.geometry&&0===e.geometry.attributes.position.count)return;e.interactions.intersect?l=l.concat(e.interactions.intersect(this.raycaster)):s.push(e)}})),s.length>0&&(l=l.concat(this.raycaster.intersectObjects(s))),l.length>0){let t=l[0];e.getWorld().targetDOMNode.style.cursor="pointer",!a&&t.object.interactions&&t.object.interactions.onHover&&(c|=t.object.interactions.onHover(t,i)),a&&t.object.interactions&&t.object.interactions.onClick&&(c|=t.object.interactions.onClick(t,i))}else e.getWorld().targetDOMNode.style.cursor="auto";return c}e.exports={Init(e){const t=new n.AmbientLight(16777215),r={planes:{},labelsOnPlanes:{}},o=this;this.lights=[],this.raycaster=new n.Raycaster,this.raycaster.firstHitOnly=!0,this.keyLight=new n.DirectionalLight(16777215),this.headLight=new n.DirectionalLight(16777215),this.fillLight=new n.DirectionalLight(16777215),this.backLight=new n.DirectionalLight(16777215),this.keyLight.position.set(.25,1,1),this.headLight.position.set(0,0,1),this.fillLight.position.set(-.25,-1,1),this.backLight.position.set(-2.5,.4,-1),this.scene=new n.Scene,this.gridScene=new n.Scene,this.axesHelper.scene=new n.Scene,this.K3DObjects=new n.Group,[this.keyLight,this.headLight,this.fillLight,this.backLight].forEach((e=>{o.camera.add(e),o.camera.add(e.target)})),this.scene.add(t),this.scene.add(this.camera),this.scene.add(this.K3DObjects),this.cleanup=u.bind(this,r,this.gridScene),e.rebuildSceneData=m.bind(this,e,r,this.axesHelper),e.getSceneBoundingBox=p.bind(this,e),e.refreshGrid=h.bind(this,e,r),e.rebuildSceneData().then((()=>{e.refreshGrid(),e.render()})),this.recalculateLights=function(e){t.intensity=e<=1?1-.8*e:.2,o.keyLight.intensity=.4*e,o.headLight.intensity=.15*e,o.fillLight.intensity=.15*e,o.backLight.intensity=.1*e,o.backLight.visible=e>0,o.headLight.visible=e>0,o.fillLight.visible=e>0,o.backLight.visible=e>0},e.on(e.events.MOUSE_MOVE,(t=>{e.parameters.viewMode!==l.view&&g.call(o,e,t.x,t.y,o.camera,!1,e.parameters.viewMode)&&!e.autoRendering&&e.render()})),e.on(e.events.MOUSE_CLICK,(t=>{e.parameters.viewMode!==l.view&&g.call(o,e,t.x,t.y,o.camera,!0,e.parameters.viewMode)&&!e.autoRendering&&e.render()})),e.on(e.events.RESIZED,(function(){Object.keys(r.planes).forEach((function(t){r.planes[t].forEach((t=>{const r=t.obj.material.uniforms.resolution;r.value.x=e.getWorld().width,r.value.y=e.getWorld().height}),this)}),this)}))}}},3768:(e,t,r)=>{const{getSpaceDimensionsFromTargetElement:n}=r(9724);e.exports=function(){const e=n(this);this.width=e[0],this.height=e[1],this.axesHelper={width:100,height:100}}},4534:e=>{function t(e){return{position:e.point.toArray(),distance:e.distance,index:e.index,K3DIdentifier:e.object.K3DIdentifier}}e.exports=function(e,r){return{onHover:e=>(r.dispatch(r.events.OBJECT_HOVERED,t(e)),!1),onClick:e=>(r.dispatch(r.events.OBJECT_CLICKED,t(e)),!1)}}},9782:(e,t,r)=>{const n=r(2736),o=r(108);e.exports={prepareGeometry(e){const t=e.clone(),r=[];for(let e=0,n=t.attributes.position.count;e<n;e++)r.push(e,e,e);return t.setIndex(r),t},Intersect:e=>function(t){let r=[];const a=new o.Matrix4;a.copy(e.matrixWorld).invert(),t.ray.applyMatrix4(a);const{ray:i}=t;let s=1/0,l=e.material.size/2||1,c=l/((e.scale.x+e.scale.y+e.scale.z)/3),d=c*c,p=null;return e.geometry.boundsTree.shapecast({boundsTraverseOrder:function(e){return e.distanceToPoint(i.origin)},intersectsBounds:function(e,t,r){return r>s?n.NOT_INTERSECTED:(e.expandByScalar(c),i.intersectsBox(e)?n.INTERSECTED:n.NOT_INTERSECTED)},intersectsTriangle:function(t,r){const n=i.distanceSqToPoint(t.a);if(e.geometry.attributes.sizes||e.isInstancedMesh){if(e.geometry.attributes.sizes&&(l=e.geometry.attributes.sizes.array[r]/2),e.isInstancedMesh){let t=(new o.Matrix4).fromArray(e.instanceMatrix.array,16*r);l=t.getMaxScaleOnAxis()/2}c=l/((e.scale.x+e.scale.y+e.scale.z)/3),d=c*c}if(n<d){const n=i.origin.distanceTo(t.a);n<s&&(s=n,p={object:e,point:t.a,distance:n,index:r})}}}),s!==1/0&&r.push(p),r}}},5498:e=>{function t(e){return{position:e.point.toArray(),normal:e.face.normal.toArray(),distance:e.distance,face_index:e.faceIndex,face:[e.face.a,e.face.b,e.face.c],uv:e.uv,K3DIdentifier:e.object.K3DIdentifier}}e.exports=function(e,r){return{onHover:e=>(r.dispatch(r.events.OBJECT_HOVERED,t(e)),!1),onClick:e=>(r.dispatch(r.events.OBJECT_CLICKED,t(e)),!1)}}},9034:(e,t,r)=>{const n=r(108),{viewModes:o}=r(7861);e.exports=function(e,t,r,a){function i(e){const t=e.voxel.getVoxelChunkObject(e.voxel.generate());let r;for(r=0;r<e.children.length;r++)e.children[r].geometry=t.children[r].geometry}function s(r,o){const a=(new n.Matrix4).copy(t.matrixWorld).invert(),i=(new n.Matrix3).getNormalMatrix(a),s=r.point.clone().applyMatrix4(a),l=r.face.normal.clone().applyMatrix3(i).normalize(),c=o?.5:-.5;s.add(l.multiplyScalar(c/Math.max(e.voxelSize.width,e.voxelSize.height,e.voxelSize.length)));const d=Math.floor(s.x*e.voxelSize.width)+t.voxel.chunk.offset[0],p=Math.floor(s.y*e.voxelSize.height)+t.voxel.chunk.offset[1],u=Math.floor(s.z*e.voxelSize.length)+t.voxel.chunk.offset[2];return!(d<0||p<0||u<0||d>=e.voxelSize.width||p>=e.voxelSize.height||u>=e.voxelSize.length)&&{x:d,y:p,z:u}}function l(t){return e.children.find((e=>!!(e.voxel&&t.x>=e.voxel.chunk.offset[0]&&t.x<=e.voxel.chunk.offset[0]+e.voxel.chunk.size[0]&&t.y>=e.voxel.chunk.offset[1]&&t.y<=e.voxel.chunk.offset[1]+e.voxel.chunk.size[1]&&t.z>=e.voxel.chunk.offset[2]&&t.z<=e.voxel.chunk.offset[2]+e.voxel.chunk.size[2])&&e))}function c(e,t){const r=l({x:e.x+t.x,y:e.y+t.y,z:e.z+t.z});r&&i(r)}return{onHover(t,n){switch(n){case o.add:return function(t){const n=s(t,!0);return!!n&&(r.visible=!0,r.position.set(n.x/e.voxelSize.width,n.y/e.voxelSize.height,n.z/e.voxelSize.length),!0)}(t);case o.change:case o.callback:return function(t){const n=s(t,!1);return!!n&&(r.visible=!0,r.position.set(n.x/e.voxelSize.width,n.y/e.voxelSize.height,n.z/e.voxelSize.length),!0)}(t);default:return!1}},onClick(n,d){switch(d){case o.add:return function(n){const o=s(n,!0);if(!o)return!1;const c=o.x+o.y*e.voxelSize.width+o.z*e.voxelSize.width*e.voxelSize.height;t.voxel.chunk.voxels instanceof Uint8Array?t.voxel.chunk.voxels[c]=a.parameters.voxelPaintColor:t.voxel.chunk.voxels.set(o.x,o.y,o.z,a.parameters.voxelPaintColor,!0),i(t);const d=l(o);return d&&t.uuid!==d.uuid&&i(d),r.visible=!1,!0}(n);case o.change:return function(n){const o=s(n,!1);if(!o)return!1;const l=o.x+o.y*e.voxelSize.width+o.z*e.voxelSize.width*e.voxelSize.height;return t.voxel.chunk.voxels instanceof Uint8Array?t.voxel.chunk.voxels[l]=a.parameters.voxelPaintColor:t.voxel.chunk.voxels.set(o.x,o.y,o.z,a.parameters.voxelPaintColor,!0),i(t),o.x===t.voxel.chunk.offset.x&&c(o,{x:-1,y:0,z:0}),o.x===t.voxel.chunk.offset.x+t.voxel.chunk.size-1&&c(o,{x:1,y:0,z:0}),o.y===t.voxel.chunk.offset.y&&c(o,{x:0,y:-1,z:0}),o.y===t.voxel.chunk.offset.y+t.voxel.chunk.size-1&&c(o,{x:0,y:1,z:0}),o.z===t.voxel.chunk.offset.z&&c(o,{x:1,y:0,z:-1}),o.z===t.voxel.chunk.offset.z+t.voxel.chunk.size-1&&c(o,{x:0,y:0,z:1}),r.visible=!1,!0}(n);case o.callback:return function(t){const r=s(t,!1);return r&&a.dispatch(a.events.VOXELS_CALLBACK,{coord:r,object:e}),!1}(n);default:return!1}}}}},9474:(e,t,r)=>{const n=r(108);let o=r(8633);const{areAllChangesResolve:a}=r(9724);function i(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}o=o.default||o,e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0;const r=new n.Matrix4,a=new n.BufferGeometry,s=new n.MeshBasicMaterial({color:e.color}),l=e.text||"\\KaTeX",{color:c}=e,d=e.max_length||1;let{position:p}=e;const u=e.size||1,m=new n.LineSegments(a,s),{overlayDOMNode:h}=t.getWorld(),g=t.getWorld();let f,v=[];for(p.data?m.positions=p.data:m.positions=p,f=0;f<m.positions.length/3;f++){const r=document.createElement("div");e.is_html?(r.innerHTML=Array.isArray(l)?l[f]:l,r.style.cssText="pointer-events: all"):r.innerHTML=o.renderToString(Array.isArray(l)?l[f]:l,{displayMode:!0}),r.style.position="absolute",r.style.color=i(c),r.style.fontSize=`${u}em`,e.label_box&&(r.style.padding="5px",r.style.background=t.getWorld().targetDOMNode.style.backgroundColor,r.style.border=`1px solid ${i(c)}`,r.style.borderRadius="10px"),h.appendChild(r),v.push(r)}e.model_matrix&&(r.set.apply(r,e.model_matrix.data),m.applyMatrix4(r)),m.updateMatrixWorld(),m.frustumCulled=!1;let y=new Float32Array(2*m.positions.length);for(f=0;f<m.positions.length;f+=3)y[2*f]=y[2*f+3]=m.positions[f],y[2*f+1]=y[2*f+4]=m.positions[f+1],y[2*f+2]=y[2*f+5]=m.positions[f+2];function _(){v.forEach((function(r,o){let a,i,s,l;const c=.5*g.width,p=.5*g.height,u=function(e,t,r){const o=new n.Vector3;return o.fromArray(e.positions,6*t),o.applyMatrix4(e.matrixWorld),r.camera.frustum&&!r.camera.frustum.containsPoint(o)?{x:-1e4,y:-1e4,z:-1e4,out:!0}:(o.project(r.camera),o.x=.5*(o.x+1)*r.width,o.y=.5*(1-o.y)*r.height,{x:o.x,y:o.y,z:o.z})}(m,o,g);if(u.out)r.style.display="none";else{if(r.style.display="block","dynamic"===e.mode){let e,n,o=Math.atan2(u.y-p,u.x-c);const s=150,m=360;let h=0;do{e=Math.sqrt((u.x-c)*(u.x-c)+(u.y-p)*(u.y-p));let r=.98;a=u.x+Math.cos(o)*Math.min(c*r-e,Math.min(c,p)*d),i=u.y+Math.sin(o)*Math.min(p*r-e,Math.min(c,p)*d),n=t.labels.every((e=>Math.sqrt((a-e.coord.x)*(a-e.coord.x)+(i-e.coord.y)*(i-e.coord.y))>s)),n||(o+=Math.PI/180*.25),h++}while(!n&&h<m);u.x=a,u.y=i,o>=-Math.PI/4&&o<Math.PI/4&&(l="lc",u.x-=r.offsetWidth),o>=Math.PI/4&&o<.75*Math.PI&&(l="ct",u.x-=r.offsetWidth/2,u.y-=r.offsetHeight),(o>=.75*Math.PI||o<.75*-Math.PI)&&(l="rc",u.x+=r.offsetWidth),o>=.75*-Math.PI&&o<-Math.PI/4&&(l="cb",u.x-=r.offsetWidth/2,u.y+=r.offsetHeight)}switch("local"===e.mode&&(l="cb",u.y-=.25*d*g.height),"side"===e.mode&&(l="rc",i=t.labels.reduce(((e,t)=>"side"===t.mode?e+t.domElement.offsetHeight+10:e),0),u.x=r.offsetWidth+10,u.y=10+i+r.offsetHeight/2),l[0]){case"l":a=`${Math.round(u.x)}px`;break;case"c":a=`calc(${Math.round(u.x)}px - 50%)`;break;case"r":a=`calc(${Math.round(u.x)}px - 100%)`}switch(l[1]){case"t":i=`${Math.round(u.y)}px`;break;case"c":i=`calc(${Math.round(u.y)}px - 50%)`;break;case"b":i=`calc(${Math.round(u.y)}px - 100%)`}s=new n.Vector3(2*(u.x/g.width-.5),2*-(u.y/g.height-.5),u.z),s.unproject(g.camera),m.positions.set([s.x,s.y,s.z],6*o+3),r.style.transform=`translate(${a},${i})`,r.style.zIndex=e.on_top?"1500":"15",t.labels.push({mode:e.mode,coord:u,domElement:r})}})),m.geometry.attributes.position.array.set(m.positions),m.geometry.attributes.position.needsUpdate=!0}m.positions=y,m.geometry.setAttribute("position",new n.BufferAttribute(y,3)),m.geometry.computeBoundingSphere(),m.geometry.computeBoundingBox();const x=t.on(t.events.BEFORE_RENDER,_);return m.domElements=v,m.onRemove=function(){v.forEach((function(e){t.labels=t.labels.filter((function(t){return t.domElement!==e})),h.removeChild(e),e=null})),v=[],t.off(t.events.BEFORE_RENDER,x)},_(),Promise.resolve(m)},update(e,t,r){const n={};if(void 0===t.text||t.text.timeSeries||(r.domElements.forEach((function(r,n){let a=Array.isArray(t.text)?t.text[n]:t.text;e.is_html?(r.innerHTML=a,r.style.pointerEvents="all"):(r.innerHTML=o.renderToString(a,{displayMode:!0}),r.style.pointerEvents="none")})),n.text=null),void 0!==t.position&&!t.position.timeSeries){let e=t.position.data||t.position;for(let t=0;t<e.length;t+=3)r.positions[2*t]=e[t],r.positions[2*t+1]=e[t+1],r.positions[2*t+2]=e[t+2];n.position=null}return!!a(t,n)&&Promise.resolve({json:e,obj:r})}}},8308:(e,t,r)=>{const n=r(5748),o=r(4660),a=r(180);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:65280,e.shader=void 0!==e.shader?e.shader:"simple","mesh"===e.shader?o.create(e,t):"simple"===e.shader?n.create(e,t):a.create(e,t)),update:(e,t,r,i)=>"mesh"===e.shader?o.update(e,t,r,i):"simple"===e.shader?n.update(e,t,r,i):a.update(e,t,r,i)}},4660:(e,t,r)=>{const n=r(108),o=r(9724),{areAllChangesResolve:a}=o,{commonUpdate:i}=o,{colorsToFloat32Array:s}=r(5321),l=r(7241),{handleColorMap:c}=o;e.exports={create(e){e.radial_segments=void 0!==e.radial_segments?e.radial_segments:8,e.width=void 0!==e.width?e.width:.1,e.opacity=void 0!==e.opacity?e.opacity:1;const t=new n.MeshPhongMaterial({emissive:0,shininess:50,specular:1118481,side:n.DoubleSide,wireframe:!1,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity}),r=e.radial_segments,{width:o}=e;let a=e.colors&&e.colors.data||null;const i=new n.Color(e.color),d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,m=new n.Matrix4,h=e.vertices.data;a&&a.length===h.length/3&&(a=s(a));const g=l(h,u,o,r,i,a,d);u&&d&&p&&u.length>0&&d.length>0&&p.length>0?c(g,p,d,null,t):t.setValues({vertexColors:n.VertexColors}),g.computeBoundingSphere(),g.computeBoundingBox(),m.set.apply(m,e.model_matrix.data);const f=new n.Mesh(g,t);return f.applyMatrix4(m),f.updateMatrixWorld(),Promise.resolve(f)},update(e,t,r,n){const o={};return i(e,t,o,r,n),!!a(t,o)&&Promise.resolve({json:e,obj:r})}}},5748:(e,t,r)=>{const n=r(108),{colorsToFloat32Array:o}=r(5321),a=r(9724),{commonUpdate:i}=a,{areAllChangesResolve:s}=a,{getColorsArray:l}=a,{handleColorMap:c}=a;e.exports={create(e){const t=new n.BufferGeometry,r=new n.MeshBasicMaterial({opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity}),a=e.colors&&e.colors.data||null,i=new n.Color(e.color);let s;const d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,m=new n.Line(t,r),h=new n.Matrix4,g=e.vertices.data;return u&&d&&p&&u.length>0&&d.length>0&&p.length>0?c(t,p,d,u,r):(s=a&&a.length===g.length/3?o(a):l(i,g.length/3),r.setValues({vertexColors:n.VertexColors}),t.setAttribute("color",new n.BufferAttribute(s,3))),t.setAttribute("position",new n.BufferAttribute(g,3)),t.computeBoundingSphere(),t.computeBoundingBox(),h.set.apply(h,e.model_matrix.data),m.applyMatrix4(h),m.updateMatrixWorld(),Promise.resolve(m)},update(e,t,r,n){const o={};if(void 0!==r.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries&&t.attribute.data.length===r.geometry.attributes.uv.array.length)){const n=r.geometry.attributes.uv.array;for(let r=0;r<n.length;r++)n[r]=(t.attribute.data[r]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.geometry.attributes.uv.needsUpdate=!0,o.attribute=null}return void 0===t.vertices||t.vertices.timeSeries||t.vertices.data.length!==r.geometry.attributes.position.array.length||(r.geometry.attributes.position.array.set(t.vertices.data),r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),o.vertices=null),i(e,t,o,r,n),!!s(t,o)&&Promise.resolve({json:e,obj:r})}}},180:(e,t,r)=>{const n=r(108),{colorsToFloat32Array:o}=r(5321),a=r(2460)(n),i=r(9724),{commonUpdate:s}=i,{areAllChangesResolve:l}=i,c=r(5103),{getColorsArray:d}=i;e.exports={create:function(e,t){e.width=void 0!==e.width?e.width:.1;const r=new a.MeshLineMaterial({color:new n.Color(1,1,1),opacity:e.opacity,sizeAttenuation:!0,transparent:!0,lineWidth:e.width,resolution:new n.Vector2(t.getWorld().width,t.getWorld().height),side:n.DoubleSide}),i=e.colors&&e.colors.data||null,s=new n.Color(e.color);let l=null,p=null;const u=e.color_range,m=e.color_map&&e.color_map.data||null,h=e.attribute&&e.attribute.data||null,g=new n.Matrix4,f=e.vertices.data;if(h&&u&&m&&h.length>0&&u.length>0&&m.length>0){const e=c.createCanvasGradient(m,1024),t=new n.CanvasTexture(e,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);t.needsUpdate=!0,r.uniforms.useMap.value=1,r.uniforms.map.value=t,p=new Float32Array(h.length);for(let e=0;e<h.length;e++)p[e]=(h[e]-u[0])/(u[1]-u[0])}else l=i&&i.length===f.length/3?o(i):d(s,f.length/3);const v=new a.MeshLine;v.setGeometry(new Float32Array(f),!1,null,l,p),v.geometry.computeBoundingSphere(),v.geometry.computeBoundingBox();const y=new n.Mesh(v.geometry,r);y.userData.meshLine=v,y.userData.lastPosition=new Float32Array(f),y.userData.lastUVs=p,y.userData.lastColors=l,g.set.apply(g,e.model_matrix.data),y.applyMatrix4(g),y.updateMatrixWorld();const _=t.on(t.events.RESIZED,(()=>{y.material.uniforms.resolution.value.x=t.getWorld().width,y.material.uniforms.resolution.value.y=t.getWorld().height}));return y.onRemove=function(){t.off(t.events.RESIZED,_),y.material.uniforms.map.value&&(y.material.uniforms.map.value.dispose(),y.material.uniforms.map.value=void 0)},Promise.resolve(y)},update:function(e,t,r,n){let o=r.userData.lastUVs,a=r.userData.lastPosition;const i=r.userData.lastColors,c={};if(void 0!==r.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],c.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries)){if(t.attribute.data.length!==r.geometry.attributes.uv.array.length)return!1;o=new Float32Array(t.attribute.data.length);for(let r=0;r<o.length;r++)o[r]=(t.attribute.data[r]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.userData.lastUVs=o}if(void 0!==t.vertices&&!t.vertices.timeSeries){if(t.vertices.data.length!==a.length)return!1;a=t.vertices.data,r.userData.lastPosition=a}return void 0===t.attribute&&void 0===t.vertices||(r.userData.meshLine.setGeometry(a,!1,null,i,o),r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),c.attribute=null,c.vertices=null),s(e,t,c,r,n),!!l(t,c)&&Promise.resolve({json:e,obj:r})}}},4757:(e,t,r)=>{const n=r(1106),o=r(1948),a=r(4370);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:65280,e.shader=void 0!==e.shader?e.shader:"simple","mesh"===e.shader?o.create(e,t):"simple"===e.shader?n.create(e,t):a.create(e,t)),update:(e,t,r,i)=>"mesh"===e.shader?o.update(e,t,r,i):"simple"===e.shader?n.update(e,t,r,i):a.update(e,t,r,i)}},1948:(e,t,r)=>{const n=r(108),o=r(9961),a=r(9724),{areAllChangesResolve:i}=a,{commonUpdate:s}=a,{colorsToFloat32Array:l}=r(5321),c=r(7241),{handleColorMap:d}=a;e.exports={create(e){e.radial_segments=void 0!==e.radial_segments?e.radial_segments:8,e.width=void 0!==e.width?e.width:.1,e.opacity=void 0!==e.opacity?e.opacity:1;const t=new n.MeshPhongMaterial({emissive:0,shininess:50,specular:1118481,side:n.DoubleSide,wireframe:!1,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity}),r=e.radial_segments,{width:a}=e;let i=e.colors&&e.colors.data||[];const s=new n.Color(e.color),p=e.color_range,u=e.color_map&&e.color_map.data||null,m=e.attribute&&e.attribute.data||[],h=new n.Matrix4,g=e.vertices.data,f=e.indices.data,v=new Set,y="segment"===e.indices_type?2:3;i&&i.length===g.length/3&&(i=l(i));const _=[],x=g.length/3;let b;for(let e=0;e<f.length;e+=y){b=3===y?[[f[e],f[e+1]],[f[e+1],f[e+2]],[f[e+2],f[e]]]:[[f[e],f[e+1]]];for(let e=0;e<b.length;e++){const t=b[e][0]>b[e][1]?b[e][0]+b[e][1]*x:b[e][1]+b[e][0]*x;if(!v.has(t)){v.add(t);const n=3*b[e][0],o=3*b[e][1];_.push(c([g[n],g[n+1],g[n+2],g[o],g[o+1],g[o+2]],m.length>0?[m[b[e][0]],m[b[e][1]]]:null,a,r,s,i.length>0?[i[n],i[n+1],i[n+2],i[o],i[o+1],i[o+2]]:null,p))}}}const w=o.mergeBufferGeometries(_);m&&p&&u&&m.length>0&&p.length>0&&u.length>0?d(w,u,p,null,t):t.setValues({vertexColors:n.VertexColors}),w.computeBoundingSphere(),w.computeBoundingBox(),h.set.apply(h,e.model_matrix.data);const M=new n.Mesh(w,t);return M.applyMatrix4(h),M.updateMatrixWorld(),Promise.resolve(M)},update(e,t,r,n){const o={};return s(e,t,o,r,n),!!i(t,o)&&Promise.resolve({json:e,obj:r})}}},1106:(e,t,r)=>{const n=r(108),{colorsToFloat32Array:o}=r(5321),a=r(9724),{commonUpdate:i}=a,{areAllChangesResolve:s}=a,{getColorsArray:l}=a,{handleColorMap:c}=a;e.exports={create(e){const t=new n.BufferGeometry,r=new n.MeshBasicMaterial({opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity});let a=e.colors&&e.colors.data||null;const i=new n.Color(e.color),s=e.color_range,d=e.color_map&&e.color_map.data||null,p=e.attribute&&e.attribute.data||null,u=new n.LineSegments(t,r),m=new n.Matrix4,h=e.vertices.data,g=e.indices.data,f=new Set;let v=[],y=[],_=[];const x="segment"===e.indices_type?2:3;let b;const w=h.length/3;a=a&&a.length===h.length/3?o(a):l(i,h.length/3);for(let e=0;e<g.length;e+=x){b=3===x?[[g[e],g[e+1]],[g[e+1],g[e+2]],[g[e+2],g[e]]]:[[g[e],g[e+1]]];for(let e=0;e<b.length;e++){const t=b[e][0]>b[e][1]?b[e][0]+b[e][1]*w:b[e][1]+b[e][0]*w;if(!f.has(t)){f.add(t);const r=3*b[e][0],n=3*b[e][1];v.push(h[r],h[r+1],h[r+2],h[n],h[n+1],h[n+2]),a&&a.length>0&&_.push(a[r],a[r+1],a[r+2],a[n],a[n+1],a[n+2]),p&&p.length>0&&y.push(p[b[e][0]],p[b[e][1]])}}}return v=new Float32Array(v),y=new Float32Array(y),_=new Float32Array(_),s&&d&&y.length>0&&s.length>0&&d.length>0?c(t,d,s,y,r):(r.setValues({vertexColors:n.VertexColors}),t.setAttribute("color",new n.BufferAttribute(_,3))),t.setAttribute("position",new n.BufferAttribute(v,3)),t.computeBoundingSphere(),t.computeBoundingBox(),m.set.apply(m,e.model_matrix.data),u.applyMatrix4(m),u.updateMatrixWorld(),Promise.resolve(u)},update(e,t,r,n){const o={};if(void 0!==r.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries&&t.attribute.data.length===r.geometry.attributes.uv.array.length)){const n=r.geometry.attributes.uv.array;for(let r=0;r<n.length;r++)n[r]=(t.attribute.data[r]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.geometry.attributes.uv.needsUpdate=!0,o.attribute=null}return void 0===t.vertices||t.vertices.timeSeries||t.vertices.data.length!==r.geometry.attributes.position.array.length||(r.geometry.attributes.position.array.set(t.vertices.data),r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),o.vertices=null),i(e,t,o,r,n),!!s(t,o)&&Promise.resolve({json:e,obj:r})}}},4370:(e,t,r)=>{const n=r(108),{colorsToFloat32Array:o}=r(5321),a=r(2460)(n),i=r(9724),{commonUpdate:s}=i,{areAllChangesResolve:l}=i,c=r(5103),{getColorsArray:d}=i;e.exports={create:function(e,t){e.width=void 0!==e.width?e.width:.1;const r=new a.MeshLineMaterial({color:new n.Color(1,1,1),opacity:e.opacity,sizeAttenuation:!0,transparent:!0,lineWidth:e.width,resolution:new n.Vector2(t.getWorld().width,t.getWorld().height),side:n.DoubleSide});let i=e.colors&&e.colors.data||null;const s=new n.Color(e.color);let l=null;const p=e.color_range,u=e.color_map&&e.color_map.data||null,m=e.attribute&&e.attribute.data||null,h=new n.Matrix4,g=e.vertices.data,f=e.indices.data,v=new Set,y="segment"===e.indices_type?2:3;let _,x=[],b=[],w=[];const M=g.length/3;i=i&&i.length===g.length/3?o(i):d(s,g.length/3);for(let e=0;e<f.length;e+=y){_=3===y?[[f[e],f[e+1]],[f[e+1],f[e+2]],[f[e+2],f[e]]]:[[f[e],f[e+1]]];for(let e=0;e<_.length;e++){const t=_[e][0]>_[e][1]?_[e][0]+_[e][1]*M:_[e][1]+_[e][0]*M;if(!v.has(t)){v.add(t);const r=3*_[e][0],n=3*_[e][1];x.push(g[r],g[r+1],g[r+2],g[n],g[n+1],g[n+2]),i&&i.length>0&&w.push(i[r],i[r+1],i[r+2],i[n],i[n+1],i[n+2]),m&&m.length>0&&b.push(m[_[e][0]],m[_[e][1]])}}}if(x=new Float32Array(x),b=new Float32Array(b),p&&u&&b.length>0&&p.length>0&&u.length>0){const e=c.createCanvasGradient(u,1024),t=new n.CanvasTexture(e,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);t.needsUpdate=!0,r.uniforms.useMap.value=1,r.uniforms.map.value=t,l=new Float32Array(b.length);for(let e=0;e<b.length;e++)l[e]=(b[e]-p[0])/(p[1]-p[0]);w=null}const C=new a.MeshLine;C.setGeometry(x,!0,null,w,l),C.geometry.computeBoundingSphere(),C.geometry.computeBoundingBox();const E=new n.Mesh(C.geometry,r);E.userData.meshLine=C,E.userData.lastPositions=new Float32Array(x),E.userData.lastUVs=l,E.userData.lastColors=i,h.set.apply(h,e.model_matrix.data),E.applyMatrix4(h),E.updateMatrixWorld();const S=t.on(t.events.RESIZED,(()=>{E.material.uniforms.resolution.value.x=t.getWorld().width,E.material.uniforms.resolution.value.y=t.getWorld().height}));return E.onRemove=function(){t.off(t.events.RESIZED,S),E.material.uniforms.map.value&&(E.material.uniforms.map.value.dispose(),E.material.uniforms.map.value=void 0)},Promise.resolve(E)},update:function(e,t,r,n){let o=r.userData.lastUVs,a=r.userData.lastPositions;const i=r.userData.lastColors,c={};if(void 0!==r.geometry.attributes.uv&&(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],c.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries)){if(t.attribute.data.length!==r.geometry.attributes.uv.array.length)return!1;o=new Float32Array(t.attribute.data.length);for(let r=0;r<o.length;r++)o[r]=(t.attribute.data[r]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.userData.lastUVs=o}if(void 0!==t.vertices&&!t.vertices.timeSeries){if(t.vertices.data.length!==a.length)return!1;a=t.vertices.data,r.userData.lastPositions=a}return void 0===t.attribute&&void 0===t.vertices||(r.userData.meshLine.setGeometry(a,!0,null,i,o),r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),c.attribute=null,c.vertices=null),s(e,t,c,r,n),!!l(t,c)&&Promise.resolve({json:e,obj:r})}}},953:(e,t,r)=>{const n=r(108),o=r(5843),a=r(5103),{typedArrayToThree:i}=r(9724),{areAllChangesResolve:s}=r(9724),{commonUpdate:l}=r(9724),{ensure256size:c}=r(9724);e.exports={create(e){e.samples=e.samples||512,e.gradient_step=e.gradient_step||.005,e.interpolation=void 0===e.interpolation||e.interpolation;const t=void 0!==window.randomMul?window.randomMul:255,s=new n.BoxBufferGeometry(1,1,1),l=new n.Matrix4,d=new n.Vector3,p=new n.Quaternion,u=new n.Vector3,m=e.color_map&&e.color_map.data||null;let h=null,g=!1,f=e.opacity_function&&e.opacity_function.data||null;const v=e.color_range,{samples:y}=e;let _;null===f&&(f=[m[0],0,m[m.length-4],1]),l.set.apply(l,e.model_matrix.data),l.decompose(d,p,u);const x=new n.Data3DTexture(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);x.format=n.RedFormat,x.type=i(e.volume.data.constructor),x.generateMipmaps=!1,e.interpolation?(x.minFilter=n.LinearFilter,x.magFilter=n.LinearFilter):(x.minFilter=n.NearestFilter,x.magFilter=n.NearestFilter),x.wrapS=n.ClampToEdgeWrapping,x.wrapT=n.ClampToEdgeWrapping,x.wrapR=n.ClampToEdgeWrapping,x.needsUpdate=!0,_=new n.DataTexture(new Uint8Array(o.range(4096).map((()=>t*Math.random()))),64,64,n.RedFormat,n.UnsignedByteType),_.minFilter=n.LinearFilter,_.magFilter=n.LinearFilter,_.wrapS=n.MirroredRepeatWrapping,_.wrapT=n.MirroredRepeatWrapping,_.generateMipmaps=!1,_.needsUpdate=!0;const b=a.createCanvasGradient(m,1024,f),w=new n.CanvasTexture(b,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);w.needsUpdate=!0,e.mask.data.length>0&&e.mask_opacities.data.length>0&&(h=new n.Data3DTexture(e.mask.data,e.mask.shape[2],e.mask.shape[1],e.mask.shape[0]),h.format=n.RedFormat,h.type=n.UnsignedByteType,h.generateMipmaps=!1,h.minFilter=n.NearestFilter,h.magFilter=n.NearestFilter,h.wrapS=n.ClampToEdgeWrapping,h.wrapT=n.ClampToEdgeWrapping,h.needsUpdate=!0,g=!0);const M={maskOpacities:{value:c(e.mask_opacities.data)},volumeMapSize:{value:new n.Vector3(e.volume.shape[2],e.volume.shape[1],e.volume.shape[0])},low:{value:v[0]},high:{value:v[1]},gradient_step:{value:e.gradient_step},samples:{value:y},translation:{value:d},rotation:{value:p},scale:{value:u},volumeTexture:{type:"t",value:x},mask:{type:"t",value:h},colormap:{type:"t",value:w},jitterTexture:{type:"t",value:_}},C=new n.ShaderMaterial({uniforms:o.merge(M,n.UniformsLib.lights),defines:{USE_SPECULAR:1,USE_MASK:g?1:0},vertexShader:r(9192),fragmentShader:r(6231),side:n.BackSide,depthTest:!1,depthWrite:!1,lights:!0,clipping:!0,transparent:!0});s.computeBoundingSphere(),s.computeBoundingBox();const E=new n.Mesh(s,C);return E.applyMatrix4(l),E.updateMatrixWorld(),E.onRemove=function(){E.material.uniforms.volumeTexture.value=void 0,E.material.uniforms.colormap.value.dispose(),E.material.uniforms.colormap.value=void 0,_.dispose(),_=void 0},Promise.resolve(E)},update(e,t,r,n){const o={};if(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),void 0===t.volume||t.volume.timeSeries||r.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&(r.material.uniforms.volumeTexture.value.image.data=t.volume.data,r.material.uniforms.volumeTexture.value.needsUpdate=!0,o.volume=null),void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,o.color_map=null,o.opacity_function=null}return void 0===t.mask||t.mask.timeSeries||null!==r.material.uniforms.mask.value&&r.material.uniforms.mask.value.image.data.constructor===t.mask.data.constructor&&r.material.uniforms.mask.value.image.width===t.mask.shape[2]&&r.material.uniforms.mask.value.image.height===t.mask.shape[1]&&r.material.uniforms.mask.value.image.depth===t.mask.shape[0]&&(r.material.uniforms.mask.value.image.data=t.mask.data,r.material.uniforms.mask.value.needsUpdate=!0,o.mask=null),void 0===t.mask_opacities||t.mask_opacities.timeSeries||null!==r.material.uniforms.maskOpacities.value&&(r.material.uniforms.maskOpacities.value=c(t.mask_opacities.data),r.material.uniforms.maskOpacities.value.needsUpdate=!0,o.mask_opacities=null),["samples","gradient_step"].forEach((e=>{t[e]&&!t[e].timeSeries&&(r.material.uniforms[e].value=t[e],o[e]=null)})),l(e,t,o,r,n),!!s(t,o)&&Promise.resolve({json:e,obj:r})}}},9603:(e,t,r)=>{const n=r(108),o=r(9961),a=r(2539),i=r(2314),s=r(7290),{areAllChangesResolve:l,getSide:c,typedArrayToThree:d}=r(9724),{commonUpdate:p}=r(9724),u=r(5103),m=r(5843);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading,e.opacity=void 0!==e.opacity?e.opacity:1,new Promise((l=>{const p=e.scalar_field.data,h=e.scalar_field.shape[2],g=e.scalar_field.shape[1],f=e.scalar_field.shape[0],v=e.spacings_x,y=e.spacings_y,_=e.spacings_z;let x=!1;const{level:b}=e,w=new n.Matrix4,M=e.wireframe?n.MeshBasicMaterial:n.MeshPhongMaterial,C=e.color_range,E=e.color_map&&e.color_map.data||null;let S,A,P,z,D,T=null,k=new M({color:e.color,emissive:0,shininess:50,specular:1118481,side:e.wireframe?n.FrontSide:n.DoubleSide,flatShading:e.flat_shading,wireframe:e.wireframe,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity}),O=new n.BufferGeometry,j=[],I=0;const L=i;if(function(e){return e.attribute&&e.attribute.data&&e.attribute.data.length>0&&e.color_range&&e.color_range.length>0&&e.color_map&&e.color_map.data&&e.color_map.data.length>0}(e)){e.opacity_function&&e.opacity_function.data&&e.opacity_function.data.length>0&&(T=e.opacity_function.data);const t=u.createCanvasGradient(E,1024,T),o=new n.CanvasTexture(t,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);o.needsUpdate=!0;const a=new n.Data3DTexture(e.attribute.data,e.attribute.shape[2],e.attribute.shape[1],e.attribute.shape[0]);a.format=n.RedFormat,a.type=d(e.attribute.data.constructor),a.generateMipmaps=!1,a.minFilter=n.LinearFilter,a.magFilter=n.LinearFilter,a.wrapT=n.ClampToEdgeWrapping,a.wrapS=n.ClampToEdgeWrapping,a.needsUpdate=!0,k=new n.ShaderMaterial({uniforms:m.merge({opacity:{value:e.opacity},low:{value:C[0]},high:{value:C[1]},volumeTexture:{type:"t",value:a},colormap:{type:"t",value:o},emissive:{type:"v3",value:new n.Vector3(0,0,0)},specular:{type:"v3",value:new n.Vector3(.04,.04,.04)},shininess:{value:50}},n.UniformsLib.lights),defines:{FLAT_SHADED:e.flat_shading},side:c(e),vertexShader:r(368),fragmentShader:r(3154),depthWrite:1===e.opacity&&null===T,transparent:1!==e.opacity||null!==T,wireframe:e.wireframe,flatShading:e.flat_shading,lights:!0,clipping:!0})}v&&y&&_&&(x=v.shape[0]===h-1&&y.shape[0]===g-1&&_.shape[0]===f-1),s(f-1,5,x?function(e){for(P=0,z=0;z<g-1;z++){for(A=0,D=0;D<h-1;D++)L(j,p,b,h,g,f,D,z,e,A,P,I,v.data[D],y.data[z],_.data[e]),A+=v.data[D];P+=y.data[z]}I+=_.data[e]}:function(e){const t=1/(h-1),r=1/(g-1),n=1/(f-1);for(P=0,z=0;z<g-1;z++){for(A=0,D=0;D<h-1;D++)L(j,p,b,h,g,f,D,z,e,A,P,I,t,r,n),A+=t;P+=r}I+=n},(()=>{let r=1,i=1,s=1;j=new Float32Array(j),O.setAttribute("position",new n.BufferAttribute(j,3)),!1===e.flat_shading&&(O=o.mergeVertices(O),O.computeVertexNormals()),x&&(r=v.data.reduce(((e,t)=>e+t),0),i=y.data.reduce(((e,t)=>e+t),0),s=_.data.reduce(((e,t)=>e+t),0)),O.boundingSphere=new n.Sphere(new n.Vector3(.5*r,.5*i,.5*s),new n.Vector3(.5*r,.5*i,.5*s).length()),O.boundingBox=new n.Box3(new n.Vector3(0,0,0),new n.Vector3(r,i,s)),S=new n.Mesh(O,k),S.scale.set(1/r,1/i,1/s),a.init(e,S,t),w.set.apply(w,e.model_matrix.data),S.position.set(-.5,-.5,-.5),S.initialPosition=S.position.clone(),S.updateMatrix(),S.applyMatrix4(w),S.updateMatrixWorld(),l(S)}))}))),update(e,t,r,n){const o={};if(a.update(e,t,o,r),void 0===t.attribute||t.attribute.timeSeries||r.material.uniforms&&r.material.uniforms.volumeTexture.value.image.data.constructor===t.attribute.data.constructor&&r.material.uniforms.volumeTexture.value.image.width===t.attribute.shape[2]&&r.material.uniforms.volumeTexture.value.image.height===t.attribute.shape[1]&&r.material.uniforms.volumeTexture.value.image.depth===t.attribute.shape[0]&&(r.material.uniforms.volumeTexture.value.image.data=t.attribute.data,r.material.uniforms.volumeTexture.value.needsUpdate=!0,o.volume=null),r.material.uniforms&&void 0!==t.color_range&&!t.color_range.timeSeries&&(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),(r.material.uniforms&&void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&(!t.opacity_function||!1!==r.material.transparent)){const n=u.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,o.color_map=null,o.opacity_function=null}return p(e,t,o,r,n),!!l(t,o)&&Promise.resolve({json:e,obj:r})}}},4222:(e,t,r)=>{const n=r(4402),o=r(2611);function a(e){return e.volume&&e.volume.data&&e.volume.data.length>0&&e.volume_bounds&&e.volume_bounds.data&&e.volume_bounds.data.length>0&&e.color_range&&e.color_range.length>0&&e.color_map&&e.color_map.data&&e.color_map.data.length>0}e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,a(e)?o.create(e,t):n.create(e,t)),update:(e,t,r,i)=>a(e)?o.update(e,t,r,i):n.update(e,t,r,i)}},4402:(e,t,r)=>{const n=r(108),o=r(2539),a=r(5103),{handleColorMap:i}=r(9724),{areAllChangesResolve:s}=r(9724),{commonUpdate:l}=r(9724),{getSide:c}=r(9724),d=r(5321);e.exports={create:(e,t)=>new Promise((r=>{e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading,e.opacity=void 0!==e.opacity?e.opacity:1;const a=new n.Matrix4,s=e.wireframe?n.MeshBasicMaterial:n.MeshPhongMaterial,l=new n.Texture,p=e.texture,u=e.texture_file_format,m=e.colors&&e.colors.data||null,h=e.color_range,g=e.color_map&&e.color_map.data||null,f=e.attribute&&e.attribute.data||null,v=e.triangles_attribute&&e.triangles_attribute.data||null,y=e.normals&&e.normals.data||null,_=e.vertices&&e.vertices.data||null,x=e.indices&&e.indices.data||null,b=e.uvs&&e.uvs.data||null;let w,M,C,E=new n.BufferGeometry;const S=null!==y&&y.length>0;a.set.apply(a,e.model_matrix.data),E.setAttribute("position",new n.BufferAttribute(_,3)),E.setIndex(new n.BufferAttribute(x,1)),!1===e.flat_shading&&S&&E.setAttribute("normal",new n.BufferAttribute(y,3));const A=new s({color:e.color,emissive:0,shininess:50,specular:1118481,side:c(e),flatShading:e.flat_shading,wireframe:e.wireframe,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity});function P(){!1!==e.flat_shading||S||E.computeVertexNormals(),E.computeBoundingSphere(),E.computeBoundingBox(),M=new n.Mesh(E,A),o.init(e,M,t),M.applyMatrix4(a),M.updateMatrixWorld(),r(M)}if(null!==m&&m.length>0)A.setValues({color:16777215,vertexColors:n.VertexColors}),E.setAttribute("color",new n.BufferAttribute(d.colorsToFloat32Array(m),3)),P();else if(f&&h&&g&&f.length>0&&h.length>0&&g.length>0)i(E,g,h,f,A),P();else if(v&&h&&g&&v.length>0&&h.length>0&&g.length>0){E=E.toNonIndexed(),C=new Float32Array(3*v.length);for(let e=0;e<C.length;e++)C[e]=v[Math.floor(e/3)];i(E,g,h,C,A),P()}else p&&u&&b?(w=document.createElement("img"),w.src=`data:image/${u};base64,${d.bufferToBase64(p.data.buffer)}`,E.setAttribute("uv",new n.BufferAttribute(new Float32Array(b),2)),w.onload=function(){A.map=l,l.image=w,l.flipY=!1,l.minFilter=n.LinearFilter,l.needsUpdate=!0,A.needsUpdate=!0,P()}):P()})),update(e,t,r,n){const i={};let c,d;if(!r)return!1;if(r.geometry&&void 0!==r.geometry.attributes.uv){if(void 0!==t.color_range&&!t.color_range.timeSeries){if(c=r.geometry.attributes.uv.array,e.attribute.data.length>0)for(d=0;d<c.length;d++)c[d]=(e.attribute.data[d]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);if(e.triangles_attribute.data.length>0)for(d=0;d<c.length;d++)c[d]=(e.triangles_attribute.data[Math.floor(d/3)]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.geometry.attributes.uv.needsUpdate=!0,i.color_range=null}if(r.geometry&&void 0!==t.attribute&&!t.attribute.timeSeries){for(c=r.geometry.attributes.uv.array,d=0;d<c.length;d++)c[d]=(t.attribute.data[d]-e.color_range[0])/(e.color_range[1]-e.color_range[0]);r.geometry.attributes.uv.needsUpdate=!0,i.attribute=null}if(void 0!==t.color_map&&!t.color_map.timeSeries){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024);r.material.map.image=n,r.material.map.needsUpdate=!0,r.material.needsUpdate=!0,i.color_map=null}}return o.update(e,t,i,r),l(e,t,i,r,n),!!s(t,i)&&Promise.resolve({json:e,obj:r})}}},2611:(e,t,r)=>{const n=r(108),o=r(2539),a=r(5103),{typedArrayToThree:i}=r(9724),{areAllChangesResolve:s}=r(9724),{commonUpdate:l}=r(9724),{getSide:c}=r(9724);e.exports={create(e,t){e.color=void 0!==e.color?e.color:255,e.opacity=void 0!==e.opacity?e.opacity:1;const s=new n.Matrix4,l=e.color_range,d=e.color_map&&e.color_map.data||null,p=e.vertices&&e.vertices.data||null,u=e.indices&&e.indices.data||null;let m=null;const h=new n.BufferGeometry;e.opacity_function&&e.opacity_function.data&&e.opacity_function.data.length>0&&(m=e.opacity_function.data);const g=a.createCanvasGradient(d,1024,m),f=new n.CanvasTexture(g,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);f.needsUpdate=!0,h.setAttribute("position",new n.BufferAttribute(p,3)),h.setIndex(new n.BufferAttribute(u,1));const v=new n.Data3DTexture(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);v.format=n.RedFormat,v.type=i(e.volume.data.constructor),v.generateMipmaps=!1,v.minFilter=n.LinearFilter,v.magFilter=n.LinearFilter,v.wrapT=n.ClampToEdgeWrapping,v.wrapS=n.ClampToEdgeWrapping,v.needsUpdate=!0;const y=new n.ShaderMaterial({uniforms:{opacity:{value:e.opacity},low:{value:l[0]},high:{value:l[1]},volumeTexture:{type:"t",value:v},colormap:{type:"t",value:f},b1:{type:"v3",value:new n.Vector3(e.volume_bounds.data[0],e.volume_bounds.data[2],e.volume_bounds.data[4])},b2:{type:"v3",value:new n.Vector3(e.volume_bounds.data[1],e.volume_bounds.data[3],e.volume_bounds.data[5])}},side:c(e),vertexShader:r(6830),fragmentShader:r(2345),depthWrite:1===e.opacity&&null===m,transparent:1!==e.opacity||null!==m,lights:!1,clipping:!0});!1===e.flat_shading&&h.computeVertexNormals(),h.computeBoundingSphere(),h.computeBoundingBox();const _=new n.Mesh(h,y);return o.init(e,_,t),s.set.apply(s,e.model_matrix.data),_.applyMatrix4(s),_.updateMatrixWorld(),Promise.resolve(_)},update(e,t,r,n){const i={};if(o.update(e,t,i,r),void 0===t.volume||t.volume.timeSeries||r.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&r.material.uniforms.volumeTexture.value.image.width===t.volume.shape[2]&&r.material.uniforms.volumeTexture.value.image.height===t.volume.shape[1]&&r.material.uniforms.volumeTexture.value.image.depth===t.volume.shape[0]&&(r.material.uniforms.volumeTexture.value.image.data=t.volume.data,r.material.uniforms.volumeTexture.value.needsUpdate=!0,i.volume=null),void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],i.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&(!t.opacity_function||!1!==r.material.transparent)){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,i.color_map=null,i.opacity_function=null}return l(e,t,i,r,n),!!s(t,i)&&Promise.resolve({json:e,obj:r})}}},2168:(e,t,r)=>{const n=r(8438),o=r(2975);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:65280,e.opacity=void 0!==e.opacity?e.opacity:1,e.point_size=void 0!==e.point_size?e.point_size:1,e.shader=void 0!==e.shader?e.shader:"3dSpecular",e.opacity=Math.max(Math.min(e.opacity,1),0),"mesh"===e.shader?n.create(e,t):o.create(e,t)),update:(e,t,r,a)=>"mesh"===e.shader?n.update(e,t,r,a):o.update(e,t,r,a)}},2975:(e,t,r)=>{const n=r(108),o=r(5321),a=r(5103),i=r(2539),s=r(4534),l=r(9782),c=r(9724),{commonUpdate:d}=c,{areAllChangesResolve:p}=c,{getColorsArray:u}=c,{colorsToFloat32Array:m}=o;e.exports={create(e,t){const o=new n.Matrix4,d=new n.Color(e.color),p=e.positions.data,h=e.colors&&e.colors.data||null,{shader:g}=e;let f=null;const v=e.opacities&&e.opacities.data&&e.opacities.data.length===p.length/3?e.opacities.data:null,y=e.point_sizes&&e.point_sizes.data&&e.point_sizes.data.length===p.length/3?e.point_sizes.data:null,_={dot:r(5074),flat:r(8640),"3d":r(8349),"3dspecular":r(8349)},x={dot:r(1885),flat:r(6404),"3d":r(6404),"3dspecular":r(6404)},b=e.color_map&&e.color_map.data||null;let w=e.opacity_function&&e.opacity_function.data||null;const M=e.color_range,C=e.attribute&&e.attribute.data||null;let E={},S=0;const A=_[g.toLowerCase()]||_.flat,P=x[g.toLowerCase()]||x.flat;if(C&&M&&b&&C.length>0&&M.length>0&&b.length>0){S=1,null!==w&&0!==w.length||(w=[b[0],1,b[b.length-4],1],e.opacity_function={data:w,shape:[4]});const t=a.createCanvasGradient(b,1024,w),r=new n.CanvasTexture(t,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);r.needsUpdate=!0,E={low:{value:M[0]},high:{value:M[1]},colormap:{type:"t",value:r}}}else f=h&&h.length===p.length/3?m(h):u(d,p.length/3);const z=new n.ShaderMaterial({uniforms:n.UniformsUtils.merge([n.UniformsLib.lights,n.UniformsLib.points,E]),defines:{USE_SPECULAR:"3dSpecular"===g?1:0,USE_COLOR_MAP:S,USE_PER_POINT_OPACITY:null!==v?1:0,USE_PER_POINT_SIZE:null!==y?1:0},vertexShader:P,fragmentShader:A,opacity:e.opacity,depthWrite:1===e.opacity&&null===v,transparent:1!==e.opacity||null!==v,lights:!0,clipping:!0,extensions:{fragDepth:!0}});z.size=e.point_size,z.color=new n.Color(1,1,1),z.map=null,z.isPointsMaterial=!0;const D=new n.Points(function(e,t,r,o,a){const i=new n.BufferGeometry;return i.setAttribute("position",new n.BufferAttribute(new Float32Array(e),3)),t&&t.length>0&&i.setAttribute("color",new n.BufferAttribute(t,3)),r&&r.length>0&&i.setAttribute("opacities",new n.BufferAttribute(r,1).setUsage(n.DynamicDrawUsage)),o&&o.length>0&&i.setAttribute("sizes",new n.BufferAttribute(o,1).setUsage(n.DynamicDrawUsage)),a&&a.length>0&&i.setAttribute("attributes",new n.BufferAttribute(a,1).setUsage(n.DynamicDrawUsage)),i.computeBoundingSphere(),i.computeBoundingBox(),i}(p,f,v,y,S?C:null),z);return"dot"!==e.shader&&c.expandBoundingBox(D.geometry.boundingBox,.5*e.point_size),i.init(e,D,t,s,l.prepareGeometry(D.geometry),l.Intersect),o.set.apply(o,e.model_matrix.data),D.applyMatrix4(o),D.updateMatrixWorld(),Promise.resolve(D)},update(e,t,r,n){const o={};if(void 0===t.positions||t.positions.timeSeries||t.positions.data.length!==r.geometry.attributes.position.array.length||(r.geometry.attributes.position.array.set(t.positions.data),r.geometry.attributes.position.needsUpdate=!0,r.geometry.computeBoundingSphere(),r.geometry.computeBoundingBox(),o.positions=null,r.interactions&&(r.stopInteraction(),i.init(e,r,n,s,l.prepareGeometry(r.geometry),l.Intersect))),void 0!==t.color_range&&!t.color_range.timeSeries&&r.geometry.attributes.attributes&&(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&r.geometry.attributes.attributes){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,o.color_map=null,o.opacity_function=null}return void 0!==t.attribute&&!t.attribute.timeSeries&&r.geometry.attributes.attributes&&t.attribute.data.length===r.geometry.attributes.attributes.array.length&&(r.geometry.attributes.attributes.array.set(t.attribute.data),r.geometry.attributes.attributes.needsUpdate=!0,o.attribute=null),void 0===t.colors||t.colors.timeSeries||t.colors.data.length!==r.geometry.attributes.color.array.length/3||(r.geometry.attributes.color.array.set(m(t.colors.data)),r.geometry.attributes.color.needsUpdate=!0,o.colors=null),i.update(e,t,o,r),d(e,t,o,r,n),!!p(t,o)&&Promise.resolve({json:e,obj:r})}}},8438:(e,t,r)=>{const n=r(108),o=r(5321),a=r(5103),i=r(2539),s=r(4534),l=r(9782),c=r(9724),{areAllChangesResolve:d}=c,{commonUpdate:p}=c,{getColorsArray:u}=c;e.exports={create(e,t){const d=new n.Matrix4,p=new n.Color(e.color),m=e.positions.data,h=e.colors&&e.colors.data||null,g=void 0!==e.mesh_detail?e.mesh_detail:2;let f;const v=e.opacities&&e.opacities.data&&e.opacities.data.length===m.length/3?e.opacities.data:null,y=e.point_sizes&&e.point_sizes.data&&e.point_sizes.data.length===m.length/3?e.point_sizes.data:null,{colorsToFloat32Array:_}=o,x=n.ShaderLib.phong;let b;const w=new n.BufferGeometry,M=new n.IcosahedronBufferGeometry(.5*e.point_size,g),C=e.color_map&&e.color_map.data||null;let E=e.opacity_function&&e.opacity_function.data||null;const S=e.color_range,A=e.attribute&&e.attribute.data||null;let P={},z=0;if(A&&S&&C&&A.length>0&&S.length>0&&C.length>0){z=1,null!==E&&0!==E.length||(E=[C[0],1,C[C.length-4],1],e.opacity_function={data:E,shape:[4]});const t=a.createCanvasGradient(C,1024,E),r=new n.CanvasTexture(t,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);r.needsUpdate=!0,P={low:{value:S[0]},high:{value:S[1]},colormap:{type:"t",value:r}},M.setAttribute("attributes",new n.InstancedBufferAttribute(A,1).setUsage(n.DynamicDrawUsage))}else f=h&&h.length===m.length/3?_(h):u(p,m.length/3);M.setAttribute("color",new n.InstancedBufferAttribute(new Float32Array(f),3)),v&&M.setAttribute("opacities",new n.InstancedBufferAttribute(v,1)),w.setAttribute("position",new n.BufferAttribute(m,3)),w.computeBoundingSphere(),w.computeBoundingBox(),c.expandBoundingBox(w.boundingBox,.5*e.point_size),M.boundingBox=w.boundingBox.clone();const D=new n.ShaderMaterial({uniforms:n.UniformsUtils.merge([x.uniforms,{shininess:{value:50},opacity:{value:e.opacity}},P]),defines:{USE_PER_POINT_OPACITY:null!==v?1:0,USE_COLOR_MAP:z},vertexShader:r(2048),fragmentShader:r(6772),depthWrite:1===e.opacity&&null===v,transparent:1!==e.opacity||null!==v,lights:!0,clipping:!0,vertexColors:n.VertexColors}),T=new n.InstancedMesh(M,D,m.length/3);T.instanceMatrix.setUsage(n.DynamicDrawUsage);let k=new n.BufferGeometry;for(k.setAttribute("position",new n.BufferAttribute(m,3)),d.set.apply(d,e.model_matrix.data),T.applyMatrix4(d),T.updateMatrixWorld(),i.init(e,T,t,s,l.prepareGeometry(k),l.Intersect),b=0;b<m.length/3;b++){const e=y&&y[b]||1;T.setMatrixAt(b,(new n.Matrix4).identity().setPosition(m[3*b],m[3*b+1],m[3*b+2]).scale(new n.Vector3(e,e,e)))}return Promise.resolve(T)},update(e,t,r,o){const c={};if(void 0!==t.positions&&!t.positions.timeSeries&&t.positions.data.length/3===r.instanceMatrix.count){const a=t.positions.data;for(let t=0;t<a.length/3;t++){const o=e.sizes&&e.sizes[t]||1;r.setMatrixAt(t,(new n.Matrix4).identity().setPosition(a[3*t],a[3*t+1],a[3*t+2]).scale(new n.Vector3(o,o,o)))}if(r.interactions){r.stopInteraction();let t=new n.BufferGeometry;t.setAttribute("position",new n.BufferAttribute(a,3)),i.init(e,r,o,s,l.prepareGeometry(t),l.Intersect)}r.instanceMatrix.needsUpdate=!0,c.positions=null}if((void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&r.geometry.attributes.attributes){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,c.color_map=null,c.opacity_function=null}return void 0!==t.color_range&&!t.color_range.timeSeries&&r.geometry.attributes.attributes&&(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],c.color_range=null),void 0!==t.attribute&&!t.attribute.timeSeries&&r.geometry.attributes.attributes&&t.attribute.data.length===r.geometry.attributes.attributes.array.length&&(r.geometry.attributes.attributes.array.set(t.attribute.data),r.geometry.attributes.attributes.needsUpdate=!0,c.attribute=null),i.update(e,t,c,r),p(e,t,c,r,o),!!d(t,c)&&Promise.resolve({json:e,obj:r})}}},8012:(e,t,r)=>{const n=r(108),o=r(9961),{areAllChangesResolve:a}=r(9724),{commonUpdate:i}=r(9724);e.exports={create(e){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading;const t=new n.STLLoader,r=new n.Matrix4;let a=new(e.wireframe?n.MeshBasicMaterial:n.MeshPhongMaterial)({color:e.color,emissive:0,shininess:50,specular:1118481,flatShading:e.flat_shading,side:n.DoubleSide,wireframe:e.wireframe});const{text:i}=e,{binary:s}=e;let l;l=null==i?t.parse(s.data.buffer):t.parse(i),l.hasColors&&(a=new n.MeshPhongMaterial({opacity:l.alpha,vertexColors:n.VertexColors,wireframe:e.wireframe})),!1===e.flat_shading&&(l=o.mergeVertices(l),l.computeVertexNormals());const c=new n.Mesh(l,a);return l.computeBoundingSphere(),l.computeBoundingBox(),r.set.apply(r,e.model_matrix.data),c.applyMatrix4(r),c.updateMatrixWorld(),Promise.resolve(c)},update(e,t,r,n){const o={};return i(e,t,o,r,n),!!a(t,o)&&Promise.resolve({json:e,obj:r})}}},6264:(e,t,r)=>{const n=r(2976),{areAllChangesResolve:o}=r(9724),{commonUpdate:a}=r(9724);function i(e){let t;this._map=new Map,this.set=function(r,n,o,a,i){const s=e.sparse_voxels.data;if(this._map.set((o*e.space_size.data[0]+n)*e.space_size.data[1]+r,a),i){for(let i=0;i<s.length;i+=4)if(s[i]===r&&s[i+1]===n&&s[i+2]===o)return void(0===a?(t=new s.constructor(s.length-4),t.set(s.subarray(0,i)),t.set(s.subarray(i+4,s.length),i),e.sparse_voxels.data=t,e.sparse_voxels.shape[0]--):s[i+3]=a);0!==a&&(t=new s.constructor(s.length+4),t.set(s),t.set([r,n,o,a],s.length),e.sparse_voxels.data=t,e.sparse_voxels.shape[0]++)}},this.get=function(t,r,n){return this._map.get((n*e.space_size.data[0]+r)*e.space_size.data[1]+t)}}e.exports={create(e,t){const r=e.sparse_voxels.data,o=new i(e);let a;for(a=0;a<r.length;a+=4)o.set(r[a],r[a+1],r[a+2],r[a+3],!1);return n.create(e,n.generateRegularChunks(32,[e.space_size.data[2],e.space_size.data[1],e.space_size.data[0]],o),e.space_size.data,t)},update(e,t,r,n){const i={};return void 0===t.opacity||t.opacity.timeSeries||(r.traverse((t=>{t.material&&(t.material.userData.outline?(t.material.uniforms.opacity.value=.75*e.opacity,t.material.opacity=t.material.uniforms.opacity.value):(t.material.opacity=e.opacity,t.material.depthWrite=1===e.opacity,t.material.transparent=1!==e.opacity))})),i.opacity=null),a(e,t,i,r,n),!!o(t,i)&&Promise.resolve({json:e,obj:r})}}},4638:(e,t,r)=>{const n=r(108),o=r(2539),{handleColorMap:a}=r(9724),{areAllChangesResolve:i}=r(9724),{commonUpdate:s}=r(9724);e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:255,e.wireframe=void 0!==e.wireframe&&e.wireframe,e.flat_shading=void 0===e.flat_shading||e.flat_shading,e.opacity=void 0!==e.opacity?e.opacity:1;const r=e.heights.data,i=e.heights.shape[1],s=e.heights.shape[0],l=new n.Matrix4,c=e.wireframe?n.MeshBasicMaterial:n.MeshPhongMaterial,d=e.color_range,p=e.color_map&&e.color_map.data||null,u=e.attribute&&e.attribute.data||null,m=new c({color:e.color,opacity:e.opacity,depthWrite:1===e.opacity,transparent:1!==e.opacity,emissive:0,shininess:50,specular:1118481,side:n.DoubleSide,flatShading:e.flat_shading,wireframe:e.wireframe}),h=new n.BufferGeometry,g=new Float32Array(i*s*3),f=[];let v,y,_,x;for(y=0,_=0,x=0;y<s;y++)for(v=0;v<i;v++,x++,_+=3)g[_]=v/(i-1),g[_+1]=y/(s-1),g[_+2]=r[x];for(y=0,_=0;y<s-1;y++)for(v=0;v<i-1;v++,_+=6)f[_]=v+y*i,f[_+1]=v+1+y*i,f[_+3]=f[_+1],f[_+2]=v+(y+1)*i,f[_+5]=f[_+2],f[_+4]=v+1+(y+1)*i;h.setAttribute("position",new n.BufferAttribute(g,3)),h.setIndex(f),!1===e.flat_shading&&h.computeVertexNormals(),u&&d&&p&&u.length>0&&d.length>0&&p.length>0&&a(h,p,d,u,m),h.computeBoundingSphere(),h.computeBoundingBox();const b=new n.Mesh(h,m);return o.init(e,b,t),l.set.apply(l,e.model_matrix.data),b.position.set(-.5,-.5,0),b.initialPosition=b.position.clone(),b.updateMatrix(),b.applyMatrix4(l),b.updateMatrixWorld(),Promise.resolve(b)},update(e,t,r,n){const a={};return o.update(e,t,a,r),s(e,t,a,r,n),!!i(t,a)&&Promise.resolve({json:e,obj:r})}}},2932:(e,t,r)=>{const n=r(108);let o=r(8633);const{areAllChangesResolve:a}=r(9724);function i(e,t,r,o){const a=new n.Vector3,i=.5*r.width,s=.5*r.height;return a.fromArray(e.positions,3*t),a.applyMatrix4(e.matrixWorld),o.frustum&&!o.frustum.containsPoint(a)?{x:-1e3,y:-1e3,z:-1e3}:(a.project(o),a.x=(a.x+1)*i+r.offsetX,a.y=(1-a.y)*s+r.offsetY,{x:Math.round(a.x),y:Math.round(a.y),z:a.z})}function s(e){return`#${new n.Color(e).getHexString()}`}o=o.default||o,e.exports={create(e,t,r){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0,e.text=void 0!==e.text?e.text:"\\KaTeX";const a=new n.Matrix4,{text:l}=e,{color:c}=e,d=e.reference_point||"lb",p=e.size||1;let{position:u}=e;const m=new n.Object3D,h=t.getWorld(),{overlayDOMNode:g}=h;let f,v=[];for(u.data?m.positions=u.data:m.positions=u,m.text=l,f=0;f<m.positions.length/3;f++){const r=document.createElement("div");e.is_html?(r.innerHTML=Array.isArray(l)?l[f]:l,r.style.cssText="pointer-events: all"):r.innerHTML=o.renderToString(Array.isArray(l)?l[f]:l,{displayMode:!0}),r.style.position="absolute",r.style.color=s(c),r.style.fontSize=`${p}em`,e.label_box&&(r.style.padding="5px",r.style.background=t.getWorld().targetDOMNode.style.backgroundColor,r.style.border=`1px solid ${s(c)}`,r.style.borderRadius="10px"),g.appendChild(r),v.push(r)}e.model_matrix&&(a.set.apply(a,e.model_matrix.data),m.applyMatrix4(a)),m.updateMatrixWorld();const y=t.on(t.events.BEFORE_RENDER,(function(){v.forEach((function(t,n){let o,a,s;if("hidden"!==t.style.display){switch(o=r?i(m,n,{width:r.width,height:r.height,offsetX:h.width-r.width,offsetY:h.height-r.height},r.camera):i(m,n,{width:h.width,height:h.height,offsetX:0,offsetY:0},h.camera),d[0]){case"l":a=`${o.x}px`;break;case"c":a=`calc(${o.x}px - 50%)`;break;case"r":a=`calc(${o.x}px - 100%)`}switch(d[1]){case"t":s=`${o.y}px`;break;case"c":s=`calc(${o.y}px - 50%)`;break;case"b":s=`calc(${o.y}px - 100%)`}t.style.transform=`translate(${a},${s})`,t.style.zIndex=e.on_top?16777271-Math.round(1e6*o.z):"15"}}))}));return m.domElements=v,m.onRemove=function(){v.forEach((function(e){g.contains(e)&&(g.removeChild(e),e=null)})),v=[],t.off(t.events.BEFORE_RENDER,y)},m.hide=function(){v.forEach((function(e){e.style.display="none"}))},m.show=function(){v.forEach((function(e){e.style.display="block"}))},m.boundingBox=(new n.Box3).setFromArray(m.positions),m.show(),Promise.resolve(m)},update(e,t,r){const n={};return void 0===t.text||t.text.timeSeries||(r.domElements.forEach((function(r,n){let a=Array.isArray(t.text)?t.text[n]:t.text;e.is_html?(r.innerHTML=a,r.style.pointerEvents="all"):(r.innerHTML=o.renderToString(a,{displayMode:!0}),r.style.pointerEvents="none")})),n.text=null),void 0===t.position||t.position.timeSeries||(r.positions=t.position.data||t.position,n.position=null),!!a(t,n)&&Promise.resolve({json:e,obj:r})}}},3099:(e,t,r)=>{const n=r(108);let o=r(8633);const{areAllChangesResolve:a}=r(9724);function i(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}o=o.default||o,e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:0;const r=e.text||"\\KaTeX",{color:a}=e,s=e.reference_point||"lb";let{position:l}=e;const c=e.size||1,d=new n.Object3D,{overlayDOMNode:p}=t.getWorld(),u=t.getWorld();let m,h=[];for(l.data?d.positions=l.data:d.positions=l,d.text=r,m=0;m<d.positions.length/2;m++){const n=document.createElement("div");e.is_html?(n.innerHTML=Array.isArray(r)?r[m]:r,n.style.cssText="pointer-events: all"):n.innerHTML=o.renderToString(Array.isArray(r)?r[m]:r,{displayMode:!0}),l.data&&(l=l.data),n.style.position="absolute",n.style.color=i(a),n.style.fontSize=`${c}em`,e.label_box&&(n.style.padding="5px",n.style.background=t.getWorld().targetDOMNode.style.backgroundColor,n.style.border=`1px solid ${i(a)}`,n.style.borderRadius="10px"),p.appendChild(n),h.push(n)}const g=t.on(t.events.BEFORE_RENDER,(function(){h.forEach((function(e,t){let r,n;const o=d.positions[2*t]*u.width,a=d.positions[2*t+1]*u.height;switch(s[0]){case"l":r=`${o}px`;break;case"c":r=`calc(${o}px - 50%)`;break;case"r":r=`calc(${o}px - 100%)`}switch(s[1]){case"t":n=`${a}px`;break;case"c":n=`calc(${a}px - 50%)`;break;case"b":n=`calc(${a}px - 100%)`}e.style.transform=`translate(${r},${n})`,e.style.zIndex=16777271}))}));return d.domElements=h,d.onRemove=function(){h.forEach((function(e){p.removeChild(e),e=null})),h=[],t.off(t.events.BEFORE_RENDER,g)},d.hide=function(){h.forEach((function(e){e.style.display="none"}))},d.show=function(){h.forEach((function(e){e.style.display="block"}))},Promise.resolve(d)},update(e,t,r){const n={};return void 0===t.text||t.text.timeSeries||(r.domElements.forEach((function(r,n){let a=Array.isArray(t.text)?t.text[n]:t.text;e.is_html?(r.innerHTML=a,r.style.pointerEvents="all"):(r.innerHTML=o.renderToString(a,{displayMode:!0}),r.style.pointerEvents="none")})),n.text=null),void 0===t.position||t.position.timeSeries||(r.positions=t.position.data||t.position,n.position=null),!!a(t,n)&&Promise.resolve({json:e,obj:r})}}},2833:(e,t,r)=>{const n=r(8507),o=r(719);e.exports={create:(e,t)=>(e.visible=void 0===e.visible||e.visible,e.file_format&&e.binary?n.create(e,t):o.create(e,t)),update:(e,t,r,a)=>e.file_format&&e.binary?n.update(e,t,r,a):o.update(e,t,r,a)}},719:(e,t,r)=>{const n=r(108),o=r(2539),a=r(5103),{areAllChangesResolve:i}=r(9724),{commonUpdate:s}=r(9724),{typedArrayToThree:l}=r(9724);e.exports={create:(e,t)=>new Promise((i=>{const s=new n.PlaneBufferGeometry(1,1),c=new n.Matrix4,d=e.color_map&&e.color_map.data||null;let p=e.opacity_function&&e.opacity_function.data||null;const u=e.color_range;e.interpolation=void 0===e.interpolation||e.interpolation,null!==p&&0!==p.length||(p=[d[0],1,d[d.length-4],1],e.opacity_function={data:p,shape:[4]});const m=new n.DataTexture(e.attribute.data,e.attribute.shape[1],e.attribute.shape[0],n.RedFormat,l(e.attribute.data.constructor));e.interpolation?(m.minFilter=n.LinearFilter,m.magFilter=n.LinearFilter,m.anisotropy=t.getWorld().renderer.capabilities.getMaxAnisotropy()):(m.minFilter=n.NearestFilter,m.magFilter=n.NearestFilter,m.anisotropy=0),m.generateMipmaps=!1,m.needsUpdate=!0;const h=a.createCanvasGradient(d,1024,p),g=new n.CanvasTexture(h,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);g.needsUpdate=!0;const f={low:{value:u[0]},high:{value:u[1]},map:{type:"t",value:m},colormap:{type:"t",value:g}},v=new n.ShaderMaterial({uniforms:f,vertexShader:r(3012),fragmentShader:r(7644),side:n.DoubleSide,clipping:!0});if(9===e.puv.data.length){const t=s.attributes.position.array,r=(new n.Vector3).fromArray(e.puv.data,0),o=(new n.Vector3).fromArray(e.puv.data,3),a=(new n.Vector3).fromArray(e.puv.data,6);r.toArray(t,0),r.clone().add(o).toArray(t,3),r.clone().add(a).toArray(t,6),r.clone().add(a).add(o).toArray(t,9),s.computeVertexNormals()}s.computeBoundingSphere(),s.computeBoundingBox();const y=new n.Mesh(s,v);o.init(e,y,t),c.set.apply(c,e.model_matrix.data),y.applyMatrix4(c),y.updateMatrixWorld(),y.onRemove=function(){y.material.uniforms.map.value.dispose(),y.material.uniforms.map.value=void 0,y.material.uniforms.colormap.value.dispose(),y.material.uniforms.colormap.value=void 0},i(y)})),update(e,t,r,n){const l={};if(o.update(e,t,l,r),void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],l.color_range=null),(void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries)&&(!t.opacity_function||!1!==r.material.transparent)){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,l.color_map=null,l.opacity_function=null}return void 0===t.attribute||t.attribute.timeSeries||r.material.uniforms.map.value.image.data.constructor===t.attribute.data.constructor&&r.material.uniforms.map.value.image.width===t.attribute.shape[1]&&r.material.uniforms.map.value.image.height===t.attribute.shape[0]&&(r.material.uniforms.map.value.image.data=t.attribute.data,r.material.uniforms.map.value.needsUpdate=!0,l.attribute=null),s(e,t,l,r,n),!!i(t,l)&&Promise.resolve({json:e,obj:r})}}},8507:(e,t,r)=>{const n=r(108),o=r(2539),{areAllChangesResolve:a}=r(9724),{commonUpdate:i}=r(9724),s=r(5321);e.exports={create:(e,t)=>new Promise((r=>{const a=new n.PlaneBufferGeometry(1,1),i=new n.Matrix4,l=new n.Texture;let c,d;e.interpolation=void 0===e.interpolation||e.interpolation;const p=document.createElement("img");if(p.src=`data:image/${e.file_format};base64,${s.bufferToBase64(e.binary.data.buffer)}`,9===e.puv.data.length){const t=a.attributes.position.array,r=(new n.Vector3).fromArray(e.puv.data,0),o=(new n.Vector3).fromArray(e.puv.data,3),i=(new n.Vector3).fromArray(e.puv.data,6);r.toArray(t,0),r.clone().add(o).toArray(t,3),r.clone().add(i).toArray(t,6),r.clone().add(i).add(o).toArray(t,9),a.computeVertexNormals()}a.computeBoundingSphere(),a.computeBoundingBox(),p.onload=function(){c=new n.MeshBasicMaterial({color:16777215,side:n.DoubleSide,map:l}),d=new n.Mesh(a,c),o.init(e,d,t),i.set.apply(i,e.model_matrix.data),d.applyMatrix4(i),d.updateMatrixWorld(),e.interpolation?(l.minFilter=n.LinearFilter,l.magFilter=n.LinearFilter):(l.minFilter=n.NearestFilter,l.magFilter=n.NearestFilter),l.image=p,l.flipY=!1,l.minFilter=n.LinearFilter,l.needsUpdate=!0,r(d)}})),update(e,t,r,n){const s={};return o.update(e,t,s,r),i(e,t,s,r,n),!!a(t,s)&&Promise.resolve({json:e,obj:r})}}},6242:(e,t,r)=>{const n=r(108),{closestPowOfTwo:o}=r(9724),{areAllChangesResolve:a}=r(9724);function i(e,t){return e.reduce(((e,r)=>{const n=t.measureText(r);let o=0;return n.actualBoundingBoxAscent&&n.actualBoundingBoxDescent&&(o=n.actualBoundingBoxAscent+n.actualBoundingBoxDescent),Math.max(e,o,n.width)}),0)}function s(e,t,r,o,a){const i=new n.Texture(e),s=new n.SpriteMaterial({map:i}),l=new n.Sprite(s),c=new n.Matrix4;return i.needsUpdate=!0,l.position.fromArray(t.positions,3*r),l.scale.set(o,o,o),l.boundingBox=(new n.Box3).setFromCenterAndSize(new n.Vector3,new n.Vector3(o,o,o)),a.model_matrix&&(c.set.apply(c,a.model_matrix.data),l.applyMatrix4(c)),l.updateMatrixWorld(),l}function l(e){return`#${(e=parseInt(e,10)+16777216).toString(16).substr(1)}`}e.exports={create(e){e.visible=void 0===e.visible||e.visible,e.color=void 0!==e.color?e.color:16777215,e.font_size=void 0!==e.font_size?e.font_size:68,e.font_weight=void 0!==e.font_weight?e.font_weight:700;const{color:t}=e;let{position:r}=e;const a=e.size||1,c=e.font_face||"Courier New",d=e.font_size,p=`${e.font_weight} ${d}px ${c}`,u=new n.Group;let m;for(r.data?u.positions=r.data:u.positions=r,m=0;m<u.positions.length/3;m++){const r=document.createElement("canvas"),n=r.getContext("2d");n.font=p;let c=Array.isArray(e.text)?e.text[m]:e.text;c=c.split("\n");const h=c.length>1,g=i(c,n);r.width=o(g),r.height=~~r.width,n.font=p,n.textBaseline="top",n.fillStyle=l(t),n.lineWidth=5,c.forEach(((e,t)=>{const o=(r.width-g)/2,a=r.height/2-(h?d:d/2)+d*t;n.strokeText(e,o,a),n.fillText(e,o,a)}));const f=s(r,u,m,a,e);u.add(f)}return Promise.resolve(u)},update(e,t,r){const n={};if(void 0!==t.position&&!t.position.timeSeries){let e=t.position.data||t.position;r.children.forEach((function(t,r){t.position.fromArray(e,3*r)})),n.position=null}return void 0===t.size||t.size.timeSeries||(r.children.forEach((function(e){e.scale.set(t.size,t.size,t.size)})),n.size=null),!!a(t,n)&&Promise.resolve({json:e,obj:r})}}},7186:(e,t,r)=>{const n=r(108);e.exports={create(e){const t=new n.Object3D,r=new n.Matrix4;var o,a;return t.add(new n.LineSegments(new n.BufferGeometry,new n.LineBasicMaterial({color:16777215,transparent:!0,opacity:.5}))),t.add(new n.Mesh(new n.BufferGeometry,new n.MeshPhongMaterial({color:e.color,emissive:0,side:n.DoubleSide,flatShading:!0}))),o=t,a=new n.TorusKnotGeometry(e.radius,e.tube,64,e.knotsNumber,2,3),o.children[0].geometry.dispose(),o.children[1].geometry.dispose(),o.children[0].geometry=new n.WireframeGeometry(a),o.children[1].geometry=a,o.children[0].geometry.computeBoundingSphere(),o.children[1].geometry.computeBoundingSphere(),o.children[0].geometry.computeBoundingBox(),o.children[1].geometry.computeBoundingBox(),r.set.apply(r,e.model_matrix.data),t.applyMatrix4(r),t.updateMatrixWorld(),Promise.resolve(t)}}},253:(e,t,r)=>{const n=r(108),o=r(9961),a=r(5321),{areAllChangesResolve:i}=r(9724),{commonUpdate:s}=r(9724),l=r(2460)(n),{getTwoColorsArray:c}=r(9724),{generateArrow:d}=r(9724);e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.origin_color=void 0!==e.origin_color?e.origin_color:255,e.head_color=void 0!==e.head_color?e.head_color:255,e.use_head=void 0===e.use_head||e.use_head,e.head_size=e.head_size||1,e.scale=e.scale||1,e.line_width=e.line_width||.01;const r=(new n.Matrix4).fromArray(e.model_matrix.data),i=new n.Color(e.origin_color),s=new n.Color(e.head_color);let p=e.vectors.shape[2],u=e.vectors.shape[1],m=e.vectors.shape[0],h=e.vectors.data,g=e.colors&&e.colors.data||null;const f=e.use_head,v=e.head_size,{scale:y}=e,_=new n.Group;let x,b,w,M,C,E,S=null;const A=[],{colorsToFloat32Array:P}=a;3===e.vectors.shape.length&&(p=u,u=m,m=1,h=function(e){let t;const r=new Float32Array(e.length/2*3);for(t=0;t<e.length/2;t++)r[3*t]=e[2*t],r[3*t+1]=e[2*t+1],r[3*t+2]=0;return r}(h));const z=y/Math.max(p,u,m);g=g?P(g):c(i,s,p*u*m*2);const D=new n.CylinderGeometry(0,.025*v*z,.2*v*z,5,1).translate(0,-.1*v*z,0);for(w=0,M=0;w<m;w++)for(b=0;b<u;b++)for(x=0;x<p;x++,M++)C=new n.Vector3(x/p,b/u,w/m),E=new n.Vector3(h[3*M]/2*z,h[3*M+1]/2*z,h[3*M+2]/2*z).add(C),S=d(f?D:null,A,S,C,E,new n.Color(g[6*M+3],g[6*M+4],g[6*M+5]),.2*v*z);f&&function(e,t){(e=o.mergeBufferGeometries(e)).computeBoundingSphere(),e.computeBoundingBox(),t.add(new n.Mesh(e,new n.MeshBasicMaterial({vertexColors:n.VertexColors})))}(S,_);let T=new l.MeshLine;const k=new l.MeshLineMaterial({color:new n.Color(1,1,1),opacity:1,sizeAttenuation:!0,transparent:!0,lineWidth:e.line_width,resolution:new n.Vector2(t.getWorld().width,t.getWorld().height),side:n.DoubleSide});T.setGeometry(new Float32Array(A),!0,null,g),T.geometry.computeBoundingSphere(),T.geometry.computeBoundingBox(),T=new n.Mesh(T.geometry,k),_.add(T),_.position.set(-.5,-.5,1===m?0:-.5),_.initialPosition=_.position.clone(),_.updateMatrix(),_.applyMatrix4(r),_.boundingBox=T.geometry.boundingBox,_.updateMatrixWorld();const O=t.on(t.events.RESIZED,(()=>{T.material.uniforms.resolution.value.x=t.getWorld().width,T.material.uniforms.resolution.value.y=t.getWorld().height}));return _.onRemove=function(){t.off(t.events.RESIZED,O)},Promise.resolve(_)},update(e,t,r,n){const o={};return s(e,t,o,r,n),!!i(t,o)&&Promise.resolve({json:e,obj:r})}}},860:(e,t,r)=>{const n=r(108),o=r(9961),a=r(5321),i=r(2460)(n),{getTwoColorsArray:s}=r(9724),{generateArrow:l}=r(9724),c=r(2932),d=r(9724),{commonUpdate:p}=d,{areAllChangesResolve:u}=d;function m(e,t,r,n,o){const a=t.clone().add(r).divideScalar(2),i={position:[a.x,a.y,a.z],referencePoint:"cb",text:e,size:n};return c.create(i,o)}e.exports={create(e,t){e.visible=void 0===e.visible||e.visible,e.origin_color=void 0!==e.origin_color?e.origin_color:255,e.head_color=void 0!==e.head_color?e.head_color:255,e.use_head=void 0===e.use_head||e.use_head,e.head_size=e.head_size||1,e.line_width=e.line_width||.01;const r=new n.Matrix4,c=new n.Color(e.origin_color),d=new n.Color(e.head_color),p=e.vectors.data,u=e.origins.data;let h=e.colors&&e.colors.data||[];const g=e.use_head,f=e.head_size,v=new n.Group;let y,_,x;const b=e.label_size,{labels:w}=e,M=[];let C=null;const E=[];if(h=h.length>0?a.colorsToFloat32Array(h):s(c,d,p.length/3*2),p.length!==u.length)throw new Error("vectors and origins should have the same length");if(h&&h.length/2!==p.length)throw new Error("there should be 2 colors for each vector");const S=new n.CylinderGeometry(0,.025*f,.2*f,5,1).translate(0,-.1*f,0);for(x=0;x<p.length;x+=3)y=new n.Vector3(u[x],u[x+1],u[x+2]),_=new n.Vector3(p[x],p[x+1],p[x+2]).add(y),C=l(g?S:null,E,C,y,_,new n.Color(h[2*x+3],h[2*x+4],h[2*x+5]),.2*f),w&&w[x/3]&&M.push(m(w[x/3],y,_,b,t));g&&function(e,t){(e=o.mergeBufferGeometries(e)).computeBoundingSphere(),e.computeBoundingBox(),t.add(new n.Mesh(e,new n.MeshBasicMaterial({vertexColors:n.VertexColors})))}(C,v);let A=new i.MeshLine;const P=new i.MeshLineMaterial({color:new n.Color(1,1,1),opacity:1,sizeAttenuation:!0,transparent:!0,lineWidth:e.line_width,resolution:new n.Vector2(t.getWorld().width,t.getWorld().height),side:n.DoubleSide});A.setGeometry(new Float32Array(E),!0,null,h),A.geometry.computeBoundingSphere(),A.geometry.computeBoundingBox(),A=new n.Mesh(A.geometry,P),v.add(A),e.model_matrix&&(r.set.apply(r,e.model_matrix.data),v.applyMatrix4(r)),v.updateMatrixWorld();const z=t.on(t.events.RESIZED,(()=>{A.material.uniforms.resolution.value.x=t.getWorld().width,A.material.uniforms.resolution.value.y=t.getWorld().height}));return Promise.all(M).then((e=>(e.forEach((e=>{v.add(e)})),v.onRemove=function(){e.forEach((e=>{e.onRemove()})),t.off(t.events.RESIZED,z)},v)))},update(e,t,r,n){const o={};return p(e,t,o,r,n),!!u(t,o)&&Promise.resolve({json:e,obj:r})}}},5064:(e,t,r)=>{const n=r(108),o=r(5843),a=r(5103),{closestPowOfTwo:i}=r(9724),{typedArrayToThree:s}=r(9724),{areAllChangesResolve:l}=r(9724),{commonUpdate:c}=r(9724),{ensure256size:d}=r(9724);e.exports={create(e,t){e.samples=e.samples||512,e.alpha_coef=void 0!==e.alpha_coef?e.alpha_coef:50,e.gradient_step=e.gradient_step||.005,e.shadow=e.shadow||"off",e.interpolation=void 0===e.interpolation||e.interpolation,e.shadow_delay=e.shadow_delay||500,e.shadow_res=i(e.shadow_res||128),e.ray_samples_count=e.ray_samples_count||16,e.focal_plane=e.focal_plane||512,e.focal_length=void 0!==e.focal_length?e.focal_length:0;const l=void 0!==window.randomMul?window.randomMul:255,c=t.getWorld().renderer.getContext(),p=new n.BoxBufferGeometry(1,1,1),u=new n.Matrix4,m=new n.Vector3,h=new n.Quaternion,g=new n.Vector3,f=c.getParameter(c.MAX_TEXTURE_SIZE);let v=e.shadow_res;const y=e.color_map&&e.color_map.data||null;let _=e.opacity_function&&e.opacity_function.data||null;const x=e.color_range,{samples:b}=e;let w,M,C,E,S,A,P,z=null,D=!1,T=0;v=v>512?512:v;const k=i(Math.sqrt(v*v*v));if(k>f)throw new Error(`To big light map size. gl.MAX_TEXTURE_SIZE=${f}`);null===_&&(_=[y[0],0,y[y.length-4],1]),u.set.apply(u,e.model_matrix.data),u.decompose(m,h,g);const O=new n.Data3DTexture(e.volume.data,e.volume.shape[2],e.volume.shape[1],e.volume.shape[0]);O.format=n.RedFormat,O.type=s(e.volume.data.constructor),O.generateMipmaps=!1,e.interpolation?(O.minFilter=n.LinearFilter,O.magFilter=n.LinearFilter):(O.minFilter=n.NearestFilter,O.magFilter=n.NearestFilter),O.wrapS=n.ClampToEdgeWrapping,O.wrapT=n.ClampToEdgeWrapping,O.wrapR=n.ClampToEdgeWrapping,O.needsUpdate=!0,S=new n.DataTexture(new Uint8Array(o.range(4096).map((()=>l*Math.random()))),64,64,n.RedFormat,n.UnsignedByteType),S.minFilter=n.LinearFilter,S.magFilter=n.LinearFilter,S.wrapS=n.MirroredRepeatWrapping,S.wrapT=n.MirroredRepeatWrapping,S.generateMipmaps=!1,S.needsUpdate=!0;const j=a.createCanvasGradient(y,1024,_),I=new n.CanvasTexture(j,n.UVMapping,n.ClampToEdgeWrapping,n.ClampToEdgeWrapping,n.NearestFilter,n.NearestFilter);I.needsUpdate=!0,"off"!==e.shadow&&(E=new n.WebGLRenderTarget(k,k,{minFilter:n.LinearFilter,magFilter:n.LinearFilter,format:n.RedFormat,type:n.UnsignedByteType,generateMipmaps:!1,stencilBuffer:!1,depthBuffer:!1})),e.mask.data.length>0&&e.mask_opacities.data.length>0&&(z=new n.Data3DTexture(e.mask.data,e.mask.shape[2],e.mask.shape[1],e.mask.shape[0]),z.format=n.RedFormat,z.type=n.UnsignedByteType,z.generateMipmaps=!1,z.minFilter=n.NearestFilter,z.magFilter=n.NearestFilter,z.wrapS=n.ClampToEdgeWrapping,z.wrapT=n.ClampToEdgeWrapping,z.needsUpdate=!0,D=!0);const L={maskOpacities:{value:d(e.mask_opacities.data)},lightMapSize:{value:new n.Vector3(v,v,v)},volumeMapSize:{value:new n.Vector3(e.volume.shape[2],e.volume.shape[1],e.volume.shape[0])},lightMapRenderTargetSize:{value:new n.Vector2(k,k)},low:{value:x[0]},high:{value:x[1]},samples:{value:b},alpha_coef:{value:e.alpha_coef},gradient_step:{value:e.gradient_step},translation:{value:m},rotation:{value:h},shadowTexture:{type:"t",value:E?E.texture:null},focal_length:{value:e.focal_length},focal_plane:{value:e.focal_plane},scale:{value:g},volumeTexture:{type:"t",value:O},mask:{type:"t",value:z},colormap:{type:"t",value:I},jitterTexture:{type:"t",value:S}},F=new n.ShaderMaterial({uniforms:o.merge(L,n.UniformsLib.lights),defines:{USE_SHADOW:"off"!==e.shadow?1:0,USE_MASK:D?1:0,RAY_SAMPLES_COUNT:0!==e.focal_length?e.ray_samples_count:0},vertexShader:r(2307),fragmentShader:r(7003),side:n.BackSide,depthTest:!1,depthWrite:!1,lights:!0,clipping:!0,transparent:!0});p.computeBoundingSphere(),p.computeBoundingBox();const V=new n.Mesh(p,F);return V.applyMatrix4(u),V.updateMatrixWorld(),"off"!==e.shadow&&(w=new n.Scene,C=new n.Mesh(new n.PlaneBufferGeometry(k,k),new n.ShaderMaterial({uniforms:o.merge(L,n.UniformsLib.lights,{lightDirection:{type:"v3",value:new n.Vector3}}),defines:{USE_MAP:1,USE_MASK:D?1:0},vertexShader:r(2085),fragmentShader:r(472),clipping:!0,depthWrite:!1,depthTest:!1})),C.applyMatrix4(u),C.updateMatrixWorld(),M=new n.OrthographicCamera(k/-2,k/2,k/2,k/-2,-1e4,1e4),M.position.z=100,w.add(C),V.refreshLightMap=function(e){if(E){const{renderer:r}=t.getWorld(),o=new n.Vector3;e?C.material.uniforms.lightDirection.value.fromArray(e).normalize():(t.getWorld().camera.getWorldPosition(o),C.material.uniforms.lightDirection.value.copy(m.clone().sub(o).normalize())),t.getWorld().camera.updateMatrixWorld(),C.material.uniformsNeedUpdate=!0,r.clippingPlanes=[],t.parameters.clippingPlanes.forEach((e=>{r.clippingPlanes.push(new n.Plane((new n.Vector3).fromArray(e),e[3]))})),r.setRenderTarget(E),r.clear(!0,!0,!0),r.render(w,M),r.setRenderTarget(null)}},"dynamic"===e.shadow&&(A=t.on(t.events.BEFORE_RENDER,(()=>{const r=(new Date).getTime();P&&clearTimeout(P),r-T>=e.shadow_delay?(V.refreshLightMap(),T=r):P=setTimeout((()=>{V.refreshLightMap(),T=r,t.render()}),Math.max(e.shadow_delay,500))}))),V.quadRTT=C,V.refreshLightMap()),V.onRemove=function(){C&&(C.material.uniforms.volumeTexture.value.dispose(),C.material.uniforms.volumeTexture.value=void 0),V.material.uniforms.volumeTexture.value=void 0,V.material.uniforms.colormap.value.dispose(),V.material.uniforms.colormap.value=void 0,S.dispose(),S=void 0,w&&(w=void 0),M&&(M=void 0),E&&(E.dispose(),E=void 0),A&&t.off(t.events.BEFORE_RENDER,A)},Promise.resolve(V)},update(e,t,r,n){const o={};if(void 0===t.color_range||t.color_range.timeSeries||(r.material.uniforms.low.value=t.color_range[0],r.material.uniforms.high.value=t.color_range[1],o.color_range=null),void 0!==t.focal_length&&!t.focal_length.timeSeries&&(0===r.material.uniforms.focal_length.value&&0!==t.focal_length||0===t.focal_length))return!1;if(void 0===t.volume||t.volume.timeSeries||r.material.uniforms.volumeTexture.value.image.data.constructor===t.volume.data.constructor&&r.material.uniforms.volumeTexture.value.image.width===t.volume.shape[2]&&r.material.uniforms.volumeTexture.value.image.height===t.volume.shape[1]&&r.material.uniforms.volumeTexture.value.image.depth===t.volume.shape[0]&&(r.material.uniforms.volumeTexture.value.image.data=t.volume.data,r.material.uniforms.volumeTexture.value.needsUpdate=!0,o.volume=null),void 0===t.mask||t.mask.timeSeries||null!==r.material.uniforms.mask.value&&r.material.uniforms.mask.value.image.data.constructor===t.mask.data.constructor&&r.material.uniforms.mask.value.image.width===t.mask.shape[2]&&r.material.uniforms.mask.value.image.height===t.mask.shape[1]&&r.material.uniforms.mask.value.image.depth===t.mask.shape[0]&&(r.material.uniforms.mask.value.image.data=t.mask.data,r.material.uniforms.mask.value.needsUpdate=!0,o.mask=null),void 0===t.mask_opacities||t.mask_opacities.timeSeries||null!==r.material.uniforms.maskOpacities.value&&(r.material.uniforms.maskOpacities.value=d(t.mask_opacities.data),r.material.uniforms.maskOpacities.value.needsUpdate=!0,o.mask_opacities=null),void 0!==t.color_map&&!t.color_map.timeSeries||void 0!==t.opacity_function&&!t.opacity_function.timeSeries){const n=a.createCanvasGradient(t.color_map&&t.color_map.data||e.color_map.data,1024,t.opacity_function&&t.opacity_function.data||e.opacity_function.data);r.material.uniforms.colormap.value.image=n,r.material.uniforms.colormap.value.needsUpdate=!0,r.quadRTT&&(r.quadRTT.material.uniforms.colormap.value.image=n,r.quadRTT.material.uniforms.colormap.value.needsUpdate=!0),o.color_map=null,o.opacity_function=null}return["samples","alpha_coef","gradient_step","focal_plane","focal_length"].forEach((e=>{void 0===t[e]||t[e].timeSeries||(r.material.uniforms[e].value=t[e],o[e]=null)})),c(e,t,o,r,n),!!l(t,o)&&Promise.resolve({json:e,obj:r})}}},3060:(e,t,r)=>{const n=r(2976),{areAllChangesResolve:o}=r(9724),{commonUpdate:a}=r(9724);e.exports={create:(e,t)=>n.create(e,n.generateRegularChunks(96,e.voxels.shape,e.voxels.data),[e.voxels.shape[2],e.voxels.shape[1],e.voxels.shape[0]],t),update(e,t,r,n){const i={};return void 0===t.opacity||t.opacity.timeSeries||(r.traverse((t=>{t.material&&(t.material.userData.outline?(t.material.uniforms.opacity.value=.75*e.opacity,t.material.opacity=t.material.uniforms.opacity.value):(t.material.opacity=e.opacity,t.material.depthWrite=1===e.opacity,t.material.transparent=1!==e.opacity))})),i.opacity=null),a(e,t,i,r,n),!!o(t,i)&&Promise.resolve({json:e,obj:r})}}},2199:(e,t,r)=>{const n=r(2976),o=r(5843),{areAllChangesResolve:a}=r(9724),{commonUpdate:i}=r(9724);function s(e){const t=e.coord.data[0],r=e.coord.data[1],n=e.coord.data[2],o=e.voxels.shape[2],a=e.voxels.shape[1],i=e.voxels.shape[0],{data:s}=e.voxels;function l(t){let r=e.coord.data[0]-t.offset[0],n=e.coord.data[1]-t.offset[1],o=e.coord.data[2]-t.offset[2];return r=r<0?1e3:r,n=n<0?1e3:n,o=o<0?1e3:o,r+n+o}this.neighbours=[],this.data=s,this.set=function(e,s,l,c,d){const p=e-t,u=s-r,m=l-n;if(p>=0&&p<o&&u>=0&&u<a&&m>=0&&m<i)this.data[(m*a+u)*o+p]=c;else if(!d)for(let t=0;t<this.neighbours.length;t++)if(this.neighbours[t].voxels.set(e,s,l,c,!0))return!0;return!0},this.get=function(e,s,l,c){const d=e-t,p=s-r,u=l-n;if(d>=0&&d<o&&p>=0&&p<a&&u>=0&&u<i)return this.data[(u*a+p)*o+d];if(!c)for(let t=0;t<this.neighbours.length;t++){const r=this.neighbours[t].voxels.get(e,s,l,!0);if(-1!==r)return r}return-1},this.setNeighbours=function(t,r){this.neighbours=t.reduce(((t,n)=>{if(n.id===r.id)return t;const o=Math.max(e.coord.data[0]+e.voxels.shape[2],n.offset[0]+n.size[0])-Math.min(e.coord.data[0],n.offset[0]),a=Math.max(e.coord.data[1]+e.voxels.shape[1],n.offset[1]+n.size[1])-Math.min(e.coord.data[1],n.offset[1]),i=Math.max(e.coord.data[2]+e.voxels.shape[0],n.offset[2]+n.size[2])-Math.min(e.coord.data[2],n.offset[2]),s=e.voxels.shape[2]+n.size[0],l=e.voxels.shape[1]+n.size[1],c=e.voxels.shape[0]+n.size[2];if(o<=s&&a<=l&&i<=c){if(o===s&&a===l&&i===c)return t;t.push(n)}return t}),[]),this.neighbours.sort(((e,t)=>l(e)-l(t)))}}function l(e,t){return{voxels:new s(e),size:[e.voxels.shape[2],e.voxels.shape[1],e.voxels.shape[0]],offset:e.coord.data,multiple:e.multiple,id:e.id||t,idx:t}}e.exports={create(e,t){const r=[];return void 0!==e.voxels_group&&e.voxels_group.forEach(((e,t)=>{r.push(l(e,t))})),void 0!==e.chunks_ids&&e.chunks_ids.forEach(((e,n)=>{r.push(l(t.getWorld().chunkList[e].attributes,n))})),r.forEach((e=>{e.voxels.setNeighbours(r,e)})),n.create(e,r,e.space_size.data,t)},update(e,t,r,n){const s={};if(void 0===t.opacity||t.opacity.timeSeries||(r.traverse((t=>{t.material&&(t.material.userData.outline?(t.material.uniforms.opacity.value=.75*e.opacity,t.material.opacity=t.material.uniforms.opacity.value):(t.material.opacity=e.opacity,t.material.depthWrite=1===e.opacity,t.material.transparent=1!==e.opacity))})),s.opacity=null),void 0!==t.chunks_ids&&!t.chunks_ids.timeSeries){const e={},a=new Set;r.children.forEach((t=>{t.voxel&&(e[t.voxel.chunk.id]=t)}));const i=Object.keys(e).reduce(((e,t)=>(e.push(parseInt(t,10)),e)),[]);o.difference(i,t.chunks_ids).forEach((t=>{e[t].voxel.chunk.voxels.neighbours.forEach((e=>{a.add(e.id)})),r.remove(e[t]),r.voxelsChunks=r.voxelsChunks.filter((e=>e.id!==t)),e[t].children.forEach((e=>{e.geometry.dispose(),e.material.dispose()})),e[t]=null})),o.difference(t.chunks_ids,i).forEach((t=>{const o=l(n.getWorld().chunkList[t].attributes,r.voxelsChunks.length),a=r.addChunk(o);r.voxelsChunks.push(o),e[t]=a})),r.voxelsChunks.forEach((e=>{e.voxels.setNeighbours(r.voxelsChunks,e)})),o.difference(t.chunks_ids,i).forEach((t=>{const{chunk:r}=e[t].voxel;a.add(r.id),r.voxels.neighbours.forEach((e=>{a.add(e.id)}))})),a.forEach((t=>{e[t]&&r.updateChunk(e[t].voxel.chunk,!0)})),s.chunks_ids=null}return void 0===t._hold_remeshing||t._hold_remeshing.timeSeries||(r.holdRemeshing=e._hold_remeshing,e._hold_remeshing||r.rebuildChunk(),s._hold_remeshing=null),i(e,t,s,r,n),!!a(t,s)&&Promise.resolve({json:e,obj:r})}}},7203:(e,t,r)=>{const n=r(108),o=r(2736);r(9806)(n),r(8117)(n),r(3866)(n),r(9209)(n),n.TransformControls=r(903).Ys,n.Mesh.prototype.raycast=o.acceleratedRaycast,e.exports={Helpers:r(9724),Initializers:{Canvas:r(2794),Camera:r(8175),Renderer:r(5567),Scene:r(404).Init,Setup:r(3768),Manipulate:r(6615)},Objects:{Line:r(8308),Lines:r(4757),MarchingCubes:r(9603),Mesh:r(4222),Points:r(2168),STL:r(8012),Surface:r(4638),TextureText:r(6242),Texture:r(2833),Text:r(2932),Text2d:r(3099),TorusKnot:r(7186),VectorField:r(253),Vectors:r(860),Voxels:r(3060),SparseVoxels:r(6264),VoxelsGroup:r(2199),Volume:r(5064),MIP:r(953),Label:r(9474)},Interactions:{Voxels:r(9034),PointsCallback:r(4534),StandardCallback:r(5498)},THREE:n}},9452:(e,t,r)=>{const n=r(7360),o=r(7761),a=r(4872),i=r(5251),s=r(7723),l=r(7203),c=r(5843),d=n.createCodec({preset:!0}),p=r(1020);function u(e){return n.decode(e,{codec:d})}window.Float16Array=p,d.addExtPacker(32,p,(e=>e)),d.addExtUnpacker(32,(e=>p(e.buffer))),r(2876),r(80),e.exports={K3D:s,msgpackDecode:u,serialize:i,CreateK3DAndLoadBinarySnapshot:function(e,t){return new Promise(((r,n)=>{let a;o.unzlib(new Uint8Array(e),((o,i)=>{o||(e=i),e=u(e);try{a=new s(l,t,e.plot)}catch(e){return console.log(e),n(e)}return a.setSnapshot(e).then((()=>(setTimeout((()=>{e.plot.camera.length>0&&(a.setCamera(e.plot.camera),a.render())}),10),r(a))))}))}))},TransferFunctionEditor:a.transferFunctionEditor,TransferFunctionModel:a.transferFunctionModel,TransferFunctionView:a.transferFunctionView,ThreeJsProvider:l,_:c,version:r(5527).version}},4872:(e,t,r)=>{const n=r(2187),o=r(5843),a=r(5527).version,i=r(5103),s=r(5251);function l(e,t,n){const o=document.createElementNS("http://www.w3.org/2000/svg","svg");let a=t.opacityFunction;const s=o.namespaceURI;let l,c,d,p,u=t.colorMap;const m=10,h=40;let g=[],f=[];function v(e){const t=e.target.parentNode,r=g.indexOf(t);0!==r&&r!==g.length-1&&(o.removeChild(t),g.splice(r,1),a.splice(2*r,2),w(o,!0),n({key:"opacity_function",value:a}),e.preventDefault())}function y(e){const t=e.target.parentNode,r=f.indexOf(t);0!==r&&r!==f.length-1&&(o.removeChild(t),f.splice(r,1),u.splice(4*r,4),w(o,!0),b(o,!0),n({key:"color_map",value:u}),e.preventDefault())}function _(e,t,r){const n=document.createElementNS(o.namespaceURI,"g");return[{offset:1,color:"white"},{offset:0,color:"black"}].forEach((a=>{const i=document.createElementNS(o.namespaceURI,"circle");i.setAttribute("cx",e+a.offset),i.setAttribute("cy",t+a.offset),i.setAttribute("r",r),i.setAttribute("stroke-width",1),i.setAttribute("stroke",a.color),i.setAttribute("fill","transparent"),n.appendChild(i)})),n}function x(e,t){return e.reduce(((r,n,o)=>(o%(1+t)==0&&r.push({v:n,p:e.slice(o+1,o+1+t)}),r)),[]).sort(((e,t)=>e.v-t.v)).reduce(((e,t)=>(e.push(t.v),t.p.forEach((t=>{e.push(t)})),e)),[])}function b(e,t){let r;if(i.createSVGGradient(e,"colorMap",u,null,!0),p.setAttribute("x",0),p.setAttribute("y",e.clientHeight-h+10),p.setAttribute("width",e.clientWidth),p.setAttribute("height",30),!t)for(f.forEach((t=>{e.removeChild(t)})),f=[],r=0;r<u.length;r+=4){const t=_((u[r]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,e.clientHeight-15,5);t.classList.add("draggable"),t.classList.add("colormap"),t.addEventListener("contextmenu",y),t.addEventListener("dblclick",(t=>{const r=f.indexOf(t.target.parentElement),o=`0${Math.round(255*u[4*r+1]).toString(16)}`,a=`0${Math.round(255*u[4*r+2]).toString(16)}`,i=`0${Math.round(255*u[4*r+3]).toString(16)}`;l.k3dIndex=r,l.value=`#${o.substr(-2)}${a.substr(-2)}${i.substr(-2)}`,l.click(),l.addEventListener("change",(function t(r){const o=r.target.value.substr(1);u[4*l.k3dIndex+1]=parseInt(o.substring(0,2),16)/255,u[4*l.k3dIndex+2]=parseInt(o.substring(2,4),16)/255,u[4*l.k3dIndex+3]=parseInt(o.substring(4,6),16)/255,b(e,!0),w(e,!0),n({key:"color_map",value:u}),l.removeEventListener("change",t)}))})),e.appendChild(t),f.push(t)}}function w(e,t){let r;const n=a.concat([u[u.length-4],0,u[0],0]);for(i.createSVGGradient(e,"transferFunction",u,a,!0),c.points.clear(),r=0;r<n.length;r+=2){const t=e.createSVGPoint();t.x=(n[r]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,t.y=(1-n[r+1])*(e.clientHeight-m-h)+m,c.points.appendItem(t)}if(c.setAttribute("fill","url(#transferFunction)"),c.setAttribute("stroke-width",1),c.setAttribute("stroke","black"),!t)for(g.forEach((t=>{e.removeChild(t)})),g=[],r=0;r<a.length;r+=2){const t=_((a[r]-u[0])/(u[u.length-4]-u[0])*e.clientWidth,(1-a[r+1])*(e.clientHeight-m-h)+m,5);t.classList.add("draggable"),t.classList.add("polygon"),t.addEventListener("contextmenu",v),e.appendChild(t),g.push(t)}}function M(){w(o),b(o)}r(1552),o.setAttribute("width","100%"),o.setAttribute("height","100%"),o.classList.add("k3d-transfer-function"),c=document.createElementNS(s,"polygon"),p=document.createElementNS(s,"rect"),p.setAttribute("fill","url(#colorMap)"),o.appendChild(c),o.appendChild(p),l=document.createElement("input"),l.setAttribute("type","color"),l.classList.add("k3d-color-picker"),e.appendChild(o),e.appendChild(l),window.addEventListener("resize",M,!1),function(e){function t(t){const r=e.getScreenCTM();return t.touches&&(t=t.touches[0]),{x:(t.clientX-r.e)/r.a,y:(t.clientY-r.f)/r.d}}function r(r){if(r.target.parentNode.classList.contains("draggable"))d=r.target.parentNode;else{const o=t(r);if(o.y>m&&o.y<e.clientHeight-h&&(a.push(u[0]+o.x/e.clientWidth*(u[u.length-4]-u[0])),a.push(1-(o.y-m)/(e.clientHeight-m-h)),a=x(a,1),w(e,!1),n({key:"opacity_function",value:a})),o.y>e.clientHeight-h+10){const t=u[0]+o.x/e.clientWidth*(u[u.length-4]-u[0]);let r;const a=i.mergeColorMapWithOpacity(u,[u[0],0,t,.5,u[u.length-4],1]);for(r=0;r<a.length;r+=5)a[r]===t&&(u=u.concat(a.slice(r,r+4)));u=x(u,3),b(e,!1),n({key:"color_map",value:u})}}}function o(r){let o;if(d){r.preventDefault();const i=t(r);d.classList.contains("polygon")&&(o=g.indexOf(d),i.y=Math.max(i.y,m),i.y=Math.min(i.y,e.clientHeight-h),0===o||o===g.length-1?i.x=parseFloat(d.childNodes[1].getAttribute("cx")):(i.x=Math.min(i.x,parseFloat(g[o+1].childNodes[1].getAttribute("cx"))-1),i.x=Math.max(i.x,parseFloat(g[o-1].childNodes[1].getAttribute("cx"))+1)),a[2*o]=u[0]+i.x/e.clientWidth*(u[u.length-4]-u[0]),a[2*o+1]=1-(i.y-m)/(e.clientHeight-m-h),n({key:"opacity_function",value:a})),d.classList.contains("colormap")&&(o=f.indexOf(d),i.y=parseFloat(d.childNodes[1].getAttribute("cy")),0===o||o===f.length-1?i.x=parseFloat(d.childNodes[1].getAttribute("cx")):(i.x=Math.min(i.x,parseFloat(f[o+1].childNodes[1].getAttribute("cx"))-1),i.x=Math.max(i.x,parseFloat(f[o-1].childNodes[1].getAttribute("cx"))+1)),u[4*o]=u[0]+i.x/e.clientWidth*(u[u.length-4]-u[0]),n({key:"color_map",value:u})),d.childNodes.forEach(((e,t)=>{e.setAttribute("cx",i.x+1-t),e.setAttribute("cy",i.y+1-t)})),b(e,!0),w(e,!0)}}function s(){d=!1}e.addEventListener("mousedown",r),e.addEventListener("mousemove",o),e.addEventListener("mouseup",s),e.addEventListener("mouseleave",s),e.addEventListener("touchstart",r),e.addEventListener("touchmove",o),e.addEventListener("touchend",s),e.addEventListener("touchleave",s),e.addEventListener("touchcancel",s)}(o),u=x(u,3),a=x(a,1),M(),this.refresh=M,this.setColorMap=function(e){u=e,M()},this.setOpacityFunction=function(e){a=e,M()},this.getColorMap=function(){return u},this.getOpacityFunction=function(){return a},this.isDragging=function(){return!1!==d}}const c=n.DOMWidgetModel.extend({defaults:o.extend(o.result({},"widgets.DOMWidgetModel.prototype.defaults"),{_model_name:"TransferFunctionModel",_view_name:"TransferFunctionView",_model_module:"k3d",_view_module:"k3d",_model_module_version:a,_view_module_version:a})},{serializers:o.extend({color_map:s,opacity_function:s},n.DOMWidgetModel.serializers)}),d=n.DOMWidgetView.extend({render(){const e=window.document.createElement("div"),t=window.document.createElement("div");e.style.cssText=[`height:${this.model.get("height")}px`,"position: relative"].join(";"),t.style.cssText=["width: 100%","height: 100%","position: relative"].join(";"),e.appendChild(t),this.el.appendChild(e),this.container=t,this.on("displayed",this._init,this)},remove(){},_init(){const e=this;this.model.on("change:color_map",this._setColorMap,this),this.model.on("change:opacity_function",this._setOpacityFunction,this);try{this.K3DTransferFunctionEditorInstance=new l(this.container,{height:this.model.get("height"),colorMap:Array.from(this.model.get("color_map").data),opacityFunction:Array.from(this.model.get("opacity_function").data)},(t=>{e.model.set(t.key,{data:new Float32Array(t.value),shape:[t.value.length]},{updated_view:e}),e.model.save_changes()}))}catch(e){console.log(e)}},_setColorMap(e,t,r){if(r.updated_view===this||this.K3DTransferFunctionEditorInstance.isDragging())return;const n=Array.from(this.model.get("color_map").data);this.K3DTransferFunctionEditorInstance.setColorMap(Array.from(n))},_setOpacityFunction(e,t,r){if(r.updated_view===this||this.K3DTransferFunctionEditorInstance.isDragging())return;const n=this.model.get("opacity_function").data;this.K3DTransferFunctionEditorInstance.setOpacityFunction(Array.from(n))},processPhosphorMessage(e){switch(n.DOMWidgetView.prototype.processPhosphorMessage.call(this,e),e.type){case"after-attach":this.el.addEventListener("contextmenu",this,!0);break;case"before-detach":this.el.removeEventListener("contextmenu",this,!0);break;case"resize":this.handleResize(e)}},handleEvent(e){"contextmenu"===e.type?this.handleContextMenu(e):n.DOMWidgetView.prototype.handleEvent.call(this,e)},handleContextMenu(){},handleResize(){this.K3DTransferFunctionEditorInstance&&this.K3DTransferFunctionEditorInstance.refresh()}});e.exports={transferFunctionModel:c,transferFunctionView:d,transferFunctionEditor:l}},5527:(e,t,r)=>{const n=r(8008);e.exports={version:n.version}},1174:(e,t,r)=>{"use strict";r.d(t,{Z:()=>a});var n=r(3645),o=r.n(n)()((function(e){return e[1]}));o.push([e.id,".katex-display {\r\n    margin: 0.25em 0 !important;\r\n}\r\n\r\n/*.dg input, .dg select {*/\r\n/*  color: black;*/\r\n/*  line-height: normal !important;*/\r\n/*}*/\r\n\r\n/*.dg li {*/\r\n/*  list-style: none !important;*/\r\n/*}*/\r\n\r\n/*.dg li > * {*/\r\n/*  margin-bottom: 0 !important;*/\r\n/*}*/\r\n\r\n/*.dg input, .dg select {*/\r\n/*  padding: 3px !important;*/\r\n/*  display: block !important;*/\r\n/*  box-shadow: none !important;*/\r\n/*  font-size: 100% !important;*/\r\n/*  border: 0 !important;*/\r\n/*}*/\r\n\r\n/*.dg.a {*/\r\n/*  margin-right: 0 !important;*/\r\n/*}*/\r\n\r\n/*.dg li {*/\r\n/*  margin: 0 !important;*/\r\n/*}*/\r\n\r\n.lil-gui {\r\n    max-height: inherit !important;\r\n}\r\n\r\n.lil-gui select {\r\n    color: black;\r\n}\r\n\r\n/*.dg.main .close-button.close-bottom {*/\r\n/*  position: relative !important;*/\r\n/*}*/\r\n\r\n/*.dg.main.taller-than-window .close-button.close-bottom {*/\r\n/*  position: absolute !important;*/\r\n/*  bottom: 0 !important;*/\r\n/*}*/\r\n\r\n/*.dg.main.taller-than-window > ul > li:last-child {*/\r\n/*  margin-bottom: 20px !important;*/\r\n/*}*/\r\n\r\n.dg .controller[hidden] {\r\n    display: none;\r\n}\r\n\r\n.dg .controller:not([hidden]) {\r\n    display: flex\r\n}\r\n\r\n.k3d-target canvas {\r\n    position: relative;\r\n    z-index: 10;\r\n}\r\n\r\n.k3d-transfer-function {\r\n    height: 100% !important;\r\n}\r\n\r\n.k3d-transfer-function circle {\r\n    cursor: move;\r\n}\r\n\r\n.k3d-transfer-function circle.selected {\r\n    /*stroke: red;*/\r\n}\r\n\r\n.k3d-color-picker {\r\n    display: none;\r\n}\r\n\r\n",""]);const a=o},1552:(e,t,r)=>{"use strict";r.r(t),r.d(t,{default:()=>v});var n=r(3379),o=r.n(n),a=r(7795),i=r.n(a),s=r(569),l=r.n(s),c=r(3565),d=r.n(c),p=r(9216),u=r.n(p),m=r(6655),h=r.n(m),g=r(1174),f={};f.styleTagTransform=h(),f.setAttributes=d(),f.insert=l().bind(null,"head"),f.domAPI=i(),f.insertStyleElement=u(),o()(g.Z,f);const v=g.Z&&g.Z.locals?g.Z.locals:void 0},8008:e=>{"use strict";e.exports=JSON.parse('{"name":"k3d","version":"2.16.1","description":"3D visualization library","author":"k3d team","main":"src/index.js","repository":{"type":"git","url":"https://github.com/K3D-tools/K3D-jupyter.git"},"keywords":["jupyter","widgets","ipython","ipywidgets","jupyterlab","jupyterlab-extension"],"scripts":{"build":"webpack","test":"echo \\"Error: no test specified\\" && exit 1"},"jupyterlab":{"extension":"dist/labplugin"},"devDependencies":{"components-webfontloader":"1.5.2","copy-webpack-plugin":"^11.0.0","cors":"2.8.5","css-loader":"^6.7.1","eslint":"^8.16.0","eslint-config-airbnb-base":"^15.0.0","eslint-plugin-import":"^2.26.0","eslint-plugin-markdown":"^2.2.1","express":"^4.18.1","grunt":"^1.5.3","grunt-contrib-clean":"2.0.1","grunt-contrib-connect":"^3.0.0","grunt-contrib-jshint":"^3.2.0","grunt-contrib-watch":"^1.1.0","grunt-eslint":"^24.0.0","grunt-express-server":"0.5.4","grunt-jsdoc":"2.4.1","grunt-open":"^0.2.4","grunt-webpack":"^5.0.0","jshint-stylish":"^2.2.1","json-loader":"^0.5.7","load-grunt-tasks":"5.1.0","style-loader":"^3.3.1","time-grunt":"2.0.0","webpack":"^5.72.1","webpack-cli":"^4.9.2","webpack-combine-loaders":"^2.0.4","webpack-node-externals":"^3.0.0","webpack-visualizer-plugin2":"^1.0.0"},"dependencies":{"@jupyter-widgets/base":"^4.1.0","fflate":"^0.7.3","file-saver":"^2.0.5","katex":"^0.15.6","lil-gui":"^0.16.1","lodash":"^4.17.21","msgpack-lite":"^0.1.26","rasterizehtml":"^1.3.1","requirejs":"^2.3.6","screenfull":"^6.0.1","stats.js":"^0.17.0","three":"^0.140.2","three-mesh-bvh":"^0.5.11"}}')}}]);